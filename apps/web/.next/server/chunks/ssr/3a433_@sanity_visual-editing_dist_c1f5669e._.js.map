{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"file":"context.js","sources":["file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/optimistic/context.ts"],"sourcesContent":["import {createEmptyActor, type ActorRefFrom} from 'xstate'\nimport {createDatasetMutator} from './state/datasetMutator'\n\nexport type MutatorActor = ActorRefFrom<ReturnType<typeof createDatasetMutator>>\nexport type EmptyActor = typeof emptyActor\n\nexport const emptyActor = createEmptyActor()\n\nexport let actor: MutatorActor | EmptyActor = emptyActor\n\nexport const listeners = new Set<() => void>()\n\nexport function isEmptyActor(actor: MutatorActor | EmptyActor): actor is EmptyActor {\n  return actor === emptyActor\n}\n\nexport function setActor(nextActor: MutatorActor): void {\n  actor = nextActor\n  for (const onActorChange of listeners) {\n    onActorChange()\n  }\n}\n"],"names":["emptyActor","createEmptyActor","actor","listeners","Set","isEmptyActor","setActor","nextActor","onActorChange"],"mappings":";;;;;;;;;AAMO,MAAMA,wPAAaC,mBAAAA,CAAiB;AAEpC,IAAIC,QAAmCF;AAEjCG,MAAAA,YAAAA,aAAAA,GAAAA,IAAgBC,IAAgB;AAEtC,SAASC,aAAaH,MAAAA,EAAuD;IAClF,OAAOA,WAAUF;AACnB;AAEO,SAASM,SAASC,SAAAA,EAA+B;IAC9CA,QAAAA;IACR,KAAA,MAAWC,iBAAiBL,UACZ,cAAA;AAElB","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"file":"mutations.js","sources":["file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/node_modules/.pnpm/%40sanity%2Btypes%403.88.0_%40types%2Breact%4019.1.6_debug%404.4.1/node_modules/%40sanity/types/lib/index.mjs","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/node_modules/.pnpm/%40sanity%2Butil%403.88.0_%40types%2Breact%4019.1.6_debug%404.4.1/node_modules/%40sanity/util/lib/paths.mjs","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/react/useOptimisticActor.ts","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/react/useDocuments.ts","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/util/randomKey.ts","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/util/mutations.ts"],"sourcesContent":["function isObject(obj) {\n  return typeof obj == \"object\" && obj !== null && !Array.isArray(obj);\n}\nfunction isReference(reference) {\n  return isObject(reference) && typeof reference._ref == \"string\";\n}\nfunction isImage(value) {\n  return isObject(value) && isReference(value.asset) && value.asset._ref.startsWith(\"image-\");\n}\nfunction isCrossDatasetReference(reference) {\n  return isObject(reference) && typeof reference._ref == \"string\" && typeof reference._dataset == \"string\" && typeof reference._projectId == \"string\";\n}\nfunction isSanityDocument(document) {\n  return isObject(document) && typeof document._id == \"string\" && typeof document._type == \"string\";\n}\nfunction isTypedObject(obj) {\n  return isObject(obj) && typeof obj._type == \"string\";\n}\nfunction isKeyedObject(obj) {\n  return isObject(obj) && typeof obj._key == \"string\";\n}\nfunction isGlobalDocumentReference(reference) {\n  return !isObject(reference) || typeof reference._ref != \"string\" ? !1 : reference._ref.split(\":\").length === 3;\n}\nfunction isValidationErrorMarker(marker) {\n  return marker.level === \"error\";\n}\nfunction isValidationWarningMarker(marker) {\n  return marker.level === \"warning\";\n}\nfunction isValidationInfoMarker(marker) {\n  return marker.level === \"info\";\n}\nconst MEDIA_LIBRARY_ASSET_ASPECT_TYPE_NAME = \"sanity.asset.aspect\";\nfunction isAssetAspect(maybeAssetAspect) {\n  return typeof maybeAssetAspect == \"object\" && maybeAssetAspect !== null && \"_type\" in maybeAssetAspect && maybeAssetAspect._type === MEDIA_LIBRARY_ASSET_ASPECT_TYPE_NAME;\n}\nfunction defineAssetAspect(definition) {\n  const { assetType, name } = definition;\n  return {\n    _type: MEDIA_LIBRARY_ASSET_ASPECT_TYPE_NAME,\n    _id: `${name}`,\n    definition,\n    ...assetType && {\n      assetType: Array.isArray(assetType) ? assetType : [assetType]\n    }\n  };\n}\nfunction isCreateMutation(mutation) {\n  return \"create\" in mutation;\n}\nfunction isCreateIfNotExistsMutation(mutation) {\n  return \"createIfNotExists\" in mutation;\n}\nfunction isCreateOrReplaceMutation(mutation) {\n  return \"createOrReplace\" in mutation;\n}\nfunction isDeleteMutation(mutation) {\n  return \"delete\" in mutation;\n}\nfunction isPatchMutation(mutation) {\n  return \"patch\" in mutation;\n}\nconst reKeySegment = /_key\\s*==\\s*['\"](.*)['\"]/, reIndexTuple = /^\\d*:\\d*$/;\nfunction isIndexSegment(segment) {\n  return typeof segment == \"number\" || typeof segment == \"string\" && /^\\[\\d+\\]$/.test(segment);\n}\nfunction isKeySegment(segment) {\n  return typeof segment == \"string\" ? reKeySegment.test(segment.trim()) : typeof segment == \"object\" && \"_key\" in segment;\n}\nfunction isIndexTuple(segment) {\n  if (typeof segment == \"string\" && reIndexTuple.test(segment))\n    return !0;\n  if (!Array.isArray(segment) || segment.length !== 2)\n    return !1;\n  const [from, to] = segment;\n  return (typeof from == \"number\" || from === \"\") && (typeof to == \"number\" || to === \"\");\n}\nfunction isRecord$1(value) {\n  return !!value && (typeof value == \"object\" || typeof value == \"function\");\n}\nfunction isPortableTextTextBlock(value) {\n  return isRecord$1(value) && typeof value._type == \"string\" && // block types can be named, so expect anything here.\n  Array.isArray(value.children) && value.children.every((child) => isRecord$1(child)) && (\"markDefs\" in value ? Array.isArray(value.markDefs) && value.markDefs.every((def) => isRecord$1(def)) : !0) && (\"style\" in value ? typeof value.style == \"string\" : !0);\n}\nfunction isPortableTextSpan(value) {\n  return isRecord$1(value) && value._type === \"span\" && typeof value.text == \"string\" && (\"marks\" in value ? Array.isArray(value.marks) && value.marks.every((mark) => typeof mark == \"string\") : !0);\n}\nfunction isPortableTextListBlock(value) {\n  return isPortableTextTextBlock(value) && \"listItem\" in value && typeof value.listItem == \"string\" && \"level\" in value && Number.isInteger(value.level);\n}\nfunction isRecord(value) {\n  return !!value && (typeof value == \"object\" || typeof value == \"function\");\n}\nfunction isDocumentSchemaType(type) {\n  if (!isObjectSchemaType(type))\n    return !1;\n  let current = type;\n  for (; current; ) {\n    if (current.name === \"document\")\n      return !0;\n    current = current.type;\n  }\n  return !1;\n}\nfunction isObjectSchemaType(type) {\n  return isRecord(type) ? type.jsonType === \"object\" : !1;\n}\nfunction isArraySchemaType(type) {\n  return isRecord(type) ? type.jsonType === \"array\" : !1;\n}\nfunction isArrayOfBlocksSchemaType(type) {\n  return isArraySchemaType(type) && type.of.some((memberType) => isBlockSchemaType(memberType));\n}\nfunction isArrayOfObjectsSchemaType(type) {\n  return isArraySchemaType(type) && type.of.every((memberType) => isObjectSchemaType(memberType));\n}\nfunction isArrayOfPrimitivesSchemaType(type) {\n  return isArraySchemaType(type) && type.of.every((memberType) => isPrimitiveSchemaType(memberType));\n}\nfunction isBooleanSchemaType(type) {\n  return isRecord(type) ? type.jsonType === \"boolean\" : !1;\n}\nfunction isStringSchemaType(type) {\n  return isRecord(type) ? type.jsonType === \"string\" : !1;\n}\nfunction isNumberSchemaType(type) {\n  return isRecord(type) ? type.jsonType === \"number\" : !1;\n}\nfunction isPrimitiveSchemaType(type) {\n  return isBooleanSchemaType(type) || isStringSchemaType(type) || isNumberSchemaType(type);\n}\nfunction isReferenceSchemaType(type) {\n  return isRecord(type) && (type.name === \"reference\" || isReferenceSchemaType(type.type));\n}\nfunction isImageSchemaType(type) {\n  return isRecord(type) && (type.name === \"image\" || isImageSchemaType(type.type));\n}\nfunction isFileSchemaType(type) {\n  return isRecord(type) && (type.name === \"file\" || isFileSchemaType(type.type));\n}\nfunction isDeprecatedSchemaType(type) {\n  return isRecord(type) ? typeof type.deprecated < \"u\" : !1;\n}\nfunction isDeprecationConfiguration(type) {\n  return isRecord(type) ? typeof type.deprecated < \"u\" : !1;\n}\nfunction isCrossDatasetReferenceSchemaType(type) {\n  return isRecord(type) && (type.name === \"crossDatasetReference\" || isCrossDatasetReferenceSchemaType(type.type));\n}\nfunction isTitledListValue(item) {\n  return typeof item == \"object\" && item !== null && \"title\" in item && \"value\" in item;\n}\nfunction isSpanSchemaType(type) {\n  return isRecord(type) ? Array.isArray(type.annotations) && Array.isArray(type.decorators) : !1;\n}\nfunction isBlockSchemaType(type) {\n  if (!isRecord(type) || !Array.isArray(type.fields)) return !1;\n  const maybeSpanChildren = type.fields.find(isBlockChildrenObjectField), maybeStyle = type.fields.find(isBlockStyleObjectField), maybeList = type.fields.find(isBlockListObjectField);\n  return isBlockChildrenObjectField(maybeSpanChildren) && isBlockStyleObjectField(maybeStyle) && isBlockListObjectField(maybeList);\n}\nfunction isBlockStyleObjectField(field) {\n  return !isRecord(field) || field.name !== \"style\" ? !1 : isRecord(field.type) && field.type.jsonType === \"string\";\n}\nfunction isBlockListObjectField(field) {\n  return !isRecord(field) || field.name !== \"listItem\" ? !1 : isRecord(field.type) && field.type.jsonType === \"string\";\n}\nfunction isBlockChildrenObjectField(field) {\n  return !isRecord(field) || field.name !== \"children\" || !isArraySchemaType(field.type) ? !1 : field.type.of.some(isSpanSchemaType);\n}\nfunction defineType(schemaDefinition, defineOptions) {\n  return schemaDefinition;\n}\nfunction defineField(schemaField, defineOptions) {\n  return schemaField;\n}\nfunction defineArrayMember(arrayOfSchema, defineOptions) {\n  return arrayOfSchema;\n}\nfunction typed(input) {\n  return input;\n}\nconst searchStrategies = [\"groqLegacy\", \"groq2024\"];\nfunction isSearchStrategy(maybeSearchStrategy) {\n  return searchStrategies.includes(maybeSearchStrategy);\n}\nfunction isSlug(thing) {\n  return isObject(thing) && typeof thing.current == \"string\";\n}\nfunction isCreateSquashedMutation(mutation) {\n  return \"createSquashed\" in mutation;\n}\nfunction isValidationError(node) {\n  return node.level === \"error\";\n}\nfunction isValidationWarning(node) {\n  return node.level === \"warning\";\n}\nfunction isValidationInfo(node) {\n  return node.level === \"info\";\n}\nexport {\n  MEDIA_LIBRARY_ASSET_ASPECT_TYPE_NAME,\n  defineArrayMember,\n  defineAssetAspect,\n  defineField,\n  defineType,\n  isArrayOfBlocksSchemaType,\n  isArrayOfObjectsSchemaType,\n  isArrayOfPrimitivesSchemaType,\n  isArraySchemaType,\n  isAssetAspect,\n  isBlockChildrenObjectField,\n  isBlockListObjectField,\n  isBlockSchemaType,\n  isBlockStyleObjectField,\n  isBooleanSchemaType,\n  isCreateIfNotExistsMutation,\n  isCreateMutation,\n  isCreateOrReplaceMutation,\n  isCreateSquashedMutation,\n  isCrossDatasetReference,\n  isCrossDatasetReferenceSchemaType,\n  isDeleteMutation,\n  isDeprecatedSchemaType,\n  isDeprecationConfiguration,\n  isDocumentSchemaType,\n  isFileSchemaType,\n  isGlobalDocumentReference,\n  isImage,\n  isImageSchemaType,\n  isIndexSegment,\n  isIndexTuple,\n  isKeySegment,\n  isKeyedObject,\n  isNumberSchemaType,\n  isObjectSchemaType,\n  isPatchMutation,\n  isPortableTextListBlock,\n  isPortableTextSpan,\n  isPortableTextTextBlock,\n  isPrimitiveSchemaType,\n  isReference,\n  isReferenceSchemaType,\n  isSanityDocument,\n  isSearchStrategy,\n  isSlug,\n  isSpanSchemaType,\n  isStringSchemaType,\n  isTitledListValue,\n  isTypedObject,\n  isValidationError,\n  isValidationErrorMarker,\n  isValidationInfo,\n  isValidationInfoMarker,\n  isValidationWarning,\n  isValidationWarningMarker,\n  searchStrategies,\n  typed\n};\n//# sourceMappingURL=index.mjs.map\n","import { isIndexSegment, isKeySegment, isIndexTuple } from \"@sanity/types\";\nconst rePropName = /[^.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))/g, reKeySegment = /_key\\s*==\\s*['\"](.*)['\"]/, EMPTY_PATH = [], FOCUS_TERMINATOR = \"$\", GROQ_DATA_TYPE_VALUES = [\"true\", \"false\", \"null\"];\nfunction get(obj, path, defaultVal) {\n  const select = typeof path == \"string\" ? fromString(path) : path;\n  if (!Array.isArray(select))\n    throw new Error(\"Path must be an array or a string\");\n  let acc = obj;\n  for (let i = 0; i < select.length; i++) {\n    const segment = select[i];\n    if (isIndexSegment(segment)) {\n      if (!Array.isArray(acc))\n        return defaultVal;\n      acc = acc[segment];\n    }\n    if (isKeySegment(segment)) {\n      if (!Array.isArray(acc))\n        return defaultVal;\n      acc = acc.find((item) => item._key === segment._key);\n    }\n    if (typeof segment == \"string\" && (acc = typeof acc == \"object\" && acc !== null ? acc[segment] : void 0), typeof acc > \"u\")\n      return defaultVal;\n  }\n  return acc;\n}\nconst pathsMemo = /* @__PURE__ */ new Map();\nfunction pathFor(path) {\n  if (path.length === 0)\n    return EMPTY_PATH;\n  const asString = toString(path);\n  return pathsMemo.has(asString) ? pathsMemo.get(asString) : (pathsMemo.set(asString, path), Object.freeze(path), path);\n}\nfunction isEqual(path, otherPath) {\n  return path.length === otherPath.length && path.every((segment, i) => isSegmentEqual(segment, otherPath[i]));\n}\nfunction numEqualSegments(path, otherPath) {\n  const length = Math.min(path.length, otherPath.length);\n  for (let i = 0; i < length; i++)\n    if (!isSegmentEqual(path[i], otherPath[i]))\n      return i;\n  return length;\n}\nfunction isSegmentEqual(segmentA, segmentB) {\n  return isKeySegment(segmentA) && isKeySegment(segmentB) ? segmentA._key === segmentB._key : isIndexSegment(segmentA) ? Number(segmentA) === Number(segmentB) : isIndexTuple(segmentA) && isIndexTuple(segmentB) ? segmentA[0] === segmentB[0] && segmentA[1] === segmentB[1] : segmentA === segmentB;\n}\nfunction hasFocus(focusPath, path) {\n  const withoutTerminator = focusPath[focusPath.length - 1] === FOCUS_TERMINATOR ? focusPath.slice(0, -1) : focusPath;\n  return isEqual(withoutTerminator, path);\n}\nfunction hasItemFocus(focusPath, item) {\n  return focusPath.length === 1 && isSegmentEqual(focusPath[0], item);\n}\nfunction isExpanded(segment, focusPath) {\n  const [head, ...tail] = focusPath;\n  return tail.length > 0 && isSegmentEqual(segment, head);\n}\nfunction startsWith(prefix, path) {\n  return prefix.every((segment, i) => isSegmentEqual(segment, path[i]));\n}\nfunction trimLeft(prefix, path) {\n  if (prefix.length === 0 || path.length === 0)\n    return path;\n  const [prefixHead, ...prefixTail] = prefix, [pathHead, ...pathTail] = path;\n  return isSegmentEqual(prefixHead, pathHead) ? pathFor(trimLeft(prefixTail, pathTail)) : path;\n}\nfunction trimRight(suffix, path) {\n  const sufLen = suffix.length, pathLen = path.length;\n  if (sufLen === 0 || pathLen === 0)\n    return path;\n  let i = 0;\n  for (; i < sufLen && i < pathLen && isSegmentEqual(path[pathLen - i - 1], suffix[sufLen - i - 1]); )\n    i++;\n  return pathFor(path.slice(0, pathLen - i));\n}\nfunction trimChildPath(path, childPath) {\n  return startsWith(path, childPath) ? trimLeft(path, childPath) : EMPTY_PATH;\n}\nfunction toString(path) {\n  if (!Array.isArray(path))\n    throw new Error(\"Path is not an array\");\n  return path.reduce((target, segment, i) => {\n    const isHead = i === 0;\n    if (typeof segment == \"number\")\n      return `${target}[${segment}]`;\n    if (typeof segment == \"string\")\n      return isHead ? segment : GROQ_DATA_TYPE_VALUES.includes(segment) ? `${target}[\"${segment}\"]` : `${target}.${segment}`;\n    if (isKeySegment(segment) && segment._key)\n      return `${target}[_key==\"${segment._key}\"]`;\n    if (Array.isArray(segment)) {\n      const [from, to] = segment;\n      return `${target}[${from}:${to}]`;\n    }\n    throw new Error(`Unsupported path segment \\`${JSON.stringify(segment)}\\``);\n  }, \"\");\n}\nfunction _resolveKeyedPath(value, path) {\n  if (path.length === 0)\n    return path;\n  const [next, ...rest] = path;\n  if (typeof next == \"number\") {\n    if (!Array.isArray(value) || !(next in value))\n      return [];\n    const item = value[next];\n    return [typeof item?._key == \"string\" ? { _key: item._key } : next, ..._resolveKeyedPath(item, rest)];\n  }\n  const nextVal = get(value, [next]);\n  return [next, ..._resolveKeyedPath(nextVal, rest)];\n}\nfunction resolveKeyedPath(value, path) {\n  if (!Array.isArray(path))\n    throw new Error(\"Path is not an array\");\n  return pathFor(_resolveKeyedPath(value, path));\n}\nfunction fromString(path) {\n  if (typeof path != \"string\")\n    throw new Error(\"Path is not a string\");\n  const segments = path.match(rePropName);\n  if (!segments)\n    throw new Error(\"Invalid path string\");\n  return segments.map(normalizePathSegment);\n}\nfunction normalizePathSegment(segment) {\n  return isIndexSegment(segment) ? normalizeIndexSegment(segment) : isKeySegment(segment) ? normalizeKeySegment(segment) : isIndexTuple(segment) ? normalizeIndexTupleSegment(segment) : segment;\n}\nfunction normalizeIndexSegment(segment) {\n  return Number(segment.replace(/[^\\d]/g, \"\"));\n}\nfunction normalizeKeySegment(segment) {\n  return { _key: segment.match(reKeySegment)[1] };\n}\nfunction normalizeIndexTupleSegment(segment) {\n  const [from, to] = segment.split(\":\").map((seg) => seg === \"\" ? seg : Number(seg));\n  return [from, to];\n}\nexport {\n  FOCUS_TERMINATOR,\n  _resolveKeyedPath,\n  fromString,\n  get,\n  hasFocus,\n  hasItemFocus,\n  isEqual,\n  isExpanded,\n  isSegmentEqual,\n  numEqualSegments,\n  pathFor,\n  resolveKeyedPath,\n  startsWith,\n  toString,\n  trimChildPath,\n  trimLeft,\n  trimRight\n};\n//# sourceMappingURL=paths.mjs.map\n","import {useCallback, useMemo, useSyncExternalStore} from 'react'\nimport {\n  actor,\n  emptyActor,\n  isEmptyActor,\n  listeners,\n  type EmptyActor,\n  type MutatorActor,\n} from '../optimistic/context'\n\nexport function useOptimisticActor(): MutatorActor | EmptyActor {\n  const subscribe = useCallback((listener: () => void) => {\n    listeners.add(listener)\n    return () => listeners.delete(listener)\n  }, [])\n\n  const actorRef = useSyncExternalStore(\n    subscribe,\n    () => actor,\n    () => emptyActor,\n  )\n\n  return actorRef\n}\n\nexport function useOptimisticActorReady(): boolean {\n  const actor = useOptimisticActor()\n  return useMemo(() => !isEmptyActor(actor), [actor])\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport type {SanityDocument} from '@sanity/client'\nimport {getDraftId, getPublishedId} from '@sanity/client/csm'\nimport {createIfNotExists, patch} from '@sanity/mutate'\nimport {isMaybePreviewIframe, isMaybePreviewWindow} from '@sanity/presentation-comlink'\nimport {get as getAtPath} from '@sanity/util/paths'\nimport {useCallback} from 'react'\nimport {isEmptyActor, type MutatorActor} from '../optimistic/context'\nimport type {\n  DocumentsGet,\n  DocumentsMutate,\n  OptimisticDocumentPatches,\n  Path,\n  PathValue,\n} from '../optimistic/types'\nimport {useOptimisticActor} from './useOptimisticActor'\n\nfunction debounce<F extends (...args: Parameters<F>) => ReturnType<F>>(fn: F, timeout: number): F {\n  let timer: ReturnType<typeof setTimeout>\n  return ((...args: Parameters<F>) => {\n    clearTimeout(timer)\n    timer = setTimeout(() => {\n      fn.apply(fn, args)\n    }, timeout)\n  }) as F\n}\n\nfunction getDocumentsAndSnapshot<T extends Record<string, any>>(id: string, actor: MutatorActor) {\n  const inFrame = isMaybePreviewIframe()\n  const inPopUp = isMaybePreviewWindow()\n\n  if (isEmptyActor(actor) || (!inFrame && !inPopUp)) {\n    throw new Error('The `useDocuments` hook cannot be used in this context')\n  }\n\n  const draftId = getDraftId(id)\n  const publishedId = getPublishedId(id)\n  const documents = actor.getSnapshot().context?.documents\n\n  const draftDoc = documents?.[draftId]\n  const publishedDoc = documents?.[publishedId]\n  const doc = draftDoc || publishedDoc\n\n  if (!doc) {\n    throw new Error(`Document \"${id}\" not found`)\n  }\n\n  // Helper to get the snapshot from the draft document if it exists, otherwise\n  // fall back to the published document\n  const getDocumentSnapshot = () =>\n    (draftDoc.getSnapshot().context?.local || publishedDoc.getSnapshot().context?.local) as\n      | SanityDocument<T>\n      | null\n      | undefined\n\n  const snapshot = getDocumentSnapshot()\n  const snapshotPromise = new Promise<SanityDocument<T> | null>((resolve) => {\n    if (snapshot) {\n      resolve(snapshot)\n    } else {\n      const subscriber = doc.on('ready', (event) => {\n        // Assert type here as the original document mutator machine doesn't\n        // emit a 'ready' event. We provide a custom action to emit it in this\n        // package's internal `createDatasetMutator` function. <3 xstate.\n        const {snapshot} = event as unknown as {snapshot: SanityDocument<T> | null | undefined}\n        resolve(snapshot || null)\n        subscriber.unsubscribe()\n      })\n    }\n  })\n\n  const getSnapshot = () => snapshotPromise\n\n  return {\n    draftDoc,\n    draftId,\n    getSnapshot,\n    publishedDoc,\n    publishedId,\n    /**\n     * @deprecated - use `getSnapshot` instead\n     */\n    get snapshot() {\n      // Maintain original error throwing behaviour, to avoid breaking changes\n      if (!snapshot) {\n        throw new Error(`Snapshot for document \"${id}\" not found`)\n      }\n      return snapshot\n    },\n  }\n}\n\nfunction createDocumentCommit<T extends Record<string, any>>(id: string, actor: MutatorActor) {\n  return (): void => {\n    const {draftDoc} = getDocumentsAndSnapshot<T>(id, actor)\n    draftDoc.send({type: 'submit'})\n  }\n}\n\n/**\n * @deprecated - superseded by `createDocumentGetSnapshot`\n */\nfunction createDocumentGet<T extends Record<string, any>>(id: string, actor: MutatorActor) {\n  return <P extends Path<T, keyof T>>(\n    path?: P,\n  ): PathValue<T, P> | SanityDocument<T> | undefined => {\n    const {snapshot} = getDocumentsAndSnapshot<T>(id, actor)\n\n    return path\n      ? (getAtPath(snapshot, path) as PathValue<T, P>)\n      : (snapshot as unknown as SanityDocument<T>)\n  }\n}\n\nfunction createDocumentGetSnapshot<T extends Record<string, any>>(\n  id: string,\n  actor: MutatorActor,\n): () => Promise<SanityDocument<T> | null> {\n  const {getSnapshot} = getDocumentsAndSnapshot<T>(id, actor)\n  return getSnapshot\n}\n\nfunction createDocumentPatch<T extends Record<string, any>>(id: string, actor: MutatorActor) {\n  return async (\n    patches: OptimisticDocumentPatches<T>,\n    options?: {commit?: boolean | {debounce: number}},\n  ): Promise<void> => {\n    // Destructure the function result in two steps as we need access to the\n    // `result.snapshot` property in the getter, but don't want to execute the\n    // getter prematurely as it may throw\n    const result = getDocumentsAndSnapshot<T>(id, actor)\n    const {draftDoc, draftId, getSnapshot, publishedId} = result\n\n    const {commit = true} = options || {}\n\n    const context = {\n      draftId,\n      publishedId,\n      /**\n       * @deprecated - use `getSnapshot` instead\n       */\n      get snapshot() {\n        return result.snapshot\n      },\n      getSnapshot,\n    }\n\n    const resolvedPatches = await (typeof patches === 'function' ? patches(context) : patches)\n\n    const _snapshot = await getSnapshot()\n\n    if (!_snapshot) {\n      throw new Error(`Snapshot for document \"${id}\" not found`)\n    }\n\n    draftDoc.send({\n      type: 'mutate',\n      mutations: [\n        // Attempt to create the draft document, it might not exist if the\n        // snapshot was from the published document\n        createIfNotExists({..._snapshot, _id: draftId}),\n        // Patch the draft document with the resolved patches\n        patch(draftId, resolvedPatches),\n      ],\n    })\n\n    if (commit) {\n      if (typeof commit === 'object' && 'debounce' in commit) {\n        const debouncedCommit = debounce(() => draftDoc.send({type: 'submit'}), commit.debounce)\n        debouncedCommit()\n      } else {\n        draftDoc.send({type: 'submit'})\n      }\n    }\n  }\n}\n\nexport function useDocuments(): {\n  getDocument: DocumentsGet\n  mutateDocument: DocumentsMutate\n} {\n  const actor = useOptimisticActor() as MutatorActor\n\n  const getDocument: DocumentsGet = useCallback(\n    <T extends Record<string, any>>(documentId: string) => {\n      return {\n        id: documentId,\n        commit: createDocumentCommit(documentId, actor),\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore - Type instantiation is excessively deep and possibly infinite.\n        get: createDocumentGet(documentId, actor),\n        getSnapshot: createDocumentGetSnapshot<T>(documentId, actor),\n        patch: createDocumentPatch<T>(documentId, actor),\n      }\n    },\n    [actor],\n  )\n\n  const mutateDocument: DocumentsMutate = useCallback(\n    (id, mutations, options) => {\n      const {draftDoc} = getDocumentsAndSnapshot(id, actor)\n      const {commit = true} = options || {}\n\n      draftDoc.send({\n        type: 'mutate',\n        mutations: mutations,\n      })\n\n      if (commit) {\n        if (typeof commit === 'object' && 'debounce' in commit) {\n          const debouncedCommit = debounce(() => draftDoc.send({type: 'submit'}), commit.debounce)\n          debouncedCommit()\n        } else {\n          draftDoc.send({type: 'submit'})\n        }\n      }\n    },\n    [actor],\n  )\n\n  return {getDocument, mutateDocument}\n}\n","import getRandomValues from 'get-random-values-esm'\n\n// WHATWG crypto RNG - https://w3c.github.io/webcrypto/Overview.html\nfunction whatwgRNG(length = 16) {\n  const rnds8 = new Uint8Array(length)\n  getRandomValues(rnds8)\n  return rnds8\n}\n\nconst getByteHexTable = (() => {\n  let table: string[]\n  return () => {\n    if (table) {\n      return table\n    }\n    table = []\n    for (let i = 0; i < 256; ++i) {\n      table[i] = (i + 0x100).toString(16).slice(1)\n    }\n    return table\n  }\n})()\n\nexport function randomKey(length?: number): string {\n  const table = getByteHexTable()\n  return whatwgRNG(length)\n    .reduce((str, n) => str + table[n], '')\n    .slice(0, length)\n}\n","import type {SanityDocument} from '@sanity/client'\nimport {at, insert, truncate, type NodePatchList} from '@sanity/mutate'\nimport type {SanityNode} from '@sanity/presentation-comlink'\nimport {get} from '@sanity/util/paths'\nimport type {OptimisticDocument} from '../optimistic/types'\nimport {randomKey} from './randomKey'\n\nexport function getArrayItemKeyAndParentPath(pathOrNode: string | SanityNode): {\n  path: string\n  key: string\n  hasExplicitKey: boolean\n} {\n  const elementPath = typeof pathOrNode === 'string' ? pathOrNode : pathOrNode.path\n\n  const lastDotIndex = elementPath.lastIndexOf('.')\n  const lastPathItem = elementPath.substring(lastDotIndex + 1, elementPath.length)\n\n  if (!lastPathItem.indexOf('[')) throw new Error('Invalid path: not an array')\n\n  const lastArrayIndex = elementPath.lastIndexOf('[')\n  const path = elementPath.substring(0, lastArrayIndex)\n\n  let key\n  let hasExplicitKey\n\n  if (lastPathItem.includes('_key')) {\n    // explicit [_key=\"...\"]\n\n    const startIndex = lastPathItem.indexOf('\"') + 1\n    const endIndex = lastPathItem.indexOf('\"', startIndex)\n\n    key = lastPathItem.substring(startIndex, endIndex)\n\n    hasExplicitKey = true\n  } else {\n    // indexes [int]\n    const startIndex = lastPathItem.indexOf('[') + 1\n    const endIndex = lastPathItem.indexOf(']', startIndex)\n\n    key = lastPathItem.substring(startIndex, endIndex)\n\n    hasExplicitKey = false\n  }\n\n  if (!path || !key) throw new Error('Invalid path')\n\n  return {\n    path,\n    key,\n    hasExplicitKey,\n  }\n}\n\nexport function getArrayDuplicatePatches(\n  node: SanityNode,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  snapshot: SanityDocument<Record<string, any>>,\n  position: 'before' | 'after' = 'after',\n): NodePatchList {\n  const {path: arrayPath, key: itemKey} = getArrayItemKeyAndParentPath(node)\n\n  const item = get(snapshot, node.path) as object\n  const duplicate = {...item, _key: randomKey()}\n\n  return [at(arrayPath, insert(duplicate, position, {_key: itemKey}))]\n}\n\nexport function getArrayRemovePatches(\n  node: SanityNode,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  snapshot: SanityDocument<Record<string, any>>,\n): NodePatchList {\n  const {path: arrayPath, key: itemKey} = getArrayItemKeyAndParentPath(node)\n  const array = get(snapshot, arrayPath) as {_key: string}[]\n  const currentIndex = array.findIndex((item) => item._key === itemKey)\n  return [at(arrayPath, truncate(currentIndex, currentIndex + 1))]\n}\n\nexport function getArrayInsertPatches(\n  node: SanityNode,\n  insertType: string,\n  position: 'before' | 'after',\n): NodePatchList {\n  const {path: arrayPath, key: itemKey} = getArrayItemKeyAndParentPath(node)\n  const insertKey = randomKey()\n  const referenceItem = {_key: itemKey}\n  return [at(arrayPath, insert([{_type: insertType, _key: insertKey}], position, referenceItem))]\n}\n\nexport async function getArrayMovePatches(\n  node: SanityNode,\n  doc: OptimisticDocument,\n  moveTo: 'previous' | 'next' | 'first' | 'last',\n): Promise<NodePatchList> {\n  if (!node.type) throw new Error('Node type is missing')\n  const {path: arrayPath, key: itemKey} = getArrayItemKeyAndParentPath(node)\n\n  const snapshot = await doc.getSnapshot()\n  const array = get(snapshot, arrayPath) as {_key: string}[]\n  const item = get(snapshot, node.path)\n  const currentIndex = array.findIndex((item) => item._key === itemKey)\n\n  let nextIndex = -1\n  let position: 'before' | 'after' = 'before'\n\n  if (moveTo === 'first') {\n    if (currentIndex === 0) return []\n    nextIndex = 0\n    position = 'before'\n  } else if (moveTo === 'last') {\n    if (currentIndex === array.length - 1) return []\n    nextIndex = -1\n    position = 'after'\n  } else if (moveTo === 'next') {\n    if (currentIndex === array.length - 1) return []\n    nextIndex = currentIndex\n    position = 'after'\n  } else if (moveTo === 'previous') {\n    if (currentIndex === 0) return []\n    nextIndex = currentIndex - 1\n    position = 'before'\n  }\n\n  return [\n    at(arrayPath, truncate(currentIndex, currentIndex + 1)),\n    at(arrayPath, insert(item, position, nextIndex)),\n  ]\n}\n"],"names":["reKeySegment","useOptimisticActor","useSyncExternalStore","_temp","_temp2","_temp3","emptyActor","actor","listener","listeners","add","delete","useOptimisticActorReady","t0","isEmptyActor","debounce","fn","timeout","timer","args","clearTimeout","setTimeout","apply","getDocumentsAndSnapshot","id","inFrame","isMaybePreviewIframe","inPopUp","isMaybePreviewWindow","Error","draftId","getDraftId","publishedId","getPublishedId","documents","getSnapshot","context","draftDoc","publishedDoc","doc","snapshot","local","snapshotPromise","Promise","resolve","subscriber","on","event","unsubscribe","createDocumentCommit","send","type","createDocumentGet","path","getAtPath","createDocumentGetSnapshot","createDocumentPatch","patches","options","result","commit","resolvedPatches","_snapshot","mutations","createIfNotExists","_id","patch","useDocuments","$","_c","documentId","get","getDocument","t1","t2","undefined","mutateDocument","whatwgRNG","length","rnds8","Uint8Array","getRandomValues","getByteHexTable","table","i","toString","slice","randomKey","reduce","str","n","getArrayItemKeyAndParentPath","pathOrNode","elementPath","lastDotIndex","lastIndexOf","lastPathItem","substring","indexOf","lastArrayIndex","key","hasExplicitKey","includes","startIndex","endIndex","getArrayDuplicatePatches","node","position","arrayPath","itemKey","duplicate","_key","at","insert","getArrayRemovePatches","currentIndex","findIndex","item","truncate","getArrayInsertPatches","insertType","insertKey","_type","getArrayMovePatches","moveTo","array","nextIndex"],"mappings":"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","ignoreList":[0,1,2,3,4,5],"debugId":null}},
    {"offset": {"line": 344, "column": 0}, "map": {"version":3,"file":"SharedStateContext.js","sources":["file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/react/useOptimistic.ts","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/node_modules/.pnpm/uuid%4011.1.0/node_modules/uuid/dist/esm-browser/stringify.js","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/node_modules/.pnpm/uuid%4011.1.0/node_modules/uuid/dist/esm-browser/rng.js","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/node_modules/.pnpm/uuid%4011.1.0/node_modules/uuid/dist/esm-browser/native.js","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/node_modules/.pnpm/uuid%4011.1.0/node_modules/uuid/dist/esm-browser/v4.js","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/util/geometry.ts","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/util/dragAndDrop.ts","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/util/elements.ts","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/util/stega.ts","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/util/findSanityNodes.ts","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/controller.ts","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/shared-state/SharedStateContext.ts"],"sourcesContent":["import {getPublishedId} from '@sanity/client/csm'\nimport type {SanityDocument} from '@sanity/types'\nimport {startTransition, useEffect, useState} from 'react'\nimport {useEffectEvent} from 'use-effect-event'\nimport {isEmptyActor} from '../optimistic/context'\nimport type {OptimisticReducer, OptimisticReducerAction} from '../optimistic/types'\nimport {useOptimisticActor} from './useOptimisticActor'\n\nexport function useOptimistic<T, U = SanityDocument>(\n  passthrough: T,\n  reducer: OptimisticReducer<T, U> | Array<OptimisticReducer<T, U>>,\n): T {\n  const [pristine, setPristine] = useState(true)\n  const [optimistic, setOptimistic] = useState<T>(passthrough)\n  const [lastEvent, setLastEvent] = useState<OptimisticReducerAction<U> | null>(null)\n  const [lastPassthrough, setLastPassthrough] = useState<T>(passthrough)\n\n  const actor = useOptimisticActor()\n\n  /**\n   * This action is used in two `useEffect` hooks, it needs access to the provided `reducer`,\n   * but doesn't want to cause re-renders if `reducer` changes identity.\n   * The `useEffectEvent` hook ensures that the `reducer` value is never stale when used, and doesn't trigger setup and teardown of\n   * `useEffect` deps to make it happen.\n   */\n  const reduceStateFromAction = useEffectEvent(\n    (action: OptimisticReducerAction<U>, prevState: T) => {\n      const reducers = Array.isArray(reducer) ? reducer : [reducer]\n      return reducers.reduce(\n        (acc, reducer) =>\n          reducer(acc, {\n            document: action.document,\n            id: getPublishedId(action.id),\n            originalId: action.id,\n            type: action.type,\n          }),\n        prevState,\n      )\n    },\n  )\n\n  /**\n   * Records the last passthrough value when reducers ran in response to a rebased event.\n   * This allows us to later know when reducers should run should the passthrough change.\n   */\n  const updateLastPassthrough = useEffectEvent(() => setLastPassthrough(passthrough))\n\n  /**\n   * Handle rebase events, which runs the provided reducers,\n   * caches the event that was used to produce the new state,\n   * and marks the state as non-pristine.\n   */\n  useEffect(() => {\n    // If the actor hasn't been set yet, we don't need to subscribe to mutations\n    if (isEmptyActor(actor)) {\n      return\n    }\n\n    /**\n     * The pristine event fires much too soon, so the temporary workaround is that we greatly delay firing `setPristine(true)`,\n     * and instead relying on re-running reducers with the last event whenever the passthrough changes, to preserve the optimistic state,\n     * until we hopefully have eventual consistency on the passthrough.\n     */\n    let pristineTimeout: ReturnType<typeof setTimeout>\n\n    const rebasedSub = actor.on('rebased.local', (_event) => {\n      const event = {\n        // @todo You shall not cast\n        document: _event.document as U,\n        id: _event.id,\n        originalId: getPublishedId(_event.id),\n        // @todo This should eventually be emitted by the state machine\n        type: 'mutate' as const,\n      }\n      setOptimistic((prevState) => reduceStateFromAction(event, prevState))\n      setLastEvent(event)\n      updateLastPassthrough()\n      setPristine(false)\n\n      clearTimeout(pristineTimeout)\n    })\n    const pristineSub = actor.on('pristine', () => {\n      pristineTimeout = setTimeout(() => {\n        // Marking it in a startTransition allows react to interrupt the resulting render, should a new rebase happen and we're back to dirty\n        startTransition(() => setPristine(true))\n      }, 15000)\n    })\n    return () => {\n      rebasedSub.unsubscribe()\n      pristineSub.unsubscribe()\n    }\n  }, [actor])\n\n  /**\n   * If the passthrough changes, and we are in a dirty state, we rerun the reducers with the new passthrough but the previous event.\n   * Marking it in a transition allows react to interrupt this render should a new action happen, or should we be back in a pristine state.\n   */\n  useEffect(() => {\n    if (pristine) {\n      // if we are pristine, then we will passthrough anyway\n      return undefined\n    }\n    if (!lastEvent) {\n      // If we don't have a lastEvent when we are pristine, it's a fatal error\n      throw new Error('No last event found when syncing passthrough')\n    }\n    if (lastPassthrough === passthrough) {\n      // If the passthrough hasn't changed, then we don't need to rerun the reducers\n      return undefined\n    }\n\n    // Marking it in a startTransition allows react to interrupt the resulting render, should a new rebase happen\n    startTransition(() => {\n      setOptimistic(reduceStateFromAction(lastEvent, passthrough))\n      setLastPassthrough(passthrough)\n    })\n  }, [lastEvent, lastPassthrough, passthrough, pristine])\n\n  return pristine ? passthrough : optimistic\n}\n","import validate from './validate.js';\nconst byteToHex = [];\nfor (let i = 0; i < 256; ++i) {\n    byteToHex.push((i + 0x100).toString(16).slice(1));\n}\nexport function unsafeStringify(arr, offset = 0) {\n    return (byteToHex[arr[offset + 0]] +\n        byteToHex[arr[offset + 1]] +\n        byteToHex[arr[offset + 2]] +\n        byteToHex[arr[offset + 3]] +\n        '-' +\n        byteToHex[arr[offset + 4]] +\n        byteToHex[arr[offset + 5]] +\n        '-' +\n        byteToHex[arr[offset + 6]] +\n        byteToHex[arr[offset + 7]] +\n        '-' +\n        byteToHex[arr[offset + 8]] +\n        byteToHex[arr[offset + 9]] +\n        '-' +\n        byteToHex[arr[offset + 10]] +\n        byteToHex[arr[offset + 11]] +\n        byteToHex[arr[offset + 12]] +\n        byteToHex[arr[offset + 13]] +\n        byteToHex[arr[offset + 14]] +\n        byteToHex[arr[offset + 15]]).toLowerCase();\n}\nfunction stringify(arr, offset = 0) {\n    const uuid = unsafeStringify(arr, offset);\n    if (!validate(uuid)) {\n        throw TypeError('Stringified UUID is invalid');\n    }\n    return uuid;\n}\nexport default stringify;\n","let getRandomValues;\nconst rnds8 = new Uint8Array(16);\nexport default function rng() {\n    if (!getRandomValues) {\n        if (typeof crypto === 'undefined' || !crypto.getRandomValues) {\n            throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n        }\n        getRandomValues = crypto.getRandomValues.bind(crypto);\n    }\n    return getRandomValues(rnds8);\n}\n","const randomUUID = typeof crypto !== 'undefined' && crypto.randomUUID && crypto.randomUUID.bind(crypto);\nexport default { randomUUID };\n","import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\nfunction v4(options, buf, offset) {\n    if (native.randomUUID && !buf && !options) {\n        return native.randomUUID();\n    }\n    options = options || {};\n    const rnds = options.random ?? options.rng?.() ?? rng();\n    if (rnds.length < 16) {\n        throw new Error('Random bytes length must be >= 16');\n    }\n    rnds[6] = (rnds[6] & 0x0f) | 0x40;\n    rnds[8] = (rnds[8] & 0x3f) | 0x80;\n    if (buf) {\n        offset = offset || 0;\n        if (offset < 0 || offset + 16 > buf.length) {\n            throw new RangeError(`UUID byte range ${offset}:${offset + 15} is out of buffer bounds`);\n        }\n        for (let i = 0; i < 16; ++i) {\n            buf[offset + i] = rnds[i];\n        }\n        return buf;\n    }\n    return unsafeStringify(rnds);\n}\nexport default v4;\n","import type {OverlayRect, Point2D, Ray2D} from '../types'\n\nexport function getRect(element: Element): OverlayRect {\n  const domRect = element.getBoundingClientRect()\n\n  const rect = {\n    x: domRect.x + scrollX,\n    y: domRect.y + scrollY,\n    w: domRect.width,\n    h: domRect.height,\n  }\n\n  return rect\n}\n\nexport function offsetRect(rect: OverlayRect, px: number, axis: 'x' | 'y'): OverlayRect {\n  if (axis === 'x') {\n    return {\n      x: rect.x + px,\n      y: rect.y,\n      w: rect.w - 2 * px,\n      h: rect.h,\n    }\n  } else {\n    return {\n      x: rect.x,\n      y: rect.y + px,\n      w: rect.w,\n      h: rect.h - 2 * px,\n    }\n  }\n}\n\n// Ref http://paulbourke.net/geometry/pointlineplane/\nexport function rayIntersect(l1: Ray2D, l2: Ray2D): Point2D | false {\n  const {x1, y1, x2, y2} = l1\n  const {x1: x3, y1: y3, x2: x4, y2: y4} = l2\n\n  // Check if none of the lines are of length 0\n  if ((x1 === x2 && y1 === y2) || (x3 === x4 && y3 === y4)) {\n    return false\n  }\n\n  const denominator = (y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1)\n\n  // Lines are parallel\n  if (denominator === 0) {\n    return false\n  }\n\n  const ua = ((x4 - x3) * (y1 - y3) - (y4 - y3) * (x1 - x3)) / denominator\n  const ub = ((x2 - x1) * (y1 - y3) - (y2 - y1) * (x1 - x3)) / denominator\n\n  // is the intersection along the segments\n  if (ua < 0 || ua > 1 || ub < 0 || ub > 1) {\n    return false\n  }\n\n  const x = x1 + ua * (x2 - x1)\n  const y = y1 + ua * (y2 - y1)\n\n  return {x, y}\n}\n\nexport function rectEqual(r1: OverlayRect, r2: OverlayRect): boolean {\n  return r1.x === r2.x && r1.y === r2.y && r1.w === r2.w && r1.h === r2.h\n}\n\nexport function rayRectIntersections(line: Ray2D, rect: OverlayRect): Array<Point2D> | false {\n  const rectLines: Array<Ray2D> = [\n    {x1: rect.x, y1: rect.y, x2: rect.x + rect.w, y2: rect.y},\n    {\n      x1: rect.x + rect.w,\n      y1: rect.y,\n      x2: rect.x + rect.w,\n      y2: rect.y + rect.h,\n    },\n    {\n      x1: rect.x + rect.w,\n      y1: rect.y + rect.h,\n      x2: rect.x,\n      y2: rect.y + rect.h,\n    },\n    {\n      x1: rect.x,\n      y1: rect.y + rect.h,\n      x2: rect.x,\n      y2: rect.y,\n    },\n  ]\n\n  const intersections: Array<Point2D> = []\n\n  for (let i = 0; i < rectLines.length; i++) {\n    const intersection = rayIntersect(line, rectLines[i])\n\n    if (intersection) {\n      let isDuplicate = false\n\n      for (let j = 0; j < intersections.length; j++) {\n        if (intersections[j].x === intersection.x && intersections[j].y === intersection.y) {\n          isDuplicate = true\n        }\n      }\n\n      if (!isDuplicate) intersections.push(intersection)\n    }\n  }\n\n  if (intersections.length === 0) {\n    return false\n  }\n\n  return intersections.sort(\n    (a, b) => pointDist(a, {x: line.x1, y: line.y1}) - pointDist(b, {x: line.x1, y: line.y1}),\n  )\n}\nexport function pointDist(p1: Point2D, p2: Point2D): number {\n  const a = p1.x - p2.x\n  const b = p1.y - p2.y\n\n  return Math.sqrt(a * a + b * b)\n}\n\nexport function pointInBounds(point: Point2D, bounds: OverlayRect): boolean {\n  const withinX = point.x >= bounds.x && point.x <= bounds.x + bounds.w\n  const withinY = point.y >= bounds.y && point.y <= bounds.y + bounds.h\n\n  return withinX && withinY\n}\n\nexport function findClosestIntersection(\n  ray: Ray2D,\n  targets: OverlayRect[],\n  flow: string,\n): OverlayRect | null {\n  const rayOrigin = {\n    x: ray.x1,\n    y: ray.y1,\n  }\n\n  // Offset rects to ensure raycasting works when siblings touch\n  if (\n    targets.some((t) =>\n      pointInBounds(\n        rayOrigin,\n        offsetRect(t, Math.min(t.w, t.h) / 10, flow === 'horizontal' ? 'x' : 'y'),\n      ),\n    )\n  )\n    return null\n  let closestIntersection\n  let closestRect\n\n  for (const target of targets) {\n    const intersections = rayRectIntersections(\n      ray,\n      offsetRect(target, Math.min(target.w, target.h) / 10, flow === 'horizontal' ? 'x' : 'y'),\n    )\n    if (intersections) {\n      const firstIntersection = intersections[0]\n\n      if (closestIntersection) {\n        if (pointDist(rayOrigin, firstIntersection) < pointDist(rayOrigin, closestIntersection)) {\n          closestIntersection = firstIntersection\n          closestRect = target\n        }\n      } else {\n        closestIntersection = firstIntersection\n        closestRect = target\n      }\n    }\n  }\n\n  if (closestRect) return closestRect\n\n  return null\n}\n\nexport function scaleRect(\n  rect: OverlayRect,\n  scale: number,\n  origin: {x: number; y: number},\n): OverlayRect {\n  const {x, y, w, h} = rect\n  const {x: originX, y: originY} = origin\n\n  const newX = originX + (x - originX) * scale\n  const newY = originY + (y - originY) * scale\n\n  const newWidth = w * scale\n  const newHeight = h * scale\n\n  return {\n    x: newX,\n    y: newY,\n    w: newWidth,\n    h: newHeight,\n  }\n}\n\nexport function getRectGroupXExtent(rects: OverlayRect[]): {\n  min: number\n  max: number\n  width: number\n} {\n  const minGroupX = Math.max(0, Math.min(...rects.map((r) => r.x)))\n  const maxGroupX = Math.min(document.body.offsetWidth, Math.max(...rects.map((r) => r.x + r.w)))\n\n  return {\n    min: minGroupX,\n    max: maxGroupX,\n    width: maxGroupX - minGroupX,\n  }\n}\n\nexport function getRectGroupYExtent(rects: OverlayRect[]): {\n  min: number\n  max: number\n  height: number\n} {\n  const minGroupY = Math.max(0, Math.min(...rects.map((r) => r.y)))\n  const maxGroupY = Math.min(document.body.scrollHeight, Math.max(...rects.map((r) => r.y + r.h)))\n\n  return {\n    min: minGroupY,\n    max: maxGroupY,\n    height: maxGroupY - minGroupY,\n  }\n}\n","import type {\n  DragInsertPosition,\n  DragInsertPositionRects,\n  ElementNode,\n  OverlayElement,\n  OverlayEventHandler,\n  OverlayRect,\n  Point2D,\n  SanityNode,\n} from '../types'\nimport {\n  findClosestIntersection,\n  getRect,\n  getRectGroupXExtent,\n  getRectGroupYExtent,\n  pointDist,\n  rectEqual,\n  scaleRect,\n} from './geometry'\n\nfunction calcTargetFlow(targets: OverlayRect[]) {\n  if (\n    targets.some((t1) => {\n      const others = targets.filter((t2) => !rectEqual(t1, t2))\n\n      return others.some((t2) => {\n        return t1.y === t2.y\n      })\n    })\n  ) {\n    return 'horizontal'\n  } else {\n    return 'vertical'\n  }\n}\n\nfunction calcInsertPosition(origin: Point2D, targets: OverlayRect[], flow: string) {\n  if (flow === 'horizontal') {\n    const rayLeft = {\n      x1: origin.x,\n      y1: origin.y,\n      x2: origin.x - 100_000_000,\n      y2: origin.y,\n    }\n\n    const rayRight = {\n      x1: origin.x,\n      y1: origin.y,\n      x2: origin.x + 100_000_000,\n      y2: origin.y,\n    }\n\n    return {\n      left: findClosestIntersection(rayLeft, targets, flow),\n      right: findClosestIntersection(rayRight, targets, flow),\n    }\n  } else {\n    const rayTop = {\n      x1: origin.x,\n      y1: origin.y,\n      x2: origin.x,\n      y2: origin.y - 100_000_000,\n    }\n\n    const rayBottom = {\n      x1: origin.x,\n      y1: origin.y,\n      x2: origin.x,\n      y2: origin.y + 100_000_000,\n    }\n\n    return {\n      top: findClosestIntersection(rayTop, targets, flow),\n      bottom: findClosestIntersection(rayBottom, targets, flow),\n    }\n  }\n}\n\nfunction findRectSanityData(rect: OverlayRect, overlayGroup: OverlayElement[]) {\n  return overlayGroup.find((e) => rectEqual(getRect(e.elements.element), rect))\n    ?.sanity as SanityNode\n}\n\nfunction resolveInsertPosition(\n  overlayGroup: OverlayElement[],\n  insertPosition: DragInsertPositionRects,\n  flow: string,\n): DragInsertPosition {\n  if (Object.values(insertPosition).every((v) => v === null)) return null\n\n  if (flow === 'horizontal') {\n    return {\n      left: insertPosition.left\n        ? {\n            rect: insertPosition.left,\n            sanity: findRectSanityData(insertPosition.left, overlayGroup),\n          }\n        : null,\n      right: insertPosition.right\n        ? {\n            rect: insertPosition.right,\n            sanity: findRectSanityData(insertPosition.right, overlayGroup),\n          }\n        : null,\n    }\n  } else {\n    return {\n      top: insertPosition.top\n        ? {\n            rect: insertPosition.top,\n            sanity: findRectSanityData(insertPosition.top, overlayGroup),\n          }\n        : null,\n      bottom: insertPosition.bottom\n        ? {\n            rect: insertPosition.bottom,\n            sanity: findRectSanityData(insertPosition.bottom, overlayGroup),\n          }\n        : null,\n    }\n  }\n}\n\nfunction calcMousePos(e: MouseEvent) {\n  const bodyBounds = document.body.getBoundingClientRect()\n\n  return {\n    x: Math.max(bodyBounds.x, Math.min(e.clientX, bodyBounds.x + bodyBounds.width)),\n    y: e.clientY + window.scrollY,\n  }\n}\n\nfunction calcMousePosInverseTransform(mousePos: Point2D) {\n  const body = document.body\n  const computedStyle = window.getComputedStyle(body)\n  const transform = computedStyle.transform\n\n  if (transform === 'none') {\n    return {\n      x: mousePos.x,\n      y: mousePos.y,\n    }\n  }\n\n  const matrix = new DOMMatrix(transform)\n  const inverseMatrix = matrix.inverse()\n\n  const point = new DOMPoint(mousePos.x, mousePos.y)\n  const transformedPoint = point.matrixTransform(inverseMatrix)\n\n  return {\n    x: transformedPoint.x,\n    y: transformedPoint.y,\n  }\n}\n\nfunction buildPreviewSkeleton(mousePos: Point2D, element: ElementNode, scaleFactor: number) {\n  const bounds = getRect(element)\n\n  const children = [\n    ...element.querySelectorAll(':where(h1, h2, h3, h4, p, a, img, span, button):not(:has(*))'),\n  ]\n\n  if (mousePos.x <= bounds.x) mousePos.x = bounds.x\n  if (mousePos.x >= bounds.x + bounds.w) mousePos.x = bounds.x + bounds.w\n\n  if (mousePos.y >= bounds.y + bounds.h) mousePos.y = bounds.y + bounds.h\n  if (mousePos.y <= bounds.y) mousePos.y = bounds.y\n\n  const childRects = children.map((child: Element) => {\n    // offset to account for stroke in rendered rects\n    const rect = scaleRect(getRect(child), scaleFactor, {\n      x: bounds.x,\n      y: bounds.y,\n    })\n\n    return {\n      x: rect.x - bounds.x,\n      y: rect.y - bounds.y,\n      w: rect.w,\n      h: rect.h,\n      tagName: child.tagName,\n    }\n  })\n\n  return {\n    offsetX: (bounds.x - mousePos.x) * scaleFactor,\n    offsetY: (bounds.y - mousePos.y) * scaleFactor,\n    w: bounds.w * scaleFactor,\n    h: bounds.h * scaleFactor,\n    maxWidth: bounds.w * scaleFactor * 0.75,\n    childRects,\n  }\n}\n\nconst minDragDelta = 4\n\nasync function applyMinimapWrapperTransform(\n  target: HTMLElement,\n  scaleFactor: number,\n  minYScaled: number,\n  handler: OverlayEventHandler,\n  rectUpdateFrequency: number,\n): Promise<void> {\n  return new Promise((resolve) => {\n    target.addEventListener(\n      'transitionend',\n      () => {\n        setTimeout(() => {\n          handler({\n            type: 'overlay/dragEndMinimapTransition',\n          })\n        }, rectUpdateFrequency * 2)\n\n        resolve()\n      },\n      {once: true},\n    )\n\n    handler({\n      type: 'overlay/dragStartMinimapTransition',\n    })\n\n    handler({\n      type: 'overlay/dragToggleMinimap',\n      display: true,\n    })\n\n    document.body.style.overflow = 'hidden'\n    document.body.style.height = '100%'\n    document.documentElement.style.overflow = 'initial'\n    document.documentElement.style.height = '100%'\n\n    // ensure overflow hidden has applied and scrolling stopped before applying transform, prevent minor y-position transform issues\n    setTimeout(() => {\n      target.style.transformOrigin = '50% 0px'\n      target.style.transition = 'transform 150ms ease'\n      target.style.transform = `translate3d(0px, ${-minYScaled + scrollY}px, 0px) scale(${scaleFactor})`\n    }, 25)\n  })\n}\n\nfunction calcMinimapTransformValues(rects: OverlayRect[], groupHeightOverride: number | null) {\n  let groupHeight = groupHeightOverride || getRectGroupYExtent(rects).height\n\n  const padding = 100 // px\n\n  groupHeight += padding * 2\n\n  const scaleFactor = groupHeight > window.innerHeight ? window.innerHeight / groupHeight : 1\n  const scaledRects = rects.map((r) => scaleRect(r, scaleFactor, {x: window.innerWidth / 2, y: 0}))\n\n  const {min: minYScaled} = getRectGroupYExtent(scaledRects)\n\n  return {\n    scaleFactor,\n    minYScaled: minYScaled - padding * scaleFactor,\n  }\n}\nfunction calcGroupBoundsPreview(rects: OverlayRect[]) {\n  const groupBoundsX = getRectGroupXExtent(rects)\n  const groupBoundsY = getRectGroupYExtent(rects)\n\n  const offsetDist = 8\n\n  const canOffsetX =\n    groupBoundsX.min > offsetDist &&\n    groupBoundsX.min + groupBoundsX.width <= window.innerWidth - offsetDist\n  const canOffsetY =\n    groupBoundsY.min > offsetDist &&\n    groupBoundsY.min + groupBoundsY.height <= document.body.scrollHeight - offsetDist\n  const canOffset = canOffsetX && canOffsetY\n\n  const groupRect = {\n    x: canOffset ? groupBoundsX.min - offsetDist : groupBoundsX.min,\n    y: canOffset ? groupBoundsY.min - offsetDist : groupBoundsY.min,\n    w: canOffset ? groupBoundsX.width + offsetDist * 2 : groupBoundsX.width,\n    h: canOffset ? groupBoundsY.height + offsetDist * 2 : groupBoundsY.height,\n  }\n\n  return groupRect\n}\n\nasync function resetMinimapWrapperTransform(\n  endYOrigin: number,\n  target: HTMLElement,\n  prescaleHeight: number,\n  handler: OverlayEventHandler,\n  rectUpdateFrequency: number,\n  previousRootStyleValues: PreviousRootStyleValues | null,\n): Promise<void> {\n  return new Promise((resolve) => {\n    const computedStyle = window.getComputedStyle(target)\n    const transform = computedStyle.transform\n\n    const matrix = new DOMMatrix(transform)\n\n    const scale = matrix.a\n\n    if (scale === 1) return\n\n    const maxScroll = prescaleHeight - window.innerHeight\n    const prevScrollY = scrollY\n\n    endYOrigin -= window.innerHeight / 2\n\n    if (endYOrigin < 0) endYOrigin = 0\n\n    target.addEventListener(\n      'transitionend',\n      () => {\n        target.style.transition = `none`\n        target.style.transform = `none`\n\n        scrollTo({\n          top: endYOrigin,\n          behavior: 'instant',\n        })\n\n        setTimeout(() => {\n          handler({\n            type: 'overlay/dragEndMinimapTransition',\n          })\n\n          handler({\n            type: 'overlay/dragToggleMinimap',\n            display: false,\n          })\n        }, rectUpdateFrequency * 2)\n\n        resolve()\n      },\n      {once: true},\n    )\n\n    handler({\n      type: 'overlay/dragStartMinimapTransition',\n    })\n\n    target.style.transform = `translateY(${Math.max(prevScrollY - endYOrigin, -maxScroll + prevScrollY)}px) scale(${1})`\n\n    if (!previousRootStyleValues) return\n\n    document.body.style.overflow = previousRootStyleValues.body.overflow\n    document.body.style.height = previousRootStyleValues.body.height\n    document.documentElement.style.overflow = previousRootStyleValues.documentElement.overflow\n    document.documentElement.style.height = previousRootStyleValues.documentElement.height\n  })\n}\n\ninterface PreviousRootStyleValues {\n  body: {\n    overflow: string\n    height: string\n  }\n  documentElement: {\n    overflow: string\n    height: string\n  }\n}\n\ninterface HandleOverlayDragOpts {\n  mouseEvent: MouseEvent\n  element: ElementNode\n  overlayGroup: OverlayElement[]\n  handler: OverlayEventHandler\n  target: SanityNode\n  onSequenceStart: () => void\n  onSequenceEnd: () => void\n}\n\nlet minimapScaleApplied = false\n\nlet mousePosInverseTransform = {x: 0, y: 0}\nlet mousePos = {x: 0, y: 0}\n\nlet prescaleHeight = typeof document === 'undefined' ? 0 : document.documentElement.scrollHeight\n\nlet previousRootStyleValues: PreviousRootStyleValues | null = null\n\nexport function handleOverlayDrag(opts: HandleOverlayDragOpts): void {\n  const {mouseEvent, element, overlayGroup, handler, target, onSequenceStart, onSequenceEnd} = opts\n\n  // do not trigger drag sequence on anything other than \"main\" (0) click, ignore right click, etc\n  if (mouseEvent.button !== 0) return\n\n  // ensure keyboard events fire within frame context\n  window.focus()\n\n  const rectUpdateFrequency = 150\n  let rects = overlayGroup.map((e) => getRect(e.elements.element))\n\n  const flow = (element.getAttribute('data-sanity-drag-flow') || calcTargetFlow(rects)) as\n    | 'horizontal'\n    | 'vertical'\n\n  const dragGroup = element.getAttribute('data-sanity-drag-group')\n\n  const disableMinimap = !!element.getAttribute('data-sanity-drag-minimap-disable')\n\n  const preventInsertDefault = !!element.getAttribute('data-sanity-drag-prevent-default')\n\n  const documentHeightOverride = element.getAttribute('data-unstable_sanity-drag-document-height')\n  const groupHeightOverride = element.getAttribute('data-unstable_sanity-drag-group-height')\n\n  let insertPosition: DragInsertPositionRects | null = null\n\n  const initialMousePos = calcMousePos(mouseEvent)\n\n  const scaleTarget = document.body\n\n  const {minYScaled, scaleFactor} = calcMinimapTransformValues(\n    rects,\n    groupHeightOverride ? ~~groupHeightOverride : null,\n  )\n\n  let sequenceStarted = false\n  let minimapPromptShown = false\n\n  let mousedown = true\n\n  if (!minimapScaleApplied) {\n    previousRootStyleValues = {\n      body: {\n        overflow: window.getComputedStyle(document.body).overflow,\n        height: window.getComputedStyle(document.body).height,\n      },\n      documentElement: {\n        overflow: window.getComputedStyle(document.documentElement).overflow,\n        height: window.getComputedStyle(document.documentElement).height,\n      },\n    }\n\n    prescaleHeight = documentHeightOverride\n      ? ~~documentHeightOverride\n      : document.documentElement.scrollHeight\n  }\n\n  const rectsInterval = setInterval(() => {\n    rects = overlayGroup.map((e) => getRect(e.elements.element))\n  }, rectUpdateFrequency)\n\n  const applyMinimap = (): void => {\n    if (scaleFactor >= 1) return\n\n    const skeleton = buildPreviewSkeleton(mousePos, element, scaleFactor)\n\n    handler({\n      type: 'overlay/dragUpdateSkeleton',\n      skeleton,\n    })\n\n    handler({\n      type: 'overlay/dragToggleMinimapPrompt',\n      display: false,\n    })\n\n    applyMinimapWrapperTransform(\n      scaleTarget,\n      scaleFactor,\n      minYScaled,\n      handler,\n      rectUpdateFrequency,\n    ).then(() => {\n      setTimeout(() => {\n        handler({\n          type: 'overlay/dragUpdateGroupRect',\n          groupRect: calcGroupBoundsPreview(rects),\n        })\n      }, rectUpdateFrequency * 2)\n    })\n  }\n\n  const handleScroll = (e: WheelEvent) => {\n    if (\n      Math.abs(e.deltaY) >= 10 &&\n      scaleFactor < 1 &&\n      !minimapScaleApplied &&\n      !minimapPromptShown &&\n      !disableMinimap &&\n      mousedown\n    ) {\n      handler({\n        type: 'overlay/dragToggleMinimapPrompt',\n        display: true,\n      })\n\n      minimapPromptShown = true\n    }\n\n    if (e.shiftKey && !minimapScaleApplied && !disableMinimap) {\n      window.dispatchEvent(new CustomEvent('unstable_sanity/dragApplyMinimap'))\n\n      minimapScaleApplied = true\n\n      setTimeout(() => {\n        applyMinimap()\n      }, 50)\n    }\n  }\n\n  const handleMouseMove = (e: MouseEvent): void => {\n    e.preventDefault()\n\n    mousePos = calcMousePos(e)\n    mousePosInverseTransform = calcMousePosInverseTransform(mousePos)\n\n    if (Math.abs(pointDist(mousePos, initialMousePos)) < minDragDelta) return\n\n    if (!sequenceStarted) {\n      const groupRect = calcGroupBoundsPreview(rects)\n\n      const skeleton = buildPreviewSkeleton(mousePos, element, 1)\n\n      handler({\n        type: 'overlay/dragStart',\n        flow,\n      })\n\n      handler({\n        type: 'overlay/dragUpdateSkeleton',\n        skeleton,\n      })\n\n      handler({\n        type: 'overlay/dragUpdateGroupRect',\n        groupRect,\n      })\n\n      sequenceStarted = true\n      onSequenceStart()\n    }\n\n    handler({\n      type: 'overlay/dragUpdateCursorPosition',\n      x: mousePos.x,\n      y: mousePos.y,\n    })\n\n    if (e.shiftKey && !minimapScaleApplied && !disableMinimap) {\n      window.dispatchEvent(new CustomEvent('unstable_sanity/dragApplyMinimap'))\n\n      minimapScaleApplied = true\n\n      setTimeout(() => {\n        applyMinimap()\n      }, 50)\n    }\n\n    const newInsertPosition = calcInsertPosition(mousePos, rects, flow)\n\n    if (JSON.stringify(insertPosition) !== JSON.stringify(newInsertPosition)) {\n      insertPosition = newInsertPosition\n\n      handler({\n        type: 'overlay/dragUpdateInsertPosition',\n        insertPosition: resolveInsertPosition(overlayGroup, insertPosition, flow),\n      })\n    }\n  }\n\n  const handleMouseUp = (): void => {\n    mousedown = false\n\n    handler({\n      type: 'overlay/dragEnd',\n      target,\n      insertPosition: insertPosition\n        ? resolveInsertPosition(overlayGroup, insertPosition, flow)\n        : null,\n      dragGroup,\n      flow,\n      preventInsertDefault,\n    })\n\n    if (minimapPromptShown) {\n      handler({\n        type: 'overlay/dragToggleMinimapPrompt',\n        display: false,\n      })\n    }\n\n    if (!minimapScaleApplied) {\n      clearInterval(rectsInterval)\n      onSequenceEnd()\n\n      removeFrameListeners()\n      removeKeyListeners()\n    }\n\n    removeMouseListeners()\n  }\n\n  const handleKeyup = (e: KeyboardEvent) => {\n    if (e.key === 'Shift' && minimapScaleApplied) {\n      minimapScaleApplied = false\n\n      const skeleton = buildPreviewSkeleton(mousePos, element, 1 / scaleFactor)\n\n      handler({\n        type: 'overlay/dragUpdateSkeleton',\n        skeleton,\n      })\n\n      window.dispatchEvent(new CustomEvent('unstable_sanity/dragResetMinimap'))\n\n      setTimeout(() => {\n        resetMinimapWrapperTransform(\n          mousePosInverseTransform.y,\n          scaleTarget,\n          prescaleHeight,\n          handler,\n          rectUpdateFrequency,\n          previousRootStyleValues,\n        )\n      }, 50)\n\n      handler({\n        type: 'overlay/dragUpdateGroupRect',\n        groupRect: null,\n      })\n\n      // cleanup keyup after drag sequence is complete\n      if (!mousedown) {\n        clearInterval(rectsInterval)\n\n        removeMouseListeners()\n        removeFrameListeners()\n        removeKeyListeners()\n\n        onSequenceEnd()\n      }\n    }\n  }\n\n  const handleBlur = () => {\n    handler({\n      type: 'overlay/dragUpdateGroupRect',\n      groupRect: null,\n    })\n\n    window.dispatchEvent(new CustomEvent('unstable_sanity/dragResetMinimap'))\n\n    setTimeout(() => {\n      resetMinimapWrapperTransform(\n        mousePosInverseTransform.y,\n        scaleTarget,\n        prescaleHeight,\n        handler,\n        rectUpdateFrequency,\n        previousRootStyleValues,\n      ).then(() => {\n        minimapScaleApplied = false\n      })\n    }, 50)\n\n    clearInterval(rectsInterval)\n\n    removeMouseListeners()\n    removeFrameListeners()\n    removeKeyListeners()\n\n    onSequenceEnd()\n  }\n\n  const removeMouseListeners = () => {\n    window.removeEventListener('mousemove', handleMouseMove)\n    window.removeEventListener('wheel', handleScroll)\n    window.removeEventListener('mouseup', handleMouseUp)\n  }\n\n  const removeKeyListeners = () => {\n    window.removeEventListener('keyup', handleKeyup)\n  }\n\n  const removeFrameListeners = () => {\n    window.removeEventListener('blur', handleBlur)\n  }\n\n  window.addEventListener('blur', handleBlur)\n  window.addEventListener('keyup', handleKeyup)\n  window.addEventListener('wheel', handleScroll)\n  window.addEventListener('mousemove', handleMouseMove)\n  window.addEventListener('mouseup', handleMouseUp)\n}\n","import type {ElementNode} from '../types'\n\nexport const isElementNode = (target: EventTarget | null): target is ElementNode => {\n  return target instanceof HTMLElement || target instanceof SVGElement\n}\n\nexport function findNonInlineElement(element: ElementNode): ElementNode | null {\n  const {display} = window.getComputedStyle(element)\n\n  if (display !== 'inline') return element\n\n  const parent = element.parentElement\n\n  if (!parent) return null\n\n  return findNonInlineElement(parent)\n}\n\nexport const findOverlayElement = (\n  el: EventTarget | ElementNode | null | undefined,\n): ElementNode | null => {\n  if (!el || !isElementNode(el)) {\n    return null\n  }\n\n  if (el.dataset?.['sanityOverlayElement']) {\n    return el\n  }\n\n  return findOverlayElement(el.parentElement)\n}\n","import type {SanityStegaNode} from '@sanity/presentation-comlink'\nimport {vercelStegaDecode} from '@vercel/stega'\nimport {VERCEL_STEGA_REGEX} from '../constants'\n\n/**\n * JavaScript regexps are stateful. Have to reset lastIndex between runs to ensure consistent behaviour for the same string\n * @param input\n */\nexport function testVercelStegaRegex(input: string): boolean {\n  VERCEL_STEGA_REGEX.lastIndex = 0\n  return VERCEL_STEGA_REGEX.test(input)\n}\n\nfunction decodeStega(str: string, isAltText = false): SanityStegaNode | null {\n  try {\n    const decoded = vercelStegaDecode<SanityStegaNode>(str)\n    if (!decoded || decoded.origin !== 'sanity.io') {\n      return null\n    }\n    if (isAltText) {\n      decoded.href = decoded.href?.replace('.alt', '')\n    }\n    return decoded\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.error('Failed to decode stega for string: ', str, 'with the original error: ', err)\n    return null\n  }\n}\n\nexport function testAndDecodeStega(str: string, isAltText = false): SanityStegaNode | null {\n  if (testVercelStegaRegex(str)) {\n    return decodeStega(str, isAltText)\n  }\n  return null\n}\n","import {decodeSanityNodeData} from '@sanity/visual-editing-csm'\nimport type {\n  ElementNode,\n  OverlayElement,\n  ResolvedElement,\n  ResolvedElementReason,\n  ResolvedElementTarget,\n  ResolvingElement,\n  SanityNode,\n  SanityStegaNode,\n} from '../types'\nimport {findNonInlineElement} from './elements'\nimport {testAndDecodeStega, testVercelStegaRegex} from './stega'\n\nconst isElementNode = (node: ChildNode): node is ElementNode => node.nodeType === Node.ELEMENT_NODE\n\nconst isImgElement = (el: ElementNode): el is HTMLImageElement => el.tagName === 'IMG'\n\nconst isTimeElement = (el: ElementNode): el is HTMLTimeElement => el.tagName === 'TIME'\n\nconst isSvgRootElement = (el: ElementNode): el is SVGSVGElement =>\n  el.tagName.toUpperCase() === 'SVG'\n\nexport function isSanityNode(node: SanityNode | SanityStegaNode): node is SanityNode {\n  return 'path' in node\n}\n\n/**\n * Finds commonality between two document paths strings\n * @param first First path to compare\n * @param second Second path to compare\n * @returns A common path\n */\nexport function findCommonPath(first: string, second: string): string {\n  let firstParts = first.split('.')\n  let secondParts = second.split('.')\n  const maxLength = Math.min(firstParts.length, secondParts.length)\n  firstParts = firstParts.slice(0, maxLength).reverse()\n  secondParts = secondParts.slice(0, maxLength).reverse()\n\n  return firstParts\n    .reduce((parts, part, i) => (part === secondParts[i] ? [...parts, part] : []), [] as string[])\n    .reverse()\n    .join('.')\n}\n\n/**\n * Returns common Sanity node data from multiple nodes\n * If document paths are present, tries to resolve a common path\n * @param nodes An array of Sanity nodes\n * @returns A single sanity node or undefined\n * @internal\n */\nexport function findCommonSanityData(\n  nodes: (SanityNode | SanityStegaNode)[],\n): SanityNode | SanityStegaNode | undefined {\n  // If there are no nodes, or inconsistent node types\n  if (!nodes.length || !nodes.map((n) => isSanityNode(n)).every((n, _i, arr) => n === arr[0])) {\n    return undefined\n  }\n  // If legacy nodes, return first match (no common pathfinding)\n  if (!isSanityNode(nodes[0])) return nodes[0]\n\n  const sanityNodes = nodes.filter(isSanityNode)\n  let common: SanityNode | undefined = nodes[0]\n\n  const consistentValueKeys: Array<keyof SanityNode> = [\n    'projectId',\n    'dataset',\n    'id',\n    'baseUrl',\n    'workspace',\n    'tool',\n  ]\n  for (let i = 1; i < sanityNodes.length; i++) {\n    const node = sanityNodes[i]\n    if (consistentValueKeys.some((key) => node[key] !== common?.[key])) {\n      common = undefined\n      break\n    }\n\n    common = {...common, path: findCommonPath(common.path, node.path)}\n  }\n\n  return common\n}\n\n/**\n * Finds nodes containing sanity specific data\n * @param el - A parent element to traverse\n * @returns An array of overlay targets\n * @internal\n */\nexport function findSanityNodes(\n  el: ElementNode | ChildNode | {childNodes: Array<ElementNode>},\n): ResolvedElement[] {\n  const mainResults: Omit<ResolvedElement, 'commonSanity'>[] = []\n\n  function createResolvedElement(\n    element: ElementNode,\n    data: SanityStegaNode | string,\n    reason: ResolvedElementReason,\n    preventGrouping?: boolean,\n  ): ResolvingElement | undefined {\n    const sanity = decodeSanityNodeData(data)\n\n    if (!sanity) {\n      return\n    }\n\n    // resize observer does not fire for non-replaced inline elements https://drafts.csswg.org/resize-observer/#intro\n    const measureElement = findNonInlineElement(element)\n    if (!measureElement) {\n      return\n    }\n\n    return {\n      elements: {\n        element,\n        measureElement,\n      },\n      sanity,\n      reason,\n      preventGrouping,\n    }\n  }\n\n  function resolveNode(node: ChildNode): ResolvingElement | undefined {\n    const {nodeType, parentElement, textContent} = node\n    // If an edit target is found, find common paths\n    if (isElementNode(node) && node.dataset?.['sanityEditTarget'] !== undefined) {\n      const nodesInTarget = findSanityNodes(node)\n      const commonData = findCommonSanityData(\n        nodesInTarget\n          .map((node) => (node.type === 'element' ? node.commonSanity : undefined))\n          .filter((n) => n !== undefined),\n      )\n      if (commonData) {\n        return {\n          reason: 'edit-target',\n          elements: {\n            element: node,\n            measureElement: node,\n          },\n          sanity: commonData,\n        }\n      }\n\n      // Check non-empty, child-only text nodes for stega strings\n    } else if (nodeType === Node.TEXT_NODE && parentElement && textContent) {\n      const data = testAndDecodeStega(textContent)\n      if (!data) return\n      return createResolvedElement(parentElement, data, 'stega-text', true)\n    }\n    // Check element nodes for data attributes, alt tags, etc\n    else if (isElementNode(node)) {\n      // Do not traverse script tags\n      // Do not traverse the visual editing overlay\n      if (node.tagName === 'SCRIPT' || node.tagName === 'SANITY-VISUAL-EDITING') {\n        return\n      }\n\n      // Prefer elements with explicit data attributes\n      if (node.dataset?.['sanity']) {\n        return createResolvedElement(\n          node,\n          node.dataset['sanity'],\n          'data-attribute',\n          Boolean(node.textContent && testVercelStegaRegex(node.textContent)),\n        )\n      }\n      // Look for legacy sanity data attributes\n      else if (node.dataset?.['sanityEditInfo']) {\n        return createResolvedElement(\n          node,\n          node.dataset['sanityEditInfo'],\n          'data-attribute',\n          Boolean(node.textContent && testVercelStegaRegex(node.textContent)),\n        )\n      } else if (isImgElement(node)) {\n        const data = testAndDecodeStega(node.alt, true)\n        if (!data) return\n        return createResolvedElement(node, data, 'stega-attribute')\n      } else if (isTimeElement(node)) {\n        const data = testAndDecodeStega(node.dateTime, true)\n        if (!data) return\n        return createResolvedElement(node, data, 'stega-attribute')\n      } else if (isSvgRootElement(node)) {\n        if (!node.ariaLabel) return\n        const data = testAndDecodeStega(node.ariaLabel, true)\n        if (!data) return\n        return createResolvedElement(node, data, 'stega-attribute')\n      }\n    }\n    return\n  }\n\n  function processNode(\n    node: ChildNode,\n    _parentGroup: Omit<ResolvedElement, 'commonSanity'> | undefined,\n  ): void {\n    const resolvedElement = resolveNode(node)\n\n    let parentGroup: Omit<ResolvedElement, 'commonSanity'> | undefined = _parentGroup\n\n    if (isElementNode(node) && node.dataset?.['sanityEditGroup'] !== undefined) {\n      parentGroup = {\n        type: 'group',\n        elements: {\n          element: node,\n          measureElement: node,\n        },\n        targets: [],\n      }\n      mainResults.push(parentGroup)\n    }\n\n    if (resolvedElement) {\n      const target: ResolvedElementTarget = {\n        elements: resolvedElement.elements,\n        sanity: resolvedElement.sanity,\n        reason: resolvedElement.reason,\n      }\n      if (parentGroup && !resolvedElement.preventGrouping) {\n        parentGroup.targets.push(target)\n      } else {\n        mainResults.push({\n          elements: resolvedElement.elements,\n          type: 'element',\n          targets: [target],\n        })\n      }\n    }\n\n    const shouldTraverseNode =\n      isElementNode(node) &&\n      !isImgElement(node) &&\n      !(node.tagName === 'SCRIPT' || node.tagName === 'SANITY-VISUAL-EDITING')\n\n    if (shouldTraverseNode) {\n      for (const childNode of node.childNodes) {\n        processNode(childNode, parentGroup)\n      }\n    }\n  }\n\n  if (el) {\n    for (const node of el.childNodes) {\n      processNode(node, undefined)\n    }\n  }\n\n  return mainResults\n    .map((node) => {\n      if (node.targets.length === 0 && node.type === 'group') {\n        // Always return empty groups so the controller can unregister them\n        return {\n          ...node,\n          commonSanity: undefined,\n        }\n      }\n\n      const commonSanity =\n        node.targets.length === 1\n          ? node.targets[0].sanity\n          : findCommonSanityData(\n              node.targets.map(({sanity}) => sanity).filter((n) => n !== undefined),\n            ) || node.targets[0].sanity\n\n      if (!commonSanity) return null\n\n      return {\n        ...node,\n        commonSanity,\n      }\n    })\n    .filter((node) => node !== null)\n}\n\nexport function isSanityArrayPath(path: string): boolean {\n  const lastDotIndex = path.lastIndexOf('.')\n  const lastPathItem = path.substring(lastDotIndex, path.length)\n\n  return lastPathItem.includes('[')\n}\n\nexport function getSanityNodeArrayPath(path: string): string | null {\n  if (!isSanityArrayPath(path)) return null\n\n  const split = path.split('.')\n\n  split[split.length - 1] = split[split.length - 1].replace(/\\[.*?\\]/g, '[]')\n\n  return split.join('.')\n}\n\nexport function sanityNodesExistInSameArray(\n  sanityNode1: SanityNode,\n  sanityNode2: SanityNode,\n): boolean {\n  if (!isSanityArrayPath(sanityNode1.path) || !isSanityArrayPath(sanityNode2.path)) return false\n\n  return getSanityNodeArrayPath(sanityNode1.path) === getSanityNodeArrayPath(sanityNode2.path)\n}\n\nexport function resolveDragAndDropGroup(\n  element: ElementNode,\n  sanity: SanityNode | SanityStegaNode,\n  elementSet: Set<ElementNode>,\n  elementsMap: WeakMap<ElementNode, OverlayElement>,\n): null | OverlayElement[] {\n  if (!element.getAttribute('data-sanity')) return null\n\n  if (element.getAttribute('data-sanity-drag-disable')) return null\n\n  if (!sanity || !isSanityNode(sanity) || !isSanityArrayPath(sanity.path)) return null\n\n  const targetDragGroup = element.getAttribute('data-sanity-drag-group')\n\n  const group = [...elementSet].reduce<OverlayElement[]>((acc, el) => {\n    const elData = elementsMap.get(el)\n    const elDragDisabled = el.getAttribute('data-sanity-drag-disable')\n    const elDragGroup = el.getAttribute('data-sanity-drag-group')\n    const elHasSanityAttribution = el.getAttribute('data-sanity') !== null\n\n    const sharedDragGroup = targetDragGroup !== null ? targetDragGroup === elDragGroup : true\n\n    if (\n      elData?.sanity &&\n      !elDragDisabled &&\n      isSanityNode(elData.sanity) &&\n      sanityNodesExistInSameArray(sanity, elData.sanity) &&\n      sharedDragGroup &&\n      elHasSanityAttribution\n    ) {\n      acc.push(elData)\n    }\n\n    return acc\n  }, [])\n\n  if (group.length <= 1) return null\n\n  return group\n}\n","import {v4 as uuid} from 'uuid'\nimport type {\n  ElementNode,\n  EventHandlers,\n  OverlayController,\n  OverlayElement,\n  OverlayOptions,\n  ResolvedElement,\n} from './types'\nimport {handleOverlayDrag} from './util/dragAndDrop'\nimport {findOverlayElement, isElementNode} from './util/elements'\nimport {\n  findSanityNodes,\n  isSanityArrayPath,\n  isSanityNode,\n  resolveDragAndDropGroup,\n} from './util/findSanityNodes'\nimport {getRect} from './util/geometry'\n\n/**\n * Creates a controller which dispatches overlay related events\n *\n * @param handler - Dispatched event handler\n * @param overlayElement - Parent element containing rendered overlay elements\n * @public\n */\nexport function createOverlayController({\n  handler,\n  overlayElement,\n  inFrame,\n  inPopUp,\n  optimisticActorReady,\n}: OverlayOptions): OverlayController {\n  let activated = false\n  // Map for getting element by ID\n  const elementIdMap = new Map<string, ElementNode>()\n  // WeakMap for getting data by element\n  const elementsMap = new WeakMap<ElementNode, OverlayElement>()\n  // Set for iterating over elements\n  const elementSet = new Set<ElementNode>()\n  // Weakmap keyed by measureElement to find associated element\n  const measureElements = new WeakMap<ElementNode, ElementNode>()\n  // Weakmap for storing user set cursor styles per element\n  const cursorMap = new WeakMap<ElementNode, string | undefined>()\n\n  let ro: ResizeObserver\n  let io: IntersectionObserver | undefined\n  let mo: MutationObserver\n\n  let activeDragSequence = false\n\n  // The `hoverStack` is used as a container for tracking which elements are hovered at any time.\n  // The browser supports hovering multiple nested elements simultanously, but we only want to\n  // highlight the \"outer most\" element.\n  //\n  // This is how it works:\n  // - Whenever the mouse enters an element, we add it to the stack.\n  // - Whenever the mouse leaves an element, we remove it from the stack.\n  //\n  // When we want to know which element is currently hovered, we take the element at the top of the\n  // stack. Since JavaScript does not have a Stack type, we use an array and take the last element.\n  let hoverStack: Array<ElementNode> = []\n  const getHoveredElement = () => hoverStack[hoverStack.length - 1] as ElementNode | undefined\n\n  function addEventHandlers(el: ElementNode, handlers: EventHandlers) {\n    el.addEventListener('click', handlers.click as EventListener, {\n      capture: true,\n    })\n    el.addEventListener('contextmenu', handlers.contextmenu as EventListener, {\n      capture: true,\n    })\n    // We listen for the initial mousemove event, in case the overlay is enabled whilst the cursor is already over an element\n    // mouseenter and mouseleave listeners are attached within this handler\n    el.addEventListener('mousemove', handlers.mousemove as EventListener, {\n      once: true,\n      capture: true,\n    })\n    // Listen for mousedown in case we need to prevent default behavior\n    el.addEventListener('mousedown', handlers.mousedown as EventListener, {\n      capture: true,\n    })\n  }\n\n  function removeEventHandlers(el: ElementNode, handlers: EventHandlers) {\n    el.removeEventListener('click', handlers.click as EventListener, {\n      capture: true,\n    })\n    el.removeEventListener('contextmenu', handlers.contextmenu as EventListener, {\n      capture: true,\n    })\n    el.removeEventListener('mousemove', handlers.mousemove as EventListener, {\n      capture: true,\n    })\n    el.removeEventListener('mousedown', handlers.mousedown as EventListener, {\n      capture: true,\n    })\n    el.removeEventListener('mouseenter', handlers.mouseenter as EventListener)\n    el.removeEventListener('mouseleave', handlers.mouseleave as EventListener)\n  }\n\n  /**\n   * Executed when element enters the viewport\n   * Enables an element’s event handlers\n   */\n  function activateElement({id, elements, handlers}: OverlayElement) {\n    const {element, measureElement} = elements\n    addEventHandlers(element, handlers)\n    ro.observe(measureElement)\n    handler({\n      type: 'element/activate',\n      id,\n    })\n  }\n\n  /**\n   * Executed when element leaves the viewport\n   * Disables an element’s event handlers\n   */\n  function deactivateElement({id, elements, handlers}: OverlayElement) {\n    const {element, measureElement} = elements\n    removeEventHandlers(element, handlers)\n    ro.unobserve(measureElement)\n    // Scrolling from a hovered element will not trigger mouseleave event, so filter the stack\n    hoverStack = hoverStack.filter((el) => el !== element)\n    handler({\n      type: 'element/deactivate',\n      id,\n    })\n  }\n\n  function setOverlayCursor(element: ElementNode) {\n    // Don't set the cursor if mutations are unavailable\n    if ((!inFrame && !inPopUp) || !optimisticActorReady) return\n\n    // Loops through the entire hoverStack, trying to set the cursor if the\n    // stack element matches the element passed to the function, otherwise\n    // restoring the cursor\n    for (const hoverstackElement of hoverStack) {\n      if (element === hoverstackElement) {\n        const targetSanityData = elementsMap.get(element)?.sanity\n        if (!targetSanityData || !isSanityNode(targetSanityData)) return\n\n        const dragGroup = resolveDragAndDropGroup(\n          element,\n          targetSanityData,\n          elementSet,\n          elementsMap,\n        )\n\n        if (dragGroup) {\n          // Store any existing cursor so it can be restored later\n          const existingCursor = element.style.cursor\n          if (existingCursor) {\n            cursorMap.set(element, existingCursor)\n          }\n\n          handler({\n            type: 'overlay/setCursor',\n            element,\n            cursor: 'move',\n          })\n\n          continue\n        }\n      }\n\n      restoreOverlayCursor(hoverstackElement)\n    }\n  }\n\n  function restoreOverlayCursor(element: ElementNode) {\n    // Restore any previously stored cursor (if it exists)\n    const previousCursor = cursorMap.get(element)\n\n    handler({\n      type: 'overlay/setCursor',\n      element,\n      cursor: previousCursor,\n    })\n  }\n\n  /**\n   * Stores an element’s DOM node and decoded sanity data in state and sets up event handlers\n   */\n  function registerElement({type, elements, commonSanity, targets}: ResolvedElement) {\n    const {element, measureElement} = elements\n\n    const eventHandlers: EventHandlers = {\n      click(event) {\n        const target = event.target as ElementNode | null\n\n        if (element === getHoveredElement() && element.contains(target)) {\n          // Click events are only supported supported in iframes, not well supported in popups\n          // @TODO presentation tool should report wether it's visible or not, so we can adapt properly and allow multi-window preview workflows\n          if (inFrame) {\n            event.preventDefault()\n            event.stopPropagation()\n          }\n\n          const sanity = elementsMap.get(element)?.sanity\n          if (sanity && !activeDragSequence) {\n            handler({\n              type: 'element/click',\n              id,\n              sanity,\n            })\n          }\n        }\n      },\n      contextmenu(event) {\n        if (!('path' in commonSanity!) || (!inFrame && !inPopUp) || !optimisticActorReady) return\n\n        // This is a temporary check as the context menu only supports array\n        // items (for now). We split the path into segments, if a `_key` exists\n        // in last path segment, we assume it's an array item, and so return\n        // early if it is some other type.\n        if (!commonSanity.path.split('.').pop()?.includes('[_key==')) return\n\n        const target = event.target as ElementNode | null\n        if (element === getHoveredElement() && element.contains(target)) {\n          // Context menus are supported on both iframes and popups\n          if (inFrame || inPopUp) {\n            event.preventDefault()\n            event.stopPropagation()\n          }\n          handler({\n            type: 'element/contextmenu',\n            id,\n            position: {\n              x: event.clientX,\n              y: event.clientY,\n            },\n            sanity: commonSanity,\n          })\n        }\n      },\n      mousedown(event) {\n        // prevent iframe from taking focus\n        event.preventDefault()\n\n        if (event.currentTarget !== hoverStack.at(-1)) return\n\n        if (element.getAttribute('data-sanity-drag-disable')) return\n\n        // disable dnd in non-studio contexts\n        if ((!inFrame && !inPopUp) || !optimisticActorReady) return\n\n        const targetSanityData = elementsMap.get(element)?.sanity\n\n        if (\n          !targetSanityData ||\n          !isSanityNode(targetSanityData) ||\n          !isSanityArrayPath(targetSanityData.path)\n        )\n          return\n\n        const dragGroup = resolveDragAndDropGroup(element, commonSanity!, elementSet, elementsMap)\n\n        if (!dragGroup) return\n\n        handleOverlayDrag({\n          element,\n          handler,\n          mouseEvent: event as MouseEvent,\n          overlayGroup: dragGroup,\n          target: targetSanityData,\n          onSequenceStart: () => {\n            activeDragSequence = true\n          },\n          onSequenceEnd: () => {\n            // delay drag sequence end to prevent click events from firing just after drag sequences\n            setTimeout(() => {\n              activeDragSequence = false\n            }, 250)\n          },\n        })\n      },\n      mousemove(event) {\n        eventHandlers.mouseenter(event)\n        const el = event.currentTarget as ElementNode | null\n        if (el) {\n          el.addEventListener('mouseenter', eventHandlers.mouseenter as EventListener)\n          el.addEventListener('mouseleave', eventHandlers.mouseleave as EventListener)\n        }\n      },\n      mouseenter() {\n        // If the Vercel Visual Editing provided by Vercel Toolbar is active, do not overlap overlays\n        if (\n          (document.querySelector('vercel-live-feedback') &&\n            element.closest('[data-vercel-edit-info]')) ||\n          element.closest('[data-vercel-edit-target]')\n        ) {\n          return\n        }\n        hoverStack.push(element)\n\n        handler({\n          type: 'element/mouseenter',\n          id,\n          rect: getRect(element),\n        })\n\n        setOverlayCursor(element)\n      },\n      mouseleave(e) {\n        function leave() {\n          hoverStack.pop()\n          const hoveredElement = getHoveredElement()\n\n          handler({\n            type: 'element/mouseleave',\n            id,\n          })\n\n          if (hoveredElement) {\n            setOverlayCursor(hoveredElement)\n            const overlayElement = elementsMap.get(hoveredElement)\n            if (overlayElement) {\n              handler({\n                type: 'element/mouseenter',\n                id: overlayElement.id,\n                rect: getRect(hoveredElement),\n              })\n            }\n          }\n\n          restoreOverlayCursor(element)\n        }\n\n        /**\n         * If moving to an element within the overlay which handles pointer events, attach a new\n         * event handler to that element and defer the original leave event\n         */\n        function addDeferredLeave(el: ElementNode) {\n          const deferredLeave = (e: MouseEvent) => {\n            const {relatedTarget} = e\n            const deferredContainer = findOverlayElement(relatedTarget)\n            if (!deferredContainer) {\n              el.removeEventListener('mouseleave', deferredLeave as EventListener)\n              leave()\n            } else if (relatedTarget && isElementNode(relatedTarget)) {\n              el.removeEventListener('mouseleave', deferredLeave as EventListener)\n              addDeferredLeave(relatedTarget)\n            }\n          }\n          el.addEventListener('mouseleave', deferredLeave as EventListener)\n        }\n\n        const {relatedTarget} = e as MouseEvent\n        const container = findOverlayElement(relatedTarget)\n        const isInteractiveOverlayElement = overlayElement.contains(container)\n\n        if (isElementNode(container) && isInteractiveOverlayElement) {\n          return addDeferredLeave(container)\n        }\n\n        leave()\n      },\n    }\n\n    const id = uuid()\n    const sanityNode = {\n      type,\n      id,\n      elements,\n      sanity: commonSanity,\n      handlers: eventHandlers,\n    }\n    elementSet.add(element)\n    measureElements.set(measureElement, element)\n    elementIdMap.set(id, element)\n    elementsMap.set(element, sanityNode)\n\n    io?.observe(element)\n\n    handler({\n      type: 'element/register',\n      elementType: type,\n      id,\n      element,\n      rect: getRect(element),\n      sanity: commonSanity!,\n      dragDisabled: !!element.getAttribute('data-sanity-drag-disable'),\n      targets: targets.map((target) => ({\n        sanity: target.sanity,\n        element: target.elements.element,\n      })),\n    })\n\n    if (activated) {\n      activateElement(sanityNode)\n    }\n  }\n\n  function updateElement(resolvedElement: ResolvedElement) {\n    const {element} = resolvedElement.elements\n    const overlayElement = elementsMap.get(element)\n    if (overlayElement) {\n      elementsMap.set(element, {...overlayElement, sanity: resolvedElement.commonSanity})\n      handler({\n        type: 'element/update',\n        elementType: overlayElement.type,\n        id: overlayElement.id,\n        rect: getRect(element),\n        sanity: resolvedElement.commonSanity!,\n        targets: resolvedElement.targets.map((target) => ({\n          sanity: target.sanity,\n          element: target.elements.element,\n        })),\n      })\n    }\n  }\n\n  function parseElements(node: ElementNode | {childNodes: ElementNode[]}) {\n    const sanityNodes = findSanityNodes(node)\n\n    for (const sanityNode of sanityNodes) {\n      if (sanityNode.type === 'group') {\n        for (const target of sanityNode.targets) {\n          // Any child target of a group should be unregistered if registered as an element\n          const overlayElement = elementsMap.get(target.elements.element)\n          if (overlayElement && overlayElement.type === 'element') {\n            unregisterElement(target.elements.element)\n          }\n        }\n        if (sanityNode.targets.length === 0) {\n          // Group was updated without children, unregister the element\n          unregisterElement(sanityNode.elements.element)\n        }\n      }\n\n      if (!sanityNode.commonSanity) continue\n\n      const {element} = sanityNode.elements\n      if (elementsMap.has(element)) {\n        updateElement(sanityNode)\n      } else {\n        registerElement(sanityNode)\n      }\n    }\n  }\n\n  function unregisterElement(element: ElementNode) {\n    const overlayElement = elementsMap.get(element)\n    if (overlayElement) {\n      const {id, handlers} = overlayElement\n      removeEventHandlers(element, handlers)\n      ro.unobserve(element)\n      elementsMap.delete(element)\n      elementSet.delete(element)\n      elementIdMap.delete(id)\n      handler({\n        type: 'element/unregister',\n        id,\n      })\n    }\n  }\n\n  function handleMutation(mutations: MutationRecord[]) {\n    let mutationWasInScope = false\n    // For each DOM mutation, we find the relevant element node and register or\n    // update it. This function doesn't handle checking if the node actually\n    // contains any relevant Sanity data, it just detects new or changed DOM\n    // elements and hands them off to `parseElements` to and determine if we\n    // have Sanity nodes\n    for (const mutation of mutations) {\n      const {target, type} = mutation\n      // We need to target an element, so if the mutated node was just a text\n      // change, we look at that node's parent instead\n      const node: Node | null = type === 'characterData' ? target.parentElement : target\n      // We ignore any nodes related to the overlay container element\n      if (node === overlayElement || overlayElement.contains(node)) {\n        continue\n      }\n\n      mutationWasInScope = true\n      if (isElementNode(node)) {\n        const possibleGroupParent = node.parentElement?.closest('[data-sanity-edit-group]') || null\n        const updateNodeTarget = isElementNode(possibleGroupParent) ? possibleGroupParent : node\n        parseElements({childNodes: [updateNodeTarget]})\n      }\n    }\n\n    // If the mutation is \"in scope\" (i.e. happened outside of the overlay\n    // container) we need to check if it removed any of the elements we are\n    // currently tracking\n    if (mutationWasInScope) {\n      for (const element of elementSet) {\n        if (!element.isConnected) {\n          unregisterElement(element)\n        }\n        // If the element was a group and is no longer a group, unregister it\n        const overlayElement = elementsMap.get(element)\n        if (overlayElement?.type === 'group' && !element.hasAttribute('data-sanity-edit-group')) {\n          unregisterElement(element)\n        }\n      }\n    }\n  }\n\n  function updateRect(el: ElementNode) {\n    const overlayElement = elementsMap.get(el)\n    if (overlayElement) {\n      handler({\n        type: 'element/updateRect',\n        id: overlayElement.id,\n        rect: getRect(el),\n      })\n    }\n  }\n\n  function handleResize(entries: ResizeObserverEntry[]) {\n    for (const entry of entries) {\n      const target = entry.target\n\n      if (isElementNode(target)) {\n        const element = measureElements.get(target)\n        if (!element) return\n        updateRect(element)\n      }\n    }\n  }\n\n  function handleIntersection(entries: IntersectionObserverEntry[]) {\n    if (!activated) return\n    for (const entry of entries) {\n      const {target} = entry\n      const match = isElementNode(target) && elementsMap.get(target)\n      if (!match) continue\n      if (entry.isIntersecting) {\n        activateElement(match)\n      } else {\n        deactivateElement(match)\n      }\n    }\n  }\n\n  function handleBlur(event: MouseEvent) {\n    const element = findOverlayElement(event.target)\n\n    if (element) {\n      if (element.dataset['sanityOverlayElement'] === 'capture') {\n        event.preventDefault()\n        event.stopPropagation()\n      }\n      return\n    }\n\n    hoverStack = []\n    handler({\n      type: 'overlay/blur',\n    })\n  }\n\n  function handleExclusivePluginClosed() {\n    hoverStack = []\n    handler({\n      type: 'overlay/reset-mouse-state',\n    })\n  }\n\n  function handleWindowResize() {\n    for (const element of elementSet) {\n      updateRect(element)\n    }\n  }\n\n  function handleKeydown(event: KeyboardEvent) {\n    if (event.key === 'Escape') {\n      hoverStack = []\n      handler({\n        type: 'overlay/blur',\n      })\n    }\n  }\n\n  function handleWindowScroll(event: Event) {\n    const {target} = event\n\n    if (target === window.document || !isElementNode(target)) {\n      return\n    }\n\n    for (const element of elementSet) {\n      if (target.contains(element)) {\n        updateRect(element)\n      }\n    }\n  }\n\n  function activate() {\n    if (activated) return\n    io = new IntersectionObserver(handleIntersection, {\n      threshold: 0.3,\n    })\n    elementSet.forEach((element) => io!.observe(element))\n    handler({\n      type: 'overlay/activate',\n    })\n    activated = true\n  }\n\n  function deactivate() {\n    if (!activated) return\n    io?.disconnect()\n    elementSet.forEach((element) => {\n      const overlayElement = elementsMap.get(element)\n      if (overlayElement) {\n        deactivateElement(overlayElement)\n      }\n    })\n    handler({\n      type: 'overlay/deactivate',\n    })\n    activated = false\n  }\n\n  function handleHeaderClick(event: CustomEvent<{id: string}>) {\n    const {id} = event.detail\n    const element = elementIdMap.get(id)\n    if (!element) return\n    const sanity = elementsMap.get(element)?.sanity\n    if (!sanity) return\n    handler({\n      type: 'element/click',\n      id,\n      sanity,\n    })\n  }\n\n  function destroy() {\n    window.removeEventListener('click', handleBlur)\n    window.removeEventListener('contextmenu', handleBlur)\n    window.removeEventListener(\n      'sanity-overlay/exclusive-plugin-closed',\n      handleExclusivePluginClosed,\n    )\n    window.removeEventListener('sanity-overlay/label-click', handleHeaderClick as EventListener)\n    window.removeEventListener('keydown', handleKeydown)\n    window.removeEventListener('resize', handleWindowResize)\n    window.removeEventListener('scroll', handleWindowScroll)\n    mo.disconnect()\n    ro.disconnect()\n\n    elementSet.forEach((element) => {\n      unregisterElement(element)\n    })\n\n    elementIdMap.clear()\n    elementSet.clear()\n\n    hoverStack = []\n    deactivate()\n  }\n\n  function create() {\n    window.addEventListener('click', handleBlur)\n    window.addEventListener('contextmenu', handleBlur)\n    window.addEventListener('sanity-overlay/exclusive-plugin-closed', handleExclusivePluginClosed)\n    window.addEventListener('sanity-overlay/label-click', handleHeaderClick as EventListener)\n    window.addEventListener('keydown', handleKeydown)\n    window.addEventListener('resize', handleWindowResize)\n    window.addEventListener('scroll', handleWindowScroll, {\n      capture: true,\n      passive: true,\n    })\n    ro = new ResizeObserver(handleResize)\n    mo = new MutationObserver(handleMutation)\n    mo.observe(document.body, {\n      attributes: true,\n      characterData: true,\n      childList: true,\n      subtree: true,\n    })\n\n    parseElements(document.body)\n    activate()\n  }\n\n  window.document.fonts.ready.then(() => {\n    for (const element of elementSet) {\n      updateRect(element)\n    }\n  })\n\n  create()\n\n  return {\n    activate,\n    deactivate,\n    destroy,\n  }\n}\n","import {createContext} from 'react'\nimport type {VisualEditingNode} from '../../types'\nimport type {SharedStateStore} from './sharedStateStore'\n\nexport interface SharedStateContextValue {\n  comlink?: VisualEditingNode\n  store: SharedStateStore\n}\n\nexport const SharedStateContext = createContext<SharedStateContextValue | null>(null)\n"],"names":["useOptimistic","passthrough","reducer","$","_c","pristine","setPristine","useState","optimistic","setOptimistic","lastEvent","setLastEvent","lastPassthrough","setLastPassthrough","actor","useOptimisticActor","t0","action","prevState","Array","isArray","reduce","acc","reducer_0","document","id","getPublishedId","originalId","type","reduceStateFromAction","useEffectEvent","t1","updateLastPassthrough","t2","isEmptyActor","pristineTimeout","rebasedSub","on","_event","event","prevState_0","clearTimeout","pristineSub","unsubscribe","t3","useEffect","t4","Error","startTransition","t5","byteToHex","i","push","toString","slice","unsafeStringify","arr","offset","toLowerCase","getRandomValues","rnds8","Uint8Array","rng","crypto","bind","randomUUID","v4","options","buf","native","rnds","random","length","getRect","element","domRect","getBoundingClientRect","x","scrollX","y","scrollY","w","width","h","height","offsetRect","rect","px","axis","rayIntersect","l1","l2","x1","y1","x2","y2","x3","y3","x4","y4","denominator","ua","ub","rectEqual","r1","r2","rayRectIntersections","line","rectLines","intersections","intersection","isDuplicate","j","sort","a","b","pointDist","p1","p2","Math","sqrt","pointInBounds","point","bounds","withinX","withinY","findClosestIntersection","ray","targets","flow","rayOrigin","some","t","min","closestIntersection","closestRect","target","firstIntersection","scaleRect","scale","origin","originX","originY","newX","newY","newWidth","newHeight","getRectGroupXExtent","rects","minGroupX","max","map","r","maxGroupX","body","offsetWidth","getRectGroupYExtent","minGroupY","maxGroupY","scrollHeight","calcTargetFlow","filter","calcInsertPosition","rayLeft","rayRight","left","right","rayTop","rayBottom","top","bottom","findRectSanityData","overlayGroup","find","e","elements","sanity","resolveInsertPosition","insertPosition","Object","values","every","v","calcMousePos","bodyBounds","clientX","clientY","window","calcMousePosInverseTransform","mousePos","transform","getComputedStyle","inverseMatrix","DOMMatrix","inverse","transformedPoint","DOMPoint","matrixTransform","buildPreviewSkeleton","scaleFactor","children","querySelectorAll","childRects","child","tagName","offsetX","offsetY","maxWidth","minDragDelta","applyMinimapWrapperTransform","minYScaled","handler","rectUpdateFrequency","Promise","resolve","addEventListener","setTimeout","once","display","style","overflow","documentElement","transformOrigin","transition","calcMinimapTransformValues","groupHeightOverride","groupHeight","padding","innerHeight","scaledRects","innerWidth","calcGroupBoundsPreview","groupBoundsX","groupBoundsY","offsetDist","canOffsetX","canOffsetY","canOffset","resetMinimapWrapperTransform","endYOrigin","prescaleHeight","previousRootStyleValues","maxScroll","prevScrollY","scrollTo","behavior","minimapScaleApplied","mousePosInverseTransform","handleOverlayDrag","opts","mouseEvent","onSequenceStart","onSequenceEnd","button","focus","getAttribute","dragGroup","disableMinimap","preventInsertDefault","documentHeightOverride","initialMousePos","scaleTarget","sequenceStarted","minimapPromptShown","mousedown","rectsInterval","setInterval","applyMinimap","skeleton","then","groupRect","handleScroll","abs","deltaY","shiftKey","dispatchEvent","CustomEvent","handleMouseMove","preventDefault","newInsertPosition","JSON","stringify","handleMouseUp","clearInterval","removeFrameListeners","removeKeyListeners","removeMouseListeners","handleKeyup","key","handleBlur","removeEventListener","isElementNode","HTMLElement","SVGElement","findNonInlineElement","parent","parentElement","findOverlayElement","el","dataset","testVercelStegaRegex","input","VERCEL_STEGA_REGEX","lastIndex","test","decodeStega","str","isAltText","decoded","vercelStegaDecode","href","replace","err","console","error","testAndDecodeStega","node","nodeType","Node","ELEMENT_NODE","isImgElement","isTimeElement","isSvgRootElement","toUpperCase","isSanityNode","findCommonPath","first","second","firstParts","split","secondParts","maxLength","reverse","parts","part","join","findCommonSanityData","nodes","n","_i","sanityNodes","common","consistentValueKeys","undefined","path","findSanityNodes","mainResults","createResolvedElement","data","reason","preventGrouping","decodeSanityNodeData","measureElement","resolveNode","textContent","nodesInTarget","commonData","commonSanity","TEXT_NODE","Boolean","alt","dateTime","ariaLabel","processNode","_parentGroup","resolvedElement","parentGroup","childNode","childNodes","isSanityArrayPath","lastDotIndex","lastIndexOf","substring","includes","getSanityNodeArrayPath","sanityNodesExistInSameArray","sanityNode1","sanityNode2","resolveDragAndDropGroup","elementSet","elementsMap","targetDragGroup","group","elData","get","elDragDisabled","elDragGroup","elHasSanityAttribution","sharedDragGroup","createOverlayController","overlayElement","inFrame","inPopUp","optimisticActorReady","activated","elementIdMap","Map","WeakMap","Set","measureElements","cursorMap","ro","io","mo","activeDragSequence","hoverStack","getHoveredElement","addEventHandlers","handlers","click","capture","contextmenu","mousemove","removeEventHandlers","mouseenter","mouseleave","activateElement","observe","deactivateElement","unobserve","setOverlayCursor","hoverstackElement","targetSanityData","existingCursor","cursor","set","restoreOverlayCursor","previousCursor","registerElement","eventHandlers","contains","stopPropagation","pop","position","currentTarget","at","querySelector","closest","leave","hoveredElement","addDeferredLeave","deferredLeave","relatedTarget","container","isInteractiveOverlayElement","uuid","sanityNode","add","elementType","dragDisabled","updateElement","parseElements","unregisterElement","has","delete","handleMutation","mutations","mutationWasInScope","mutation","possibleGroupParent","updateNodeTarget","isConnected","hasAttribute","updateRect","handleResize","entries","entry","handleIntersection","match","isIntersecting","handleExclusivePluginClosed","handleWindowResize","handleKeydown","handleWindowScroll","activate","IntersectionObserver","threshold","forEach","deactivate","disconnect","handleHeaderClick","detail","destroy","clear","create","passive","ResizeObserver","MutationObserver","attributes","characterData","childList","subtree","fonts","ready","SharedStateContext","createContext"],"mappings":"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","ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11],"debugId":null}},
    {"offset": {"line": 1390, "column": 0}, "map": {"version":3,"file":"PointerEvents.js","sources":["file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/util/getNodeIcon.tsx","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/PopoverPortal.tsx","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/telemetry/TelemetryContext.tsx","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/telemetry/useTelemetry.tsx","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/overlay-components/components/InsertMenu.tsx","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/overlay-components/components/PointerEvents.tsx"],"sourcesContent":["import {\n  BlockContentIcon,\n  CheckmarkCircleIcon,\n  CubeIcon,\n  ImageIcon,\n  NumberIcon,\n  StringIcon,\n  ThListIcon,\n} from '@sanity/icons'\nimport type {\n  SchemaArrayItem,\n  SchemaNumberNode,\n  SchemaObjectField,\n  SchemaStringNode,\n  SchemaUnionOption,\n} from '@sanity/presentation-comlink'\n\ntype Option =\n  | SchemaNumberNode\n  | SchemaStringNode\n  | SchemaArrayItem\n  | SchemaObjectField\n  | SchemaUnionOption\n\nexport function getNodeIcon(option: Option | undefined): React.JSX.Element {\n  if (!option) return <CubeIcon />\n\n  if (option.type === 'string') {\n    return <StringIcon />\n  }\n\n  if (option.type === 'number') {\n    return <NumberIcon />\n  }\n\n  const {value: node} = option\n\n  if ('icon' in option && option.icon) {\n    return <div dangerouslySetInnerHTML={{__html: option.icon}} />\n  }\n\n  const {type} = node\n\n  if (type === 'string') {\n    return <StringIcon />\n  }\n\n  if (type === 'boolean') {\n    return <CheckmarkCircleIcon />\n  }\n\n  if (type === 'number') {\n    return <NumberIcon />\n  }\n\n  if (type === 'array' || type === 'union') {\n    const of = Array.isArray(node.of) ? node.of : [node.of]\n    if (of.some((n) => 'name' in n && n.name === 'block')) {\n      return <BlockContentIcon />\n    }\n    return <ThListIcon />\n  }\n\n  if (type === 'object') {\n    if (option.name === 'image') {\n      return <ImageIcon />\n    }\n    if (option.name === 'block') {\n      return <StringIcon />\n    }\n  }\n\n  return <CubeIcon />\n}\n","import {Portal} from '@sanity/ui/_visual-editing'\nimport {type FunctionComponent, type MouseEvent} from 'react'\nimport {css, styled} from 'styled-components'\n\nconst scrollBlockStyles = css`\n  overflow-y: scroll;\n  overscroll-behavior: contain;\n  -ms-overflow-style: none;\n  scrollbar-width: none;\n\n  &:before {\n    content: '';\n    display: block;\n    height: calc(100% + 1px);\n    position: absolute;\n    top: 0;\n    width: 100%;\n    z-index: -1;\n  }\n`\n\nconst PortalContainer = styled.div<{$blockScroll: boolean}>`\n  height: 100%;\n  inset: 0;\n  pointer-events: all;\n  position: fixed;\n  width: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n\n  ${(props) => props.$blockScroll && scrollBlockStyles}\n`\nconst PortalBackground = styled.div`\n  background: transparent;\n  height: 100%;\n  inset: 0;\n  position: absolute;\n  width: 100%;\n`\n\ntype PopoverPortalProps = {\n  children?: React.ReactNode\n  onDismiss?: () => void\n  setBoundaryElement?: (element: HTMLDivElement) => void\n  blockScroll?: boolean\n}\n\nexport const PopoverPortal: FunctionComponent<PopoverPortalProps> = (props) => {\n  return (\n    <Portal>\n      <PopoverBackground {...props} />\n    </Portal>\n  )\n}\n\nexport const PopoverBackground: FunctionComponent<{\n  children?: React.ReactNode\n  onDismiss?: () => void\n  setBoundaryElement?: (element: HTMLDivElement) => void\n  blockScroll?: boolean\n}> = (props) => {\n  const {children, onDismiss, setBoundaryElement, blockScroll = true} = props\n\n  // Prevent the event from propagating to the window, so that the controller's\n  // `handleBlur` listener is not triggered. This is needed to prevent the\n  // context menu from being dismissed when some click causes parent elements to\n  // re-render, and the data-attribute method of preventing propagation fails.\n  const handleClick = (event: MouseEvent) => {\n    event.stopPropagation()\n  }\n\n  return (\n    <PortalContainer\n      data-sanity-overlay-element\n      ref={setBoundaryElement}\n      onClick={handleClick}\n      $blockScroll={blockScroll}\n    >\n      <PortalBackground\n        onMouseDownCapture={() => {\n          onDismiss?.()\n        }}\n      />\n      {children}\n    </PortalContainer>\n  )\n}\n","import {defineEvent} from '@sanity/telemetry'\nimport {createContext} from 'react'\n\nexport const events = {\n  'Visual Editing Drag Sequence Completed': defineEvent({\n    name: 'Visual Editing Drag Sequence Completed',\n    description: 'An array is successfully reordered using drag and drop.',\n    version: 1,\n  }),\n  'Visual Editing Drag Minimap Enabled': defineEvent({\n    name: 'Visual Editing Drag Minimap Enabled',\n    description: 'The zoomed-out minimap view is enabled during a drag sequence.',\n    version: 1,\n  }),\n  'Visual Editing Context Menu Item Removed': defineEvent({\n    name: 'Visual Editing Context Menu Item Removed',\n    description: 'An item is removed using the Context Menu.',\n    version: 1,\n  }),\n  'Visual Editing Context Menu Item Duplicated': defineEvent({\n    name: 'Visual Editing Context Menu Item Duplicated',\n    description: 'An item is duplicated using the Context Menu.',\n    version: 1,\n  }),\n  'Visual Editing Context Menu Item Moved': defineEvent({\n    name: 'Visual Editing Context Menu Item Moved',\n    description: 'An item is moved using the Context Menu.',\n    version: 1,\n  }),\n  'Visual Editing Context Menu Item Inserted': defineEvent({\n    name: 'Visual Editing Context Menu Item Inserted',\n    description: 'An item is inserted using the Context Menu.',\n    version: 1,\n  }),\n  'Visual Editing Insert Menu Item Inserted': defineEvent({\n    name: 'Visual Editing Insert Menu Item Inserted',\n    description: 'An item is inserted using the Insert Menu.',\n    version: 1,\n  }),\n  'Visual Editing Overlay Clicked': defineEvent({\n    name: 'Visual Editing Overlay Clicked',\n    description: 'An Overlay is clicked.',\n    version: 1,\n  }),\n}\n\ntype EventDataMap = {\n  [K in keyof typeof events]: (typeof events)[K] extends ReturnType<typeof defineEvent<infer T>>\n    ? T\n    : never\n}\n\nexport type TelemetryEventNames = keyof typeof events\n\nexport type TelemetryContextValue = <K extends keyof typeof events>(\n  name: K,\n  data: EventDataMap[K] extends void ? null | undefined : EventDataMap[K],\n) => void\n\nexport const TelemetryContext = createContext<TelemetryContextValue | undefined>(undefined)\n","import {useContext} from 'react'\nimport {TelemetryContext, type TelemetryContextValue} from './TelemetryContext'\n\nexport function useTelemetry(): TelemetryContextValue {\n  const context = useContext(TelemetryContext)\n\n  if (!context) {\n    throw new Error('Telemetry context is missing')\n  }\n\n  return context\n}\n","import type {InsertMenuOptions} from '@sanity/insert-menu'\nimport {InsertMenu as SanityInsertMenu} from '@sanity/insert-menu'\nimport type {SchemaUnionNode} from '@sanity/presentation-comlink'\nimport type {SchemaType} from '@sanity/types'\nimport {Popover} from '@sanity/ui/_visual-editing'\nimport {type FunctionComponent} from 'react'\nimport {PopoverPortal} from '../../ui/PopoverPortal'\nimport {getNodeIcon} from '../../util/getNodeIcon'\n\n// @todo How can this be localised?\nconst labels = {\n  'insert-menu.filter.all-items': 'All',\n  'insert-menu.search.no-results': 'No results',\n  'insert-menu.search.placeholder': 'Filter types…',\n  'insert-menu.toggle-grid-view.tooltip': 'Toggle grid view',\n  'insert-menu.toggle-list-view.tooltip': 'Toggle list view',\n} as const\n\nexport interface InsertMenuProps {\n  node: SchemaUnionNode\n  onSelect: (schemaType: SchemaType) => void\n}\n\nexport const InsertMenu: FunctionComponent<InsertMenuProps> = (props) => {\n  const {node, onSelect} = props\n\n  const insertMenuOptions = node.options?.insertMenu || {}\n\n  const views: InsertMenuOptions['views'] = insertMenuOptions.views?.map((view) => {\n    // Map the `previewImageUrls` that Presentation already resolved and\n    // serialized back to a function so that InsertMenu can \"resolve\" them\n    if (view.name === 'grid') {\n      return {\n        ...view,\n        previewImageUrl: (name) => view.previewImageUrls?.[name],\n      }\n    }\n    return view\n  })\n\n  return (\n    <SanityInsertMenu\n      {...insertMenuOptions}\n      labels={labels}\n      // @ts-expect-error -- @todo map typings\n      schemaTypes={node.of.map((type) => ({\n        ...type,\n        icon: getNodeIcon(type),\n      }))}\n      onSelect={onSelect}\n      views={views}\n    />\n  )\n}\n\nexport interface InsertMenuPopoverProps extends InsertMenuProps {\n  onDismiss: () => void\n  referenceElement?: HTMLElement | null\n}\n\nexport const InsertMenuPopover: FunctionComponent<InsertMenuPopoverProps> = (props) => {\n  const {node, onDismiss, onSelect, referenceElement} = props\n\n  const popoverContent = <InsertMenu node={node} onSelect={onSelect} />\n\n  const insertMenuOptions = node.options?.insertMenu || {}\n\n  // If the grid view is not enabled, the popover should fit the content. If it\n  // is enabled, the popover width needs to be 'forced' to some arbitrary amount\n  // to prevent the grid from collapsing to a single column. The '0' size allows\n  // for a two column layout\n  const width = insertMenuOptions.views?.some((view) => view.name === 'grid') ? 0 : undefined\n\n  return (\n    <PopoverPortal onDismiss={onDismiss}>\n      <Popover\n        animate={true}\n        constrainSize\n        content={popoverContent}\n        fallbackPlacements={['bottom']}\n        open\n        placement={'top'}\n        preventOverflow\n        referenceElement={referenceElement}\n        width={width}\n      />\n    </PopoverPortal>\n  )\n}\n","import type {FunctionComponent, HTMLAttributes, PropsWithChildren} from 'react'\n\nexport const PointerEvents: FunctionComponent<\n  PropsWithChildren<HTMLAttributes<HTMLDivElement>>\n> = ({children, style, ...rest}) => {\n  return (\n    <div style={{...style, pointerEvents: 'all'}} data-sanity-overlay-element {...rest}>\n      {children}\n    </div>\n  )\n}\n"],"names":["getNodeIcon","option","type","value","node","icon","__html","Array","isArray","of","some","n","name","scrollBlockStyles","css","PortalContainer","styled","div","props","$blockScroll","PortalBackground","PopoverPortal","$","_c","t0","PopoverBackground","children","onDismiss","setBoundaryElement","blockScroll","undefined","handleClick","_temp","t1","t2","event","stopPropagation","events","defineEvent","description","version","TelemetryContext","createContext","useTelemetry","context","useContext","Error","labels","InsertMenu","onSelect","options","insertMenu","insertMenuOptions","views","map","_temp2","t3","SanityInsertMenu","InsertMenuPopover","referenceElement","popoverContent","width","_temp3","Symbol","for","view","previewImageUrl","previewImageUrls","PointerEvents","rest","style","pointerEvents"],"mappings":"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","ignoreList":[0,1,2,3,4,5],"debugId":null}},
    {"offset": {"line": 1652, "column": 0}, "map": {"version":3,"file":"index.js","sources":["file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/optimistic/state/documentMutator.ts","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/optimistic/state/datasetMutator.ts"],"sourcesContent":["import type {SanityClient} from '@sanity/client'\nimport {SanityEncoder, type Transaction} from '@sanity/mutate'\nimport {\n  documentMutatorMachine,\n  type DocumentMutatorMachineParentEvent,\n} from '@sanity/mutate/_unstable_machine'\nimport {enqueueActions, fromPromise} from 'xstate'\nimport type {VisualEditingNode} from '../../types'\n\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\nexport const createDocumentMutator = (comlink: VisualEditingNode) => {\n  const fetchSnapshot = fromPromise(\n    async ({input, signal}: {input: {id: string; client: SanityClient}; signal: AbortSignal}) => {\n      const {id} = input\n      const {snapshot} = await comlink.fetch(\n        'visual-editing/fetch-snapshot',\n        {documentId: id},\n        {\n          signal,\n        },\n      )\n      return snapshot\n    },\n  )\n\n  const submitMutations = fromPromise(\n    async ({input}: {input: {client: SanityClient; transactions: Transaction[]}}) => {\n      const {transactions} = input\n      for (const transaction of transactions) {\n        const data = SanityEncoder.encodeTransaction(transaction)\n        return comlink.post('visual-editing/mutate', data)\n      }\n    },\n  )\n\n  return documentMutatorMachine.provide({\n    actions: {\n      'send sync event to parent': enqueueActions(({enqueue}) => {\n        // Original action provided by the `documentMutatorMachine`\n        enqueue.sendParent(\n          ({context}) =>\n            ({\n              type: 'sync',\n              id: context.id,\n              document: context.remote!,\n            }) satisfies DocumentMutatorMachineParentEvent,\n        )\n        // Additional action so that we can determine when the snapshot is ready\n        enqueue.emit(({context}) => ({type: 'ready', snapshot: context.local}))\n      }),\n    },\n    actors: {\n      'fetch remote snapshot': fetchSnapshot,\n      'submit mutations as transactions': submitMutations,\n    },\n  })\n}\n","/**\n * The logic here is intended to live inside a preview iframe, and listen to events from the parent frame.\n * It also supports running in a \"detached\" mode, where it has to setup authenticated EventSource conenctions and perform data fetching itself.\n */\n\nimport {type SanityClient} from '@sanity/client'\nimport {\n  createSharedListener,\n  documentMutatorMachine,\n  type DocumentMutatorMachineInput,\n  type DocumentMutatorMachineParentEvent,\n} from '@sanity/mutate/_unstable_machine'\nimport {assertEvent, assign, emit, setup, stopChild, type ActorRefFrom} from 'xstate'\nimport type {VisualEditingNode} from '../../types'\nimport {createDocumentMutator} from './documentMutator'\n\nexport interface DatasetMutatorMachineInput extends Omit<DocumentMutatorMachineInput, 'id'> {\n  client: SanityClient\n  /** A shared listener can be provided, if not it'll be created using `client.listen()` */\n  sharedListener?: ReturnType<typeof createSharedListener>\n}\n\nexport const datasetMutatorMachine = setup({\n  types: {} as {\n    context: {\n      client: SanityClient\n      /** A shared listener can be provided, if not it'll be created using `client.listen()` */\n      sharedListener?: ReturnType<typeof createSharedListener>\n      documents: Record<string, ActorRefFrom<ReturnType<typeof createDocumentMutator>>>\n    }\n    events:\n      | {type: 'observe'; documentId: string}\n      | {type: 'unobserve'; documentId: string}\n      | {type: 'add document actor'; documentId: string}\n      | {type: 'stop document actor'; documentId: string}\n      | DocumentMutatorMachineParentEvent\n    input: DatasetMutatorMachineInput\n    emitted: DocumentMutatorMachineParentEvent\n  },\n  actions: {\n    'emit sync event': emit(({event}) => {\n      assertEvent(event, 'sync')\n      return event\n    }),\n    'emit mutation event': emit(({event}) => {\n      assertEvent(event, 'mutation')\n      return event\n    }),\n    'emit rebased event': emit(({event}) => {\n      assertEvent(event, ['rebased.local', 'rebased.remote'])\n      return event\n    }),\n    'emit pristine event': emit(({event}) => {\n      assertEvent(event, ['pristine'])\n      return event\n    }),\n    'add document actor': assign({\n      documents: ({context, event, spawn}) => {\n        assertEvent(event, 'observe')\n        const id = event.documentId\n        // Adding the same documentId multiple times is a no-op\n        if (context.documents[id]) return context.documents\n        return {\n          ...context.documents,\n          [id]: spawn('documentMutatorMachine', {\n            input: {\n              id,\n              client: context.client,\n              sharedListener: context.sharedListener || createSharedListener(context.client),\n            },\n            id,\n          }),\n        }\n      },\n    }),\n    'stop remote snapshot': stopChild(({context, event}) => {\n      assertEvent(event, 'unobserve')\n      return context.documents[event.documentId]!\n    }),\n    'remove remote snapshot from context': assign({\n      documents: ({context, event}) => {\n        assertEvent(event, 'unobserve')\n        // Removing a non-existing documentId is a no-op\n        if (!context.documents[event.documentId]) return context.documents\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        const {[event.documentId]: _, ...documents} = context.documents\n        return documents\n      },\n    }),\n  },\n  actors: {\n    documentMutatorMachine,\n  },\n}).createMachine({\n  /** @xstate-layout N4IgpgJg5mDOIC5QBsD2BjAhsgIhgrgLZgB2ALgMTICWsZpA2gAwC6ioADqrNWdaiXYgAHogC0ADgBMAOgkA2ACyKArBICcTdfKXSANCACeiFQHYZpgMxWV800yYqp6gIyn5AXw8G0WXAWJyCnwSGjpGViEuHj4BIVEEKUt5OSlFU1smFwkFW0sDY0T1GRUXRXkXKVN7HSYJJkUvHwxsPHQiUjIZDgAnWj4SMApCfDJMemY2JBBo3n5BaYSXeVlbKRUsiXdFSxcXfKNERSqZTbr1zVMJNyaQX1aAzpkIah6yQwp0VEJCXkmo7hzOKLRDLFwyFxaSzXKTOKQudSKCQFRDOczqCSWJjwjbHCQqRFebwgEioCBwIT3fztQJkAExebxcQuFEIZaWGRIrF7dSXKTyFSNYlUtodcjdPp0aiDelAhagBLpVmWAmc46mNwSZTyLQuFS3EWPcUvN6FTiA2LykSoq6c6wbCqVUzparKioyRFVfkq1zqNSWIkeIA */\n  id: 'dataset-mutator',\n  context: ({input}) => ({\n    documents: {},\n    client: input.client,\n    sharedListener: input.sharedListener,\n  }),\n\n  on: {\n    'sync': {actions: ['emit sync event']},\n    'mutation': {actions: ['emit mutation event']},\n    'rebased.*': {actions: ['emit rebased event']},\n    'pristine': {actions: ['emit pristine event']},\n    'observe': {\n      actions: ['add document actor'],\n    },\n    'unobserve': {\n      actions: ['stop remote snapshot', 'remove remote snapshot from context'],\n    },\n  },\n\n  initial: 'pristine',\n\n  states: {\n    pristine: {},\n  },\n})\n\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\nexport const createDatasetMutator = (comlink: VisualEditingNode) => {\n  return datasetMutatorMachine.provide({\n    actors: {\n      documentMutatorMachine: createDocumentMutator(comlink),\n    },\n  })\n}\n"],"names":["createDocumentMutator","comlink","fetchSnapshot","fromPromise","input","signal","id","snapshot","fetch","documentId","submitMutations","transactions","transaction","data","SanityEncoder","encodeTransaction","post","documentMutatorMachine","provide","actions","enqueueActions","enqueue","sendParent","context","type","document","remote","emit","local","actors","datasetMutatorMachine","setup","types","event","assertEvent","assign","documents","spawn","client","sharedListener","createSharedListener","stopChild","_","createMachine","on","initial","states","pristine","createDatasetMutator"],"mappings":"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","ignoreList":[0,1],"debugId":null}},
    {"offset": {"line": 1799, "column": 0}, "map": {"version":3,"file":"index.js","sources":["file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/History.tsx","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/Meta.ts","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/util/useDragEvents.ts","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/schema/SchemaContext.tsx","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/schema/useSchema.ts","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/context-menu/contextMenuItems.tsx","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/context-menu/ContextMenu.tsx","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/util/getLinkHref.ts","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/preview/PreviewSnapshotsContext.tsx","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/preview/usePreviewSnapshots.ts","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/ElementOverlay.tsx","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/OverlayDragGroupRect.tsx","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/OverlayDragInsertMarker.tsx","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/OverlayDragPreview.tsx","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/OverlayMinimapPrompt.tsx","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/elementsReducer.ts","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/overlayStateReducer.ts","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/preview/PreviewSnapshotsProvider.tsx","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/schema/SchemaProvider.tsx","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/shared-state/SharedStateProvider.tsx","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/telemetry/TelemetryProvider.tsx","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/useController.tsx","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/usePerspectiveSync.tsx","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/useReportDocuments.ts","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/Overlays.tsx","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/Refresh.tsx","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/useComlink.tsx","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/optimistic/state/createSharedListener.ts","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/useDatasetMutator.ts","file:///Users/rc/github/glowing-engine/node_modules/.pnpm/%40sanity%2Bvisual-editing%402.15.0_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.6.0_%40sanity_6975bc1df511480cf8bfe9135cdc69c3/node_modules/%40sanity/visual-editing/src/ui/VisualEditing.tsx"],"sourcesContent":["import {useEffect, type FunctionComponent} from 'react'\nimport type {HistoryAdapter, VisualEditingNode} from '../types'\n\n/**\n * @internal\n */\nexport const History: FunctionComponent<{\n  comlink: VisualEditingNode\n  history?: HistoryAdapter\n}> = (props) => {\n  const {comlink, history} = props\n\n  useEffect(() => {\n    return comlink?.on('presentation/navigate', (data) => {\n      history?.update(data)\n    })\n  }, [comlink, history])\n\n  useEffect(() => {\n    if (history) {\n      return history.subscribe((update) => {\n        update.title = update.title || document.title\n        comlink?.post('visual-editing/navigate', update)\n      })\n    }\n    return\n  }, [comlink, history])\n\n  return null\n}\n","import {useEffect, type FunctionComponent} from 'react'\nimport type {VisualEditingNode} from '../types'\n\n/**\n * @internal\n */\nexport const Meta: FunctionComponent<{\n  comlink: VisualEditingNode\n}> = (props) => {\n  const {comlink} = props\n\n  useEffect(() => {\n    const sendMeta = () => {\n      comlink.post('visual-editing/meta', {title: document.title})\n    }\n\n    const observer = new MutationObserver(([mutation]) => {\n      if (mutation.target.nodeName === 'TITLE') {\n        sendMeta()\n      }\n    })\n\n    observer.observe(document.head, {\n      subtree: true,\n      characterData: true,\n      childList: true,\n    })\n\n    sendMeta()\n\n    return () => observer.disconnect()\n  }, [comlink])\n\n  return null\n}\n","import {at, insert, remove} from '@sanity/mutate'\nimport {get as getFromPath} from '@sanity/util/paths'\nimport {useCallback, useEffect} from 'react'\nimport {useDocuments} from '../react/useDocuments'\nimport type {DragEndEvent, DragInsertPosition} from '../types'\nimport {getArrayItemKeyAndParentPath} from './mutations'\n\n// Finds the node that the drag end event was relative to, and the relative\n// position the new element should be inserted in. If the reference node was\n// \"top\" or \"left\", we insert \"after\". If it was \"bottom\" or \"right\", we insert\n// \"before\".\nfunction getReferenceNodeAndInsertPosition(position: DragInsertPosition) {\n  if (position) {\n    const {top, right, bottom, left} = position\n    if (left || top) {\n      return {node: (left ?? top)!.sanity, position: 'after' as const}\n    } else if (right || bottom) {\n      return {node: (right ?? bottom)!.sanity, position: 'before' as const}\n    }\n  }\n  return undefined\n}\n\nexport function useDragEndEvents(): {\n  dispatchDragEndEvent: (event: DragEndEvent) => void\n} {\n  const {getDocument} = useDocuments()\n\n  useEffect(() => {\n    const handler = (e: CustomEvent<DragEndEvent>) => {\n      const {insertPosition, target, preventInsertDefault} = e.detail\n\n      if (preventInsertDefault) return\n\n      const reference = getReferenceNodeAndInsertPosition(insertPosition)\n      if (reference) {\n        const doc = getDocument(target.id)\n        // We must have access to the document actor in order to perform the\n        // necessary mutations. If this is undefined, something went wrong when\n        // resolving the currently in use documents\n        const {node, position} = reference\n        // Get the key of the element that was dragged\n        const {key: targetKey, hasExplicitKey} = getArrayItemKeyAndParentPath(target)\n        // Get the key of the reference element, and path to the parent array\n        const {path: arrayPath, key: referenceItemKey} = getArrayItemKeyAndParentPath(node)\n        // Don't patch if the keys match, as this means the item was only\n        // dragged to its existing position, i.e. not moved\n        if (arrayPath && referenceItemKey && referenceItemKey !== targetKey) {\n          doc.patch(async ({getSnapshot}) => {\n            const snapshot = await getSnapshot()\n            // Get the current value of the element we dragged, as we will need\n            // to clone this into the new position\n            const elementValue = getFromPath(snapshot, target.path)\n\n            if (hasExplicitKey) {\n              return [\n                // Remove the original dragged item\n                at(arrayPath, remove({_key: targetKey})),\n                // Insert the cloned dragged item into its new position\n                at(arrayPath, insert(elementValue, position, {_key: referenceItemKey})),\n              ]\n            } else {\n              // handle reordering for primitives\n              return [\n                // Remove the original dragged item\n                at(arrayPath, remove(~~targetKey)),\n                // Insert the cloned dragged item into its new position\n                at(\n                  arrayPath,\n                  insert(\n                    elementValue,\n                    position,\n                    // if target key is < reference, each item in the array's index will be one less due to the previous removal\n                    referenceItemKey > targetKey ? ~~referenceItemKey - 1 : ~~referenceItemKey,\n                  ),\n                ),\n              ]\n            }\n          })\n        }\n      }\n    }\n    window.addEventListener('sanity/dragEnd', handler as EventListener)\n    return () => {\n      window.removeEventListener('sanity/dragEnd', handler as EventListener)\n    }\n  }, [getDocument])\n\n  const dispatchDragEndEvent = useCallback((event: DragEndEvent) => {\n    const customEvent = new CustomEvent<DragEndEvent>('sanity/dragEnd', {\n      detail: event,\n      cancelable: true,\n    })\n    window.dispatchEvent(customEvent)\n  }, [])\n\n  return {dispatchDragEndEvent}\n}\n","import type {\n  DocumentSchema,\n  SanityNode,\n  SanityStegaNode,\n  TypeSchema,\n} from '@sanity/presentation-comlink'\nimport {createContext} from 'react'\nimport type {OverlayElementField, OverlayElementParent} from '../../types'\n\nexport interface SchemaContextValue {\n  getField: (node: SanityNode | SanityStegaNode) => {\n    field: OverlayElementField\n    parent: OverlayElementParent\n  }\n  getType: <T extends 'document' | 'type' = 'document'>(\n    node: SanityNode | SanityStegaNode | string,\n    type?: T,\n  ) => T extends 'document' ? DocumentSchema | undefined : TypeSchema | undefined\n}\n\nexport const SchemaContext = createContext<SchemaContextValue | null>(null)\n","import {useContext} from 'react'\nimport {SchemaContext, type SchemaContextValue} from './SchemaContext'\n\nexport function useSchema(): SchemaContextValue {\n  const context = useContext(SchemaContext)\n\n  if (!context) {\n    throw new Error('Schema context is missing')\n  }\n\n  return context\n}\n","import {\n  ArrowDownIcon,\n  ArrowUpIcon,\n  CopyIcon,\n  InsertAboveIcon,\n  InsertBelowIcon,\n  PublishIcon,\n  RemoveIcon,\n  SortIcon,\n  UnpublishIcon,\n} from '@sanity/icons'\nimport type {\n  SanityNode,\n  SchemaArrayItem,\n  SchemaNode,\n  SchemaUnionNode,\n  SchemaUnionOption,\n} from '@sanity/presentation-comlink'\nimport type {SchemaType} from '@sanity/types'\nimport {MenuGroup} from '@sanity/ui/_visual-editing'\nimport {type FunctionComponent} from 'react'\nimport type {OptimisticDocument} from '../../optimistic'\nimport {InsertMenu} from '../../overlay-components/components/InsertMenu'\nimport type {ContextMenuNode, OverlayElementField, OverlayElementParent} from '../../types'\nimport {getNodeIcon} from '../../util/getNodeIcon'\nimport {\n  getArrayDuplicatePatches,\n  getArrayInsertPatches,\n  getArrayMovePatches,\n  getArrayRemovePatches,\n} from '../../util/mutations'\n\nexport function getArrayRemoveAction(node: SanityNode, doc: OptimisticDocument): () => void {\n  if (!node.type) throw new Error('Node type is missing')\n  return () =>\n    doc.patch(async ({getSnapshot}) => getArrayRemovePatches(node, (await getSnapshot())!))\n}\n\nfunction getArrayInsertAction(\n  node: SanityNode,\n  doc: OptimisticDocument,\n  insertType: string,\n  position: 'before' | 'after',\n): () => void {\n  if (!node.type) throw new Error('Node type is missing')\n  return () => doc.patch(() => getArrayInsertPatches(node, insertType, position))\n}\n\nfunction getDuplicateAction(node: SanityNode, doc: OptimisticDocument): () => void {\n  if (!node.type) throw new Error('Node type is missing')\n  return () =>\n    doc.patch(async ({getSnapshot}) => getArrayDuplicatePatches(node, (await getSnapshot())!))\n}\n\nexport function getContextMenuItems(context: {\n  doc: OptimisticDocument\n  field: OverlayElementField\n  node: SanityNode\n  parent: OverlayElementParent\n}): Promise<ContextMenuNode[]> {\n  const {node, field, parent, doc} = context\n  if (field?.type === 'arrayItem') {\n    return getContextMenuArrayItems({node, field, doc})\n  }\n  if (parent?.type === 'union') {\n    return getContextMenuUnionItems({node, parent, doc})\n  }\n\n  return Promise.resolve([])\n}\n\nfunction getDuplicateItem(context: {doc: OptimisticDocument; node: SanityNode}) {\n  const {node, doc} = context\n  if (!doc) return []\n  return [\n    {\n      type: 'action' as const,\n      label: 'Duplicate',\n      icon: CopyIcon,\n      action: getDuplicateAction(node, doc),\n      telemetryEvent: 'Visual Editing Context Menu Item Duplicated' as const,\n    },\n  ]\n}\n\nfunction getRemoveItems(context: {doc: OptimisticDocument; node: SanityNode}) {\n  const {node, doc} = context\n  if (!doc) return []\n  return [\n    {\n      type: 'action' as const,\n      label: 'Remove',\n      icon: RemoveIcon,\n      action: getArrayRemoveAction(node, doc),\n      telemetryEvent: 'Visual Editing Context Menu Item Removed' as const,\n    },\n  ]\n}\n\nasync function getMoveItems(\n  context: {\n    doc: OptimisticDocument\n    node: SanityNode\n  },\n  withDivider = true,\n) {\n  const {node, doc} = context\n  if (!doc) return []\n\n  const items: ContextMenuNode[] = []\n  const groupItems: ContextMenuNode[] = []\n\n  const [moveUpPatches, moveDownPatches, moveFirstPatches, moveLastPatches] = await Promise.all([\n    getArrayMovePatches(node, doc, 'previous'),\n    getArrayMovePatches(node, doc, 'next'),\n    getArrayMovePatches(node, doc, 'first'),\n    getArrayMovePatches(node, doc, 'last'),\n  ])\n\n  if (moveFirstPatches.length) {\n    groupItems.push({\n      type: 'action',\n      label: 'To top',\n      icon: PublishIcon,\n      action: () => doc.patch(moveFirstPatches),\n      telemetryEvent: 'Visual Editing Context Menu Item Moved',\n    })\n  }\n  if (moveUpPatches.length) {\n    groupItems.push({\n      type: 'action',\n      label: 'Up',\n      icon: ArrowUpIcon,\n      action: () => doc.patch(moveUpPatches),\n      telemetryEvent: 'Visual Editing Context Menu Item Moved',\n    })\n  }\n  if (moveDownPatches.length) {\n    groupItems.push({\n      type: 'action',\n      label: 'Down',\n      icon: ArrowDownIcon,\n      action: () => doc.patch(moveDownPatches),\n      telemetryEvent: 'Visual Editing Context Menu Item Moved',\n    })\n  }\n  if (moveLastPatches.length) {\n    groupItems.push({\n      type: 'action',\n      label: 'To bottom',\n      icon: UnpublishIcon,\n      action: () => doc.patch(moveLastPatches),\n      telemetryEvent: 'Visual Editing Context Menu Item Moved',\n    })\n  }\n\n  if (groupItems.length) {\n    items.push({\n      type: 'group',\n      label: 'Move',\n      icon: SortIcon,\n      items: groupItems,\n    })\n    if (withDivider) {\n      items.push({type: 'divider'})\n    }\n  }\n\n  return items\n}\n\nasync function getContextMenuArrayItems(context: {\n  doc: OptimisticDocument\n  field: SchemaArrayItem\n  node: SanityNode\n}): Promise<ContextMenuNode[]> {\n  const {node, field, doc} = context\n  const items: ContextMenuNode[] = []\n  items.push(...getDuplicateItem(context))\n  items.push(...getRemoveItems(context))\n  items.push(...(await getMoveItems(context)))\n\n  items.push({\n    type: 'action',\n    label: 'Insert before',\n    icon: InsertAboveIcon,\n    action: getArrayInsertAction(node, doc, field.name, 'before'),\n    telemetryEvent: 'Visual Editing Context Menu Item Inserted',\n  })\n  items.push({\n    type: 'action',\n    label: 'Insert after',\n    icon: InsertBelowIcon,\n    action: getArrayInsertAction(node, doc, field.name, 'after'),\n    telemetryEvent: 'Visual Editing Context Menu Item Inserted',\n  })\n\n  return items\n}\n\nconst InsertMenuWrapper: FunctionComponent<{\n  label: string\n  onSelect: (schemaType: SchemaType) => void\n  parent: SchemaUnionNode<SchemaNode>\n  width: number | undefined\n  boundaryElement: HTMLDivElement | null\n}> = (props) => {\n  const {label, parent, width, onSelect, boundaryElement} = props\n\n  return (\n    <MenuGroup\n      fontSize={1}\n      icon={InsertBelowIcon}\n      padding={2}\n      popover={{\n        arrow: false,\n        constrainSize: true,\n        floatingBoundary: boundaryElement,\n        padding: 0,\n        placement: 'right-start',\n        fallbackPlacements: [\n          'left-start',\n          'right',\n          'left',\n          'right-end',\n          'left-end',\n          'bottom',\n          'top',\n        ],\n        preventOverflow: true,\n        width,\n        __unstable_margins: [4, 4, 4, 4],\n      }}\n      space={2}\n      text={label}\n    >\n      <InsertMenu node={parent} onSelect={onSelect} />\n    </MenuGroup>\n  )\n}\n\nasync function getContextMenuUnionItems(context: {\n  doc: OptimisticDocument\n  node: SanityNode\n  parent: SchemaUnionNode<SchemaNode>\n}): Promise<ContextMenuNode[]> {\n  const {doc, node, parent} = context\n  const items: ContextMenuNode[] = []\n  items.push(...getDuplicateItem(context))\n  items.push(...getRemoveItems(context))\n  items.push(...(await getMoveItems(context)))\n\n  if (parent.options?.insertMenu) {\n    const insertMenuOptions = parent.options.insertMenu || {}\n    const width = insertMenuOptions.views?.some((view) => view.name === 'grid') ? 0 : undefined\n\n    items.push({\n      type: 'custom',\n      component: ({boundaryElement, sendTelemetry}) => {\n        const onSelect = (schemaType: SchemaType) => {\n          const action = getArrayInsertAction(node, doc, schemaType.name, 'before')\n          action()\n\n          sendTelemetry('Visual Editing Context Menu Item Inserted', null)\n        }\n        return (\n          <InsertMenuWrapper\n            label=\"Insert before\"\n            onSelect={onSelect}\n            parent={parent}\n            width={width}\n            boundaryElement={boundaryElement}\n          />\n        )\n      },\n    })\n\n    items.push({\n      type: 'custom',\n      component: ({boundaryElement, sendTelemetry}) => {\n        const onSelect = (schemaType: SchemaType) => {\n          const action = getArrayInsertAction(node, doc, schemaType.name, 'after')\n          action()\n\n          sendTelemetry('Visual Editing Context Menu Item Inserted', null)\n        }\n        return (\n          <InsertMenuWrapper\n            label=\"Insert after\"\n            onSelect={onSelect}\n            parent={parent}\n            width={width}\n            boundaryElement={boundaryElement}\n          />\n        )\n      },\n    })\n  } else {\n    items.push({\n      type: 'group',\n      label: 'Insert before',\n      icon: InsertAboveIcon,\n      items: (\n        parent.of.filter((item) => item.type === 'unionOption') as SchemaUnionOption<SchemaNode>[]\n      ).map((t) => {\n        return {\n          type: 'action' as const,\n          icon: getNodeIcon(t),\n          label: t.name === 'block' ? 'Paragraph' : t.title || t.name,\n          action: getArrayInsertAction(node, doc, t.name, 'before'),\n          telemetryEvent: 'Visual Editing Context Menu Item Inserted',\n        }\n      }),\n    })\n    items.push({\n      type: 'group',\n      label: 'Insert after',\n      icon: InsertBelowIcon,\n      items: (\n        parent.of.filter((item) => item.type === 'unionOption') as SchemaUnionOption<SchemaNode>[]\n      ).map((t) => {\n        return {\n          type: 'action' as const,\n          label: t.name === 'block' ? 'Paragraph' : t.title || t.name,\n          icon: getNodeIcon(t),\n          action: getArrayInsertAction(node, doc, t.name, 'after'),\n          telemetryEvent: 'Visual Editing Context Menu Item Inserted',\n        }\n      }),\n    })\n  }\n\n  return items\n}\n","import {\n  Box,\n  Flex,\n  Menu,\n  MenuDivider,\n  MenuGroup,\n  MenuItem,\n  Popover,\n  Spinner,\n  Stack,\n  Text,\n  type PopoverMargins,\n} from '@sanity/ui/_visual-editing'\nimport {useCallback, useEffect, useMemo, useState, type FunctionComponent} from 'react'\nimport {useDocuments} from '../../react/useDocuments'\nimport type {ContextMenuNode, ContextMenuProps} from '../../types'\nimport {getNodeIcon} from '../../util/getNodeIcon'\nimport {PopoverPortal} from '../PopoverPortal'\nimport {useSchema} from '../schema/useSchema'\nimport {useTelemetry} from '../telemetry/useTelemetry'\nimport {getContextMenuItems} from './contextMenuItems'\n\nconst POPOVER_MARGINS: PopoverMargins = [-4, 4, -4, 4]\n\nfunction ContextMenuItem(props: {\n  node: ContextMenuNode\n  onDismiss?: () => void\n  boundaryElement: HTMLDivElement | null\n}) {\n  const {node, onDismiss, boundaryElement} = props\n  const sendTelemetry = useTelemetry()\n\n  const onClick = useCallback(() => {\n    if (node.type === 'action') {\n      node.action?.()\n      onDismiss?.()\n\n      if (node.telemetryEvent) {\n        sendTelemetry(node.telemetryEvent, null)\n      }\n    }\n  }, [node, onDismiss, sendTelemetry])\n\n  if (node.type === 'divider') {\n    return <MenuDivider />\n  }\n\n  if (node.type === 'action') {\n    return (\n      <MenuItem\n        fontSize={1}\n        hotkeys={node.hotkeys}\n        icon={node.icon}\n        padding={2}\n        space={2}\n        text={node.label}\n        disabled={!node.action}\n        onClick={onClick}\n      />\n    )\n  }\n\n  if (node.type === 'group') {\n    return (\n      <MenuGroup\n        fontSize={1}\n        icon={node.icon}\n        padding={2}\n        // @todo when this PR lands https://github.com/sanity-io/ui/pull/1454\n        // menu={{\n        //   padding: 0,\n        // }}\n        popover={{\n          arrow: false,\n          constrainSize: true,\n          placement: 'right-start',\n          fallbackPlacements: [\n            'left-start',\n            'right',\n            'left',\n            'right-end',\n            'left-end',\n            'bottom',\n            'top',\n          ],\n          preventOverflow: true,\n          __unstable_margins: POPOVER_MARGINS,\n        }}\n        space={2}\n        text={node.label}\n      >\n        {node.items.map((item, itemIndex) => (\n          <ContextMenuItem\n            key={itemIndex}\n            node={item}\n            onDismiss={onDismiss}\n            boundaryElement={boundaryElement}\n          />\n        ))}\n      </MenuGroup>\n    )\n  }\n\n  if (node.type === 'custom') {\n    const {component: Component} = node\n    return <Component boundaryElement={boundaryElement} sendTelemetry={sendTelemetry} />\n  }\n\n  return null\n}\n\nexport const ContextMenu: FunctionComponent<ContextMenuProps> = (props) => {\n  const {\n    node,\n    onDismiss,\n    position: {x, y},\n  } = props\n\n  const [boundaryElement, setBoundaryElement] = useState<HTMLDivElement | null>(null)\n\n  const {getField} = useSchema()\n  const {getDocument} = useDocuments()\n\n  const {field, parent} = getField(node)\n\n  const title = useMemo(() => {\n    return field?.title || field?.name || 'Unknown type'\n  }, [field])\n\n  const [items, setItems] = useState<ContextMenuNode[] | undefined>(undefined)\n\n  useEffect(() => {\n    const fetchContextMenuItems = async () => {\n      const doc = getDocument(node.id)\n      if (!doc) return\n      const items = await getContextMenuItems({node, field, parent, doc})\n      setItems(items)\n    }\n    fetchContextMenuItems()\n  }, [field, node, parent, getDocument])\n\n  const contextMenuReferenceElement = useMemo(() => {\n    return {\n      getBoundingClientRect: () => ({\n        bottom: y,\n        left: x,\n        right: x,\n        top: y,\n        width: 0,\n        height: 0,\n      }),\n    } as HTMLElement\n  }, [x, y])\n\n  const icon = useMemo(() => {\n    return getNodeIcon(field)\n  }, [field])\n\n  return (\n    <PopoverPortal setBoundaryElement={setBoundaryElement} onDismiss={onDismiss}>\n      <Popover\n        __unstable_margins={POPOVER_MARGINS}\n        arrow={false}\n        open\n        placement=\"right-start\"\n        referenceElement={contextMenuReferenceElement}\n        content={\n          <Menu style={{minWidth: 120, maxWidth: 160}}>\n            <Flex gap={2} padding={2}>\n              <Box flex=\"none\">{items ? <Text size={1}>{icon}</Text> : <Spinner size={1} />}</Box>\n\n              <Stack flex={1} space={2}>\n                <Text size={1} weight=\"semibold\">\n                  {items ? title : 'Loading...'}\n                </Text>\n              </Stack>\n            </Flex>\n\n            {items && (\n              <>\n                <MenuDivider />\n                {items.map((item, i) => (\n                  <ContextMenuItem\n                    key={i}\n                    node={item}\n                    onDismiss={onDismiss}\n                    boundaryElement={boundaryElement}\n                  />\n                ))}\n              </>\n            )}\n          </Menu>\n        }\n      >\n        <div\n          key={`${x}-${y}`}\n          style={{\n            position: 'absolute',\n            left: x,\n            top: y,\n          }}\n        />\n      </Popover>\n    </PopoverPortal>\n  )\n}\n","export function getLinkHref(href: string, referer: string): string {\n  try {\n    const parsed = new URL(href, typeof location === 'undefined' ? undefined : location.origin)\n    if (parsed.hash) {\n      const hash = new URL(getLinkHref(parsed.hash.slice(1), referer))\n      return `${parsed.origin}${parsed.pathname}${parsed.search}#${hash.pathname}${hash.search}`\n    }\n    parsed.searchParams.set('preview', referer)\n    return parsed.toString()\n  } catch {\n    return href\n  }\n}\n","import type {PreviewSnapshot} from '@sanity/presentation-comlink'\nimport {createContext} from 'react'\n\nexport type PreviewSnapshotsContextValue = PreviewSnapshot[]\n\nexport const PreviewSnapshotsContext = createContext<PreviewSnapshotsContextValue | null>(null)\n","import {useContext} from 'react'\nimport {PreviewSnapshotsContext, type PreviewSnapshotsContextValue} from './PreviewSnapshotsContext'\n\nexport function usePreviewSnapshots(): PreviewSnapshotsContextValue {\n  const context = useContext(PreviewSnapshotsContext)\n\n  if (!context) {\n    throw new Error('Preview Snapshots context is missing')\n  }\n\n  return context\n}\n","import {createEditUrl, studioPath} from '@sanity/client/csm'\nimport {DocumentIcon, DragHandleIcon, EllipsisVerticalIcon, PlugIcon} from '@sanity/icons'\nimport {MenuButton, MenuDivider} from '@sanity/ui'\nimport {Box, Button, Card, Flex, Menu, MenuItem, Stack, Text} from '@sanity/ui/_visual-editing'\nimport {pathToUrlString} from '@sanity/visual-editing-csm'\nimport {\n  Fragment,\n  isValidElement,\n  memo,\n  useCallback,\n  useEffect,\n  useId,\n  useMemo,\n  useRef,\n  useState,\n  useSyncExternalStore,\n  type CSSProperties,\n  type FunctionComponent,\n  type MouseEventHandler,\n  type ReactElement,\n} from 'react'\nimport scrollIntoView from 'scroll-into-view-if-needed'\nimport {styled} from 'styled-components'\nimport {v4 as uuid} from 'uuid'\nimport {PointerEvents} from '../overlay-components/components/PointerEvents'\nimport type {\n  ElementChildTarget,\n  ElementFocusedState,\n  ElementNode,\n  OverlayComponent,\n  OverlayComponentResolver,\n  OverlayComponentResolverContext,\n  OverlayPluginDefinition,\n  OverlayPluginExclusiveDefinition,\n  OverlayPluginHudDefinition,\n  OverlayRect,\n  SanityNode,\n  SanityStegaNode,\n  VisualEditingNode,\n} from '../types'\nimport {getLinkHref} from '../util/getLinkHref'\nimport {PopoverBackground} from './PopoverPortal'\nimport {usePreviewSnapshots} from './preview/usePreviewSnapshots'\nimport {useSchema} from './schema/useSchema'\n\nconst isReactElementOverlayComponent = (\n  component:\n    | OverlayComponent\n    | {component: OverlayComponent; props?: Record<string, unknown>}\n    | Array<OverlayComponent | {component: OverlayComponent; props?: Record<string, unknown>}>\n    | ReactElement,\n): component is React.JSX.Element => {\n  return isValidElement(component)\n}\n\nexport interface ElementOverlayProps {\n  id: string\n  comlink?: VisualEditingNode\n  componentResolver?: OverlayComponentResolver\n  plugins?: OverlayPluginDefinition[]\n  draggable: boolean\n  element: ElementNode\n  focused: ElementFocusedState\n  hovered: boolean\n  isDragging: boolean\n  node: SanityNode | SanityStegaNode\n  rect: OverlayRect\n  showActions: boolean\n  wasMaybeCollapsed: boolean\n  enableScrollIntoView: boolean\n  targets: ElementChildTarget[]\n  elementType: 'element' | 'group'\n  onActivateExclusivePlugin?: (\n    plugin: OverlayPluginExclusiveDefinition,\n    context: OverlayComponentResolverContext,\n  ) => void\n  onMenuOpenChange: (open: boolean) => void\n}\n\nconst Root = styled(Card)`\n  background-color: var(--overlay-bg);\n  border-radius: 3px;\n  pointer-events: none;\n  position: absolute;\n  will-change: transform;\n  box-shadow: var(--overlay-box-shadow);\n  transition: none;\n\n  --overlay-bg: transparent;\n  --overlay-box-shadow: inset 0 0 0 1px transparent;\n\n  [data-overlays] & {\n    --overlay-bg: color-mix(in srgb, transparent 95%, var(--card-focus-ring-color));\n    --overlay-box-shadow: inset 0 0 0 2px\n      color-mix(in srgb, transparent 50%, var(--card-focus-ring-color));\n  }\n\n  [data-fading-out] & {\n    transition:\n      box-shadow 1550ms,\n      background-color 1550ms;\n\n    --overlay-bg: rgba(0, 0, 255, 0);\n    --overlay-box-shadow: inset 0 0 0 1px transparent;\n  }\n\n  &[data-focused] {\n    --overlay-box-shadow: inset 0 0 0 1px var(--card-focus-ring-color);\n  }\n\n  &[data-hovered]:not([data-focused]) {\n    transition: none;\n    --overlay-box-shadow: inset 0 0 0 2px var(--card-focus-ring-color);\n  }\n\n  /* [data-unmounted] & {\n    --overlay-box-shadow: inset 0 0 0 1px var(--card-focus-ring-color);\n  } */\n\n  :link {\n    text-decoration: none;\n  }\n`\n\nconst Actions = styled(Flex)`\n  bottom: 100%;\n  cursor: pointer;\n  pointer-events: none;\n  position: absolute;\n  right: 0;\n\n  [data-hovered]:not([data-menu-open]) & {\n    pointer-events: all;\n  }\n\n  [data-flipped] & {\n    bottom: auto;\n    top: 100%;\n  }\n`\n\nconst HUD = styled(Flex)`\n  top: 100%;\n  cursor: pointer;\n  pointer-events: none;\n  position: absolute;\n  left: 0;\n\n  gap: 4px;\n  padding: 4px 0;\n  flex-wrap: wrap;\n\n  [data-hovered]:not([data-menu-open]) & {\n    pointer-events: all;\n  }\n\n  [data-flipped] & {\n    top: calc(100% + 2rem);\n  }\n`\n\nconst MenuWrapper = styled(Flex)`\n  margin: -0.5rem;\n\n  [data-hovered]:not([data-menu-open]) & {\n    pointer-events: all;\n  }\n`\n\nconst Tab = styled(Flex)`\n  bottom: 100%;\n  cursor: pointer;\n  pointer-events: none;\n  position: absolute;\n  left: 0;\n\n  [data-hovered]:not([data-menu-open]) & {\n    pointer-events: all;\n  }\n\n  [data-flipped] & {\n    bottom: auto;\n    top: 100%;\n  }\n`\n\nconst ActionOpen = styled(Card)`\n  cursor: pointer;\n  background-color: var(--card-focus-ring-color);\n  right: 0;\n  border-radius: 3px;\n\n  & [data-ui='Text'] {\n    color: #fff;\n    white-space: nowrap;\n  }\n`\n\nconst Labels = styled(Flex)`\n  display: flex;\n  align-items: center;\n  background-color: var(--card-focus-ring-color);\n  right: 0;\n  border-radius: 3px;\n  & [data-ui='Text'],\n  & [data-sanity-icon] {\n    color: #fff;\n    white-space: nowrap;\n  }\n`\n\nconst ExclusivePluginContainer = styled.div`\n  position: absolute;\n  inset: 0;\n  pointer-events: all;\n`\n\nfunction createIntentLink(node: SanityNode) {\n  const {id, type, path, baseUrl, tool, workspace} = node\n\n  return createEditUrl({\n    baseUrl,\n    workspace,\n    tool,\n    type: type!,\n    id,\n    path: path ? pathToUrlString(studioPath.fromString(path)) : [],\n  })\n}\n\nconst ElementOverlayInner: FunctionComponent<ElementOverlayProps> = (props) => {\n  const {\n    id,\n    element,\n    focused,\n    componentResolver,\n    node,\n    showActions,\n    draggable,\n    targets,\n    elementType,\n    comlink,\n    onActivateExclusivePlugin,\n    onMenuOpenChange,\n  } = props\n\n  const {getField, getType} = useSchema()\n  const schemaType = getType(node)\n\n  const href = 'path' in node ? createIntentLink(node) : node.href\n\n  const previewSnapshots = usePreviewSnapshots()\n\n  const title = useMemo(() => {\n    if (!('path' in node)) return undefined\n    return previewSnapshots.find((snapshot) => snapshot._id === node.id)?.title\n  }, [node, previewSnapshots])\n\n  const resolverContexts = useMemo<{\n    legacyComponentContext: OverlayComponentResolverContext | undefined\n    pluginContexts: OverlayComponentResolverContext[]\n  }>(() => {\n    function getContext(\n      node: SanityNode | SanityStegaNode,\n      nodeElement?: ElementNode,\n    ): OverlayComponentResolverContext | undefined {\n      const schemaType = getType(node)\n      const {field, parent} = getField(node)\n      if (!('id' in node)) return undefined\n      if (!field || !schemaType) return undefined\n      const type = field.value.type\n      return {\n        document: schemaType,\n        element,\n        targetElement: nodeElement || element,\n        field,\n        focused: !!focused,\n        node,\n        parent,\n        type,\n      }\n    }\n    return {\n      legacyComponentContext: elementType === 'element' ? getContext(node) : undefined,\n      pluginContexts: targets\n        .map((target) => getContext(target.sanity, target.element))\n        .filter((ctx) => ctx !== undefined),\n    }\n  }, [elementType, node, targets, getType, getField, element, focused])\n\n  const customComponents = useCustomComponents(\n    resolverContexts.legacyComponentContext,\n    componentResolver,\n  )\n\n  const nodePluginCollections = useResolvedNodePlugins(\n    resolverContexts.pluginContexts,\n    props.plugins,\n  )\n\n  const icon = schemaType?.icon ? (\n    <div dangerouslySetInnerHTML={{__html: schemaType.icon}} />\n  ) : (\n    <DocumentIcon />\n  )\n\n  const menuId = useId()\n\n  const hasMenuitems = nodePluginCollections?.some(\n    (nodePluginCollection) => nodePluginCollection.exclusive.length > 0,\n  )\n  const showMenu = hasMenuitems || nodePluginCollections?.length > 1\n\n  const handleLabelClick = useCallback(() => {\n    window.dispatchEvent(new CustomEvent('sanity-overlay/label-click', {detail: {id}}))\n  }, [id])\n\n  return (\n    <>\n      <PointerEvents>\n        {showActions ? (\n          <Actions gap={1} paddingY={1}>\n            <Link href={href} />\n          </Actions>\n        ) : null}\n        {(title || showMenu) && (\n          <Tab gap={1} paddingY={1} onClick={handleLabelClick}>\n            <Labels gap={2} padding={2}>\n              {draggable && (\n                <Box marginRight={1}>\n                  <Text className=\"drag-handle\" size={0}>\n                    <DragHandleIcon />\n                  </Text>\n                </Box>\n              )}\n              <Text size={0}>{icon}</Text>\n\n              {title && (\n                <Text size={1} weight=\"medium\">\n                  {title}\n                </Text>\n              )}\n\n              {showMenu && (\n                <Box\n                  paddingLeft={2}\n                  onClick={(e) => {\n                    // Do not propagate and click the label too if clicking menu button\n                    e.stopPropagation()\n                  }}\n                >\n                  <MenuWrapper>\n                    <MenuButton\n                      id={menuId}\n                      popover={{\n                        animate: true,\n                        placement: 'bottom-start',\n                        constrainSize: true,\n                        tone: 'default',\n                      }}\n                      onOpen={() => {\n                        onMenuOpenChange?.(true)\n                      }}\n                      onClose={() => {\n                        onMenuOpenChange?.(false)\n                      }}\n                      button={<Button icon={EllipsisVerticalIcon} tone=\"primary\" padding={2} />}\n                      menu={\n                        <Menu paddingY={0}>\n                          <PointerEvents>\n                            {nodePluginCollections?.map((nodePluginCollection, index) => (\n                              <Fragment key={nodePluginCollection.id}>\n                                <Stack role=\"group\" paddingY={1} space={0}>\n                                  <MenuItem\n                                    paddingY={2}\n                                    text={\n                                      <Box paddingY={2}>\n                                        <Text muted size={1} style={{textTransform: 'capitalize'}}>\n                                          {`${nodePluginCollection.context.document.name}: ${nodePluginCollection.context.field?.name}`}\n                                        </Text>\n                                      </Box>\n                                    }\n                                    onClick={() => {\n                                      if (nodePluginCollection.context.node) {\n                                        comlink?.post(\n                                          'visual-editing/focus',\n                                          nodePluginCollection.context.node,\n                                        )\n                                      }\n                                    }}\n                                  />\n                                  {nodePluginCollection.exclusive.map((exclusive) => {\n                                    const Component = exclusive.component\n                                    if (!Component) return null\n                                    return (\n                                      <MenuItem\n                                        paddingY={2}\n                                        key={exclusive.name}\n                                        icon={exclusive.icon || <PlugIcon />}\n                                        text={\n                                          <Box paddingY={2}>\n                                            <Text size={1}>\n                                              {exclusive.title || exclusive.name}\n                                            </Text>\n                                          </Box>\n                                        }\n                                        onClick={() =>\n                                          onActivateExclusivePlugin?.(\n                                            exclusive,\n                                            nodePluginCollection.context,\n                                          )\n                                        }\n                                      />\n                                    )\n                                  })}\n                                </Stack>\n                                {index < nodePluginCollections.length - 1 && <MenuDivider />}\n                              </Fragment>\n                            ))}\n                          </PointerEvents>\n                        </Menu>\n                      }\n                    />\n                  </MenuWrapper>\n                </Box>\n              )}\n            </Labels>\n          </Tab>\n        )}\n\n        <HUD>\n          {nodePluginCollections?.map((nodePluginCollection) => (\n            <Fragment key={nodePluginCollection.id}>\n              {nodePluginCollection.hud.map((hud) => {\n                const Component = hud.component\n                if (!Component) return null\n                return <Component key={hud.name} {...nodePluginCollection.context} />\n              })}\n            </Fragment>\n          ))}\n        </HUD>\n      </PointerEvents>\n\n      {Array.isArray(customComponents)\n        ? customComponents.map(({component: Component, props}, i) => {\n            return (\n              <Component\n                key={i}\n                PointerEvents={PointerEvents}\n                {...resolverContexts.legacyComponentContext!}\n                {...props}\n              />\n            )\n          })\n        : customComponents}\n    </>\n  )\n}\n\nexport const ElementOverlay = memo(function ElementOverlay(\n  props: Omit<ElementOverlayProps, 'setActiveExclusivePlugin' | 'onMenuOpenChange'>,\n) {\n  const {draggable, focused, hovered, rect, wasMaybeCollapsed, enableScrollIntoView} = props\n\n  const ref = useRef<HTMLDivElement>(null)\n\n  const scrolledIntoViewRef = useRef(false)\n\n  const style = useMemo<CSSProperties>(\n    () => ({\n      width: `${rect.w}px`,\n      height: `${rect.h}px`,\n      transform: `translate(${rect.x}px, ${rect.y}px)`,\n    }),\n    [rect],\n  )\n\n  useEffect(() => {\n    if (\n      !scrolledIntoViewRef.current &&\n      !wasMaybeCollapsed &&\n      focused === true &&\n      ref.current &&\n      enableScrollIntoView\n    ) {\n      const target = ref.current\n      scrollIntoView(ref.current, {\n        // Workaround issue with scroll-into-view-if-needed struggling with iframes\n        behavior: (actions) => {\n          if (actions.length === 0) {\n            // An empty actions list equals scrolling isn't needed\n            return\n          }\n          // Uses native scrollIntoView to ensure iframes behave correctly\n          target.scrollIntoView({\n            behavior: 'smooth',\n            block: 'center',\n            inline: 'nearest',\n          })\n        },\n        scrollMode: 'if-needed',\n        block: 'center',\n        inline: 'nearest',\n      })\n    }\n\n    scrolledIntoViewRef.current = focused === true\n  }, [focused, wasMaybeCollapsed, enableScrollIntoView])\n\n  const [isNearTop, setIsNearTop] = useState(false)\n  useEffect(() => {\n    if (!ref.current || !hovered) return undefined\n\n    const io = new IntersectionObserver(\n      ([intersection]) => {\n        setIsNearTop(intersection.boundingClientRect.top < 0)\n      },\n      {threshold: 1},\n    )\n    io.observe(ref.current)\n    return () => io.disconnect()\n  }, [hovered, isNearTop])\n\n  const [activeExclusivePlugin, setActiveExclusivePlugin] = useState<{\n    plugin: OverlayPluginExclusiveDefinition\n    context: OverlayComponentResolverContext\n  } | null>(null)\n\n  const closeExclusivePluginView = useCallback(() => {\n    setActiveExclusivePlugin(null)\n    window.dispatchEvent(new CustomEvent('sanity-overlay/exclusive-plugin-closed'))\n  }, [])\n\n  const onActivateExclusivePlugin = useCallback(\n    (plugin: OverlayPluginExclusiveDefinition, context: OverlayComponentResolverContext) => {\n      setActiveExclusivePlugin({plugin, context})\n    },\n    [],\n  )\n\n  const handleExclusivePluginClick: MouseEventHandler<HTMLDivElement> = (event) => {\n    event.stopPropagation()\n  }\n\n  const ExclusivePluginComponent = activeExclusivePlugin?.plugin.component\n\n  const [menuOpen, setMenuOpen] = useState(false)\n\n  useEffect(() => {\n    setMenuOpen(false)\n  }, [hovered])\n\n  return (\n    <>\n      {menuOpen || ExclusivePluginComponent ? (\n        <PopoverBackground onDismiss={closeExclusivePluginView} blockScroll={menuOpen} />\n      ) : null}\n      <Root\n        data-focused={focused ? '' : undefined}\n        data-hovered={hovered ? '' : undefined}\n        data-flipped={isNearTop ? '' : undefined}\n        data-draggable={draggable ? '' : undefined}\n        data-menu-open={menuOpen ? '' : undefined}\n        ref={ref}\n        style={style}\n      >\n        {ExclusivePluginComponent ? (\n          <ExclusivePluginContainer\n            data-sanity-overlay-element\n            onClick={handleExclusivePluginClick}\n          >\n            <ExclusivePluginComponent\n              {...activeExclusivePlugin.context}\n              closeExclusiveView={closeExclusivePluginView}\n            />\n          </ExclusivePluginContainer>\n        ) : hovered ? (\n          <ElementOverlayInner\n            {...props}\n            onActivateExclusivePlugin={onActivateExclusivePlugin}\n            onMenuOpenChange={setMenuOpen}\n          />\n        ) : null}\n      </Root>\n    </>\n  )\n})\n\ninterface NodePluginCollection {\n  id: string\n  context: OverlayComponentResolverContext\n  hud: OverlayPluginHudDefinition[]\n  exclusive: OverlayPluginExclusiveDefinition[]\n}\n\nfunction useResolvedNodePlugins(\n  componentContexts: OverlayComponentResolverContext[],\n  plugins?: OverlayPluginDefinition[],\n) {\n  return useMemo(\n    () =>\n      componentContexts.map((componentContext) => {\n        const instance: NodePluginCollection = {\n          id: uuid(),\n          context: componentContext,\n          hud: [],\n          exclusive: [],\n        }\n\n        plugins?.forEach((plugin) => {\n          if (!plugin.guard?.(componentContext)) return\n          if (plugin.type === 'hud') instance.hud.push(plugin)\n          if (plugin.type === 'exclusive') instance.exclusive.push(plugin)\n        })\n\n        return instance\n      }),\n    [componentContexts, plugins],\n  )\n}\n\nfunction useCustomComponents(\n  componentContext: OverlayComponentResolverContext | undefined,\n  componentResolver: OverlayComponentResolver | undefined,\n) {\n  return useMemo(() => {\n    if (!componentContext) return undefined\n    const resolved = componentResolver?.(componentContext)\n    if (!resolved) return undefined\n\n    if (isReactElementOverlayComponent(resolved)) {\n      return resolved\n    }\n\n    return (Array.isArray(resolved) ? resolved : [resolved]).map((component) => {\n      if (typeof component === 'object' && 'component' in component) {\n        return component\n      }\n      return {component, props: {}}\n    })\n  }, [componentResolver, componentContext])\n}\n\nconst Link = memo(function Link(props: {href: string}) {\n  const referer = useSyncExternalStore(\n    useCallback((onStoreChange) => {\n      const handlePopState = () => onStoreChange()\n      window.addEventListener('popstate', handlePopState)\n      return () => window.removeEventListener('popstate', handlePopState)\n    }, []),\n    () => window.location.href,\n  )\n  const href = useMemo(() => getLinkHref(props.href, referer), [props.href, referer])\n\n  return (\n    <Box as=\"a\" href={href} target=\"_blank\" rel=\"noopener noreferrer\">\n      <ActionOpen padding={2}>\n        <Text size={1} weight=\"medium\">\n          Open in Studio\n        </Text>\n      </ActionOpen>\n    </Box>\n  )\n})\n","import type {FunctionComponent} from 'react'\nimport type {OverlayRect} from '../types'\n\nexport const OverlayDragGroupRect: FunctionComponent<{\n  dragGroupRect: OverlayRect\n}> = ({dragGroupRect}) => {\n  return (\n    <div\n      style={{\n        position: 'absolute',\n        top: `${dragGroupRect.y}px`,\n        left: `${dragGroupRect.x}px`,\n        width: `${dragGroupRect.w - 1}px`,\n        height: `${dragGroupRect.h - 1}px`,\n        border: '1px dashed #f0709b',\n        pointerEvents: 'none',\n      }}\n    ></div>\n  )\n}\n","import type {FunctionComponent} from 'react'\nimport type {DragInsertPosition} from '../types'\n\nconst markerThickness = 6\n\nfunction lerp(v0: number, v1: number, t: number) {\n  return v0 * (1 - t) + v1 * t\n}\n\nexport const OverlayDragInsertMarker: FunctionComponent<{\n  dragInsertPosition: DragInsertPosition\n}> = ({dragInsertPosition}) => {\n  if (dragInsertPosition === null) return\n\n  const flow = dragInsertPosition?.left || dragInsertPosition?.right ? 'horizontal' : 'vertical'\n\n  let x = 0\n  let y = 0\n  let width = 0\n  let height = 0\n  const offsetMultiplier = 0.0125\n\n  if (flow === 'horizontal') {\n    const {left, right} = dragInsertPosition\n\n    width = markerThickness\n\n    if (right && left) {\n      const startX = left.rect.x + left.rect.w\n      const endX = right.rect.x\n      const targetHeight = Math.min(right.rect.h, left.rect.h)\n      const offset = targetHeight * offsetMultiplier\n\n      x = lerp(startX, endX, 0.5) - markerThickness / 2\n      y = left.rect.y + offset\n\n      height = Math.min(right.rect.h, left.rect.h) - offset * 2\n    } else if (right && !left) {\n      const targetHeight = right.rect.h\n      const offset = targetHeight * offsetMultiplier\n\n      x = right.rect.x - markerThickness / 2\n      y = right.rect.y + offset\n      height = right.rect.h - offset * 2\n    } else if (left && !right) {\n      const targetHeight = left.rect.h\n      const offset = targetHeight * offsetMultiplier\n\n      x = left.rect.x + left.rect.w - markerThickness / 2\n      y = left.rect.y + offset\n      height = left.rect.h - offset * 2\n    }\n  } else {\n    const {bottom, top} = dragInsertPosition\n\n    if (bottom && top) {\n      const startX = Math.min(top.rect.x, bottom.rect.x)\n      const startY = top.rect.y + top.rect.h\n      const endY = bottom.rect.y\n      const targetWidth = Math.min(bottom.rect.w, top.rect.w)\n      const offset = targetWidth * offsetMultiplier\n\n      height = markerThickness\n\n      x = startX + offset\n      y = lerp(startY, endY, 0.5) - markerThickness / 2\n      width = Math.max(bottom.rect.w, top.rect.w) - offset * 2\n    } else if (bottom && !top) {\n      const targetWidth = bottom.rect.w\n      const offset = targetWidth * offsetMultiplier\n\n      x = bottom.rect.x + offset\n      y = bottom.rect.y - markerThickness / 2\n      width = bottom.rect.w - offset * 2\n      height = markerThickness\n    } else if (top && !bottom) {\n      const targetWidth = top.rect.w\n      const offset = targetWidth * offsetMultiplier\n\n      x = top.rect.x + offset\n      y = top.rect.y + top.rect.h - markerThickness / 2\n      width = top.rect.w - offset * 2\n      height = markerThickness\n    }\n  }\n\n  return (\n    <div\n      style={{\n        position: 'absolute',\n        width: `${width}px`,\n        height: `${height}px`,\n        transform: `translate(${x}px, ${y}px)`,\n        background: '#556bfc',\n        border: '2px solid white',\n        borderRadius: '999px',\n        zIndex: '999999',\n      }}\n    ></div>\n  )\n}\n","import {Card, usePrefersDark, useTheme_v2} from '@sanity/ui/_visual-editing'\nimport type {FunctionComponent} from 'react'\nimport {styled} from 'styled-components'\nimport type {DragSkeleton} from '../types'\n\nconst Root = styled.div<{\n  $width: number\n  $height: number\n  $offsetX: number\n  $offsetY: number\n  $scaleFactor: number\n}>`\n  --drag-preview-opacity: 0.98;\n  --drag-preview-skeleton-stroke: #ffffff;\n\n  @media (prefers-color-scheme: dark) {\n    --drag-preview-skeleton-stroke: #383d51;\n  }\n\n  position: fixed;\n  display: grid;\n  transform: ${({$scaleFactor, $width, $height}) =>\n    `translate(calc(var(--drag-preview-x) - ${$width / 2}px), calc(var(--drag-preview-y) - ${$height / 2}px)) scale(${$scaleFactor})`};\n  width: ${({$width}) => `${$width}px`};\n  height: ${({$height}) => `${$height}px`};\n  z-index: 9999999;\n  opacity: var(--drag-preview-opacity);\n  cursor: move;\n\n  .drag-preview-content-wrapper {\n    position: relative;\n    width: 100%;\n    height: 100%;\n    container-type: inline-size;\n  }\n\n  [data-ui='card'] {\n    position: relative;\n    width: 100%;\n    height: 100%;\n  }\n\n  .drag-preview-skeleton {\n    position: absolute;\n    inset: 0;\n\n    rect {\n      stroke: var(--drag-preview-skeleton-stroke);\n    }\n  }\n\n  .drag-preview-handle {\n    position: absolute;\n    top: 4cqmin;\n    left: 4cqmin;\n    width: 6cqmin;\n    fill: var(--drag-preview-handle-fill);\n  }\n`\n\nfunction clamp(number: number, min: number, max: number): number {\n  return number < min ? min : number > max ? max : number\n}\n\nfunction map(number: number, inMin: number, inMax: number, outMin: number, outMax: number): number {\n  const mapped: number = ((number - inMin) * (outMax - outMin)) / (inMax - inMin) + outMin\n  return clamp(mapped, outMin, outMax)\n}\n\nexport const OverlayDragPreview: FunctionComponent<{skeleton: DragSkeleton}> = ({skeleton}) => {\n  const maxSkeletonWidth = Math.min(skeleton.maxWidth, window.innerWidth / 2)\n  const scaleFactor = skeleton.w > maxSkeletonWidth ? maxSkeletonWidth / skeleton.w : 1\n\n  const offsetX = skeleton.offsetX * scaleFactor\n  const offsetY = skeleton.offsetY * scaleFactor\n\n  const prefersDark = usePrefersDark()\n  const theme = useTheme_v2()\n\n  const radius = theme.radius[~~map(skeleton.w, 0, 1920, 1, theme.radius.length - 2)]\n\n  const imageRects = skeleton.childRects.filter((r) => r.tagName === 'IMG')\n  const textRects = skeleton.childRects.filter((r) => r.tagName !== 'IMG')\n\n  return (\n    <Root\n      $width={skeleton.w}\n      $height={skeleton.h}\n      $offsetX={offsetX}\n      $offsetY={offsetY}\n      $scaleFactor={scaleFactor}\n    >\n      <Card\n        radius={radius}\n        shadow={4}\n        overflow=\"hidden\"\n        tone=\"transparent\"\n        scheme={prefersDark ? 'dark' : 'light'}\n      >\n        <div className=\"drag-preview-content-wrapper\">\n          <svg className=\"drag-preview-skeleton\" viewBox={`0 0 ${skeleton.w} ${skeleton.h}`}>\n            {/* render image rects first to account for background images overlapping text */}\n            {[...imageRects, ...textRects].map((r, i) => (\n              <rect\n                key={i}\n                x={r.x}\n                y={r.y}\n                width={r.w}\n                height={r.h}\n                fill={theme.color.skeleton.from}\n              ></rect>\n            ))}\n          </svg>\n        </div>\n      </Card>\n    </Root>\n  )\n}\n","import {ExpandIcon} from '@sanity/icons'\nimport {Card, Flex, Hotkeys, Text} from '@sanity/ui/_visual-editing'\nimport type {FunctionComponent} from 'react'\nimport {styled} from 'styled-components'\n\nconst Root = styled(Card)`\n  position: fixed;\n  bottom: 2rem;\n  left: 2rem;\n`\n\nexport const OverlayMinimapPrompt: FunctionComponent = () => {\n  return (\n    <Root padding={2} shadow={2} radius={2} style={{zIndex: '999999'}}>\n      <Flex align=\"center\" gap={2}>\n        <Hotkeys keys={['Shift']} />\n        <Text size={1}>Zoom Out</Text>\n        <ExpandIcon />\n      </Flex>\n    </Root>\n  )\n}\n","import type {VisualEditingControllerMsg} from '@sanity/presentation-comlink'\nimport type {ElementState, OverlayMsg} from '../types'\n\n/**\n * Reducer for managing element state from received channel messages\n * @internal\n */\nexport const elementsReducer = (\n  elements: ElementState[],\n  message: OverlayMsg | VisualEditingControllerMsg,\n): ElementState[] => {\n  const {type} = message\n  switch (type) {\n    case 'element/register': {\n      const elementExists = !!elements.find((e) => e.id === message.id)\n      if (elementExists) return elements\n\n      return [\n        ...elements,\n        {\n          id: message.id,\n          activated: false,\n          element: message.element,\n          focused: false,\n          hovered: false,\n          rect: message.rect,\n          sanity: message.sanity,\n          dragDisabled: message.dragDisabled,\n          targets: message.targets,\n          elementType: message.elementType,\n        },\n      ]\n    }\n    case 'element/activate':\n      return elements.map((e) => {\n        if (e.id === message.id) {\n          return {...e, activated: true}\n        }\n        return e\n      })\n    case 'element/update': {\n      return elements.map((e) => {\n        if (e.id === message.id) {\n          return {\n            ...e,\n            sanity: message.sanity,\n            rect: message.rect,\n            targets: message.targets,\n            elementType: message.elementType,\n          }\n        }\n        return e\n      })\n    }\n    case 'element/unregister':\n      return elements.filter((e) => e.id !== message.id)\n    case 'element/deactivate':\n      return elements.map((e) => {\n        if (e.id === message.id) {\n          return {...e, activated: false, hovered: false}\n        }\n        return e\n      })\n    case 'element/mouseenter':\n      return elements.map((e) => {\n        if (e.id === message.id) {\n          return {...e, rect: message.rect, hovered: true}\n        }\n        return {...e, hovered: false}\n      })\n    case 'element/mouseleave':\n      return elements.map((element) => {\n        if (element.id === message.id) {\n          return {...element, hovered: false}\n        }\n        return element\n      })\n    case 'element/updateRect':\n      return elements.map((element) => {\n        if (element.id === message.id) {\n          return {...element, rect: message.rect}\n        }\n        return element\n      })\n    case 'element/click':\n      return elements.map((e) => {\n        return {...e, focused: e.id === message.id && 'clicked'}\n      })\n    case 'overlay/reset-mouse-state':\n      return elements.map((e) => {\n        return {...e, focused: false, hovered: false}\n      })\n    case 'overlay/blur':\n      return elements.map((e) => {\n        return {...e, focused: false}\n      })\n    case 'presentation/blur':\n      return elements.map((e) => {\n        return {...e, focused: false}\n      })\n    case 'presentation/focus': {\n      // Before setting the focus state of each element, check to see if any\n      // element has gained focus from an `element/click` message. Presentation\n      // tool \"reflects\" these back as a `presentation/focus` message.\n      const clickedElement = elements.find((e) => e.focused === 'clicked')\n      return elements.map((e) => {\n        // We want to focus any element which matches the received id and path\n        const focused =\n          'path' in e.sanity &&\n          e.sanity.id === message.data.id &&\n          e.sanity.path === message.data.path\n\n        // If we have a 'clicked' element, and that element matches, it is a\n        // reflection, so we maintain the focus state\n        if (clickedElement && e === clickedElement && focused) {\n          return e\n        }\n\n        return {\n          ...e,\n          // Mark as a dupe if another matching item has been clicked to prevent\n          // scrolling, otherwise just set focus as a boolean\n          focused: focused && clickedElement ? 'duplicate' : focused,\n        }\n      })\n    }\n    default:\n      return elements\n  }\n}\n","import type {ClientPerspective} from '@sanity/client'\nimport type {SanityNode, VisualEditingControllerMsg} from '@sanity/presentation-comlink'\nimport type {\n  DragInsertPosition,\n  DragSkeleton,\n  ElementState,\n  OverlayMsg,\n  OverlayRect,\n} from '../types'\nimport {elementsReducer} from './elementsReducer'\n\nexport interface OverlayState {\n  contextMenu: {\n    node: SanityNode\n    position: {\n      x: number\n      y: number\n    }\n  } | null\n  focusPath: string\n  elements: ElementState[]\n  wasMaybeCollapsed: boolean\n  perspective: ClientPerspective\n  isDragging: boolean\n  dragInsertPosition: DragInsertPosition\n  dragSkeleton: DragSkeleton | null\n  dragShowMinimap: boolean\n  dragShowMinimapPrompt: boolean\n  dragMinimapTransition: boolean\n  dragGroupRect: OverlayRect | null\n}\n\nexport function overlayStateReducer(\n  state: OverlayState,\n  message: OverlayMsg | VisualEditingControllerMsg,\n): OverlayState {\n  const {type} = message\n  let {\n    contextMenu,\n    focusPath,\n    perspective,\n    isDragging,\n    dragInsertPosition,\n    dragShowMinimap,\n    dragShowMinimapPrompt,\n    dragSkeleton,\n    dragMinimapTransition,\n    dragGroupRect,\n  } = state\n  let wasMaybeCollapsed = false\n\n  if (type === 'presentation/focus') {\n    const prevFocusPath = state.focusPath\n\n    focusPath = message.data.path\n\n    if (prevFocusPath !== focusPath) {\n      wasMaybeCollapsed = prevFocusPath.slice(focusPath.length).startsWith('[')\n    }\n  }\n\n  if (type === 'presentation/perspective') {\n    perspective = message.data.perspective\n  }\n\n  if (type === 'element/contextmenu') {\n    if ('sanity' in message) {\n      contextMenu = {node: message.sanity, position: message.position}\n    } else {\n      contextMenu = null\n    }\n  }\n\n  if (\n    type === 'element/click' ||\n    type === 'element/mouseleave' ||\n    type === 'overlay/blur' ||\n    type === 'presentation/blur' ||\n    type === 'presentation/focus'\n  ) {\n    contextMenu = null\n  }\n\n  if (type === 'overlay/dragUpdateInsertPosition') {\n    dragInsertPosition = message.insertPosition\n  }\n\n  if (type === 'overlay/dragStart') {\n    isDragging = true\n  }\n\n  if (message.type === 'overlay/dragUpdateSkeleton') {\n    dragSkeleton = message.skeleton\n  }\n\n  if (type === 'overlay/dragEnd') {\n    isDragging = false\n  }\n\n  if (message.type === 'overlay/dragToggleMinimapPrompt') {\n    dragShowMinimapPrompt = message.display\n  }\n\n  if (type === 'overlay/dragStartMinimapTransition') {\n    dragMinimapTransition = true\n  }\n\n  if (type === 'overlay/dragEndMinimapTransition') {\n    dragMinimapTransition = false\n  }\n\n  if (type === 'overlay/dragUpdateGroupRect') {\n    dragGroupRect = message.groupRect\n  }\n\n  if (type === 'overlay/dragToggleMinimap') {\n    dragShowMinimap = message.display\n  }\n\n  return {\n    ...state,\n    contextMenu,\n    elements: elementsReducer(state.elements, message),\n    dragInsertPosition,\n    dragSkeleton,\n    dragGroupRect,\n    isDragging,\n    focusPath,\n    perspective,\n    wasMaybeCollapsed,\n    dragShowMinimap,\n    dragShowMinimapPrompt,\n    dragMinimapTransition,\n  }\n}\n","import {\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n  type FunctionComponent,\n  type PropsWithChildren,\n} from 'react'\nimport type {VisualEditingNode} from '../../types'\nimport {PreviewSnapshotsContext, type PreviewSnapshotsContextValue} from './PreviewSnapshotsContext'\n\nexport const PreviewSnapshotsProvider: FunctionComponent<\n  PropsWithChildren<{\n    comlink?: VisualEditingNode\n  }>\n> = function (props) {\n  const {comlink, children} = props\n\n  const [previewSnapshots, setPreviewSnapshots] = useState<PreviewSnapshotsContextValue>([])\n\n  const fetchPreviewSnapshots = useCallback(\n    async (signal: AbortSignal) => {\n      if (!comlink) return\n      try {\n        const response = await comlink.fetch('visual-editing/preview-snapshots', undefined, {\n          signal,\n          suppressWarnings: true,\n        })\n        setPreviewSnapshots(response.snapshots)\n      } catch {\n        // Fail silently as the app may be communicating with a version of\n        // Presentation that does not support this feature\n      }\n    },\n    [comlink],\n  )\n  useEffect(() => {\n    if (!comlink) return\n\n    const previewSapshotsFetch = new AbortController()\n    const unsub = comlink.onStatus(() => {\n      fetchPreviewSnapshots(previewSapshotsFetch.signal)\n    }, 'connected')\n\n    return () => {\n      previewSapshotsFetch.abort()\n      unsub()\n    }\n  }, [comlink, fetchPreviewSnapshots])\n\n  useEffect(() => {\n    return comlink?.on('presentation/preview-snapshots', (data) => {\n      setPreviewSnapshots(data.snapshots)\n    })\n  }, [comlink])\n\n  const context = useMemo<PreviewSnapshotsContextValue>(() => previewSnapshots, [previewSnapshots])\n  return (\n    <PreviewSnapshotsContext.Provider value={context}>{children}</PreviewSnapshotsContext.Provider>\n  )\n}\n","import type {\n  DocumentSchema,\n  ResolvedSchemaTypeMap,\n  SanityNode,\n  SanityStegaNode,\n  SchemaType,\n  TypeSchema,\n  UnresolvedPath,\n} from '@sanity/presentation-comlink'\nimport {\n  useCallback,\n  useDeferredValue,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n  type FunctionComponent,\n  type PropsWithChildren,\n} from 'react'\nimport type {\n  ElementState,\n  OverlayElementField,\n  OverlayElementParent,\n  VisualEditingNode,\n} from '../../types'\nimport {SchemaContext, type SchemaContextValue} from './SchemaContext'\n\nfunction isSanityNode(node: SanityNode | SanityStegaNode): node is SanityNode {\n  return 'path' in node\n}\n\nfunction isDocumentSchemaType(type: SchemaType): type is DocumentSchema {\n  return type.type === 'document'\n}\n\nfunction isTypeSchemaType(type: SchemaType): type is TypeSchema {\n  return type.type === 'type'\n}\n\nfunction popUnkeyedPathSegments(path: string): string {\n  return path\n    .split('.')\n    .toReversed()\n    .reduce((acc, part) => {\n      if (acc.length) return [part, ...acc]\n      if (part.includes('[_key==')) return [part]\n      return []\n    }, [] as string[])\n    .join('.')\n}\n\nfunction getPathsWithUnresolvedTypes(elements: ElementState[]): {id: string; path: string}[] {\n  return elements.reduce((acc, element) => {\n    const {sanity} = element\n    if (!('id' in sanity)) return acc\n    if (!sanity.path.includes('[_key==')) return acc\n    const path = popUnkeyedPathSegments(sanity.path)\n    if (!acc.find((item) => item.id === sanity.id && item.path === path)) {\n      acc.push({id: sanity.id, path})\n    }\n    return acc\n  }, [] as UnresolvedPath[])\n}\n\nexport const SchemaProvider: FunctionComponent<\n  PropsWithChildren<{\n    comlink?: VisualEditingNode\n    elements: ElementState[]\n  }>\n> = function (props) {\n  const {comlink, children, elements} = props\n\n  const [resolvedTypes, setResolvedTypes] = useState<ResolvedSchemaTypeMap>(new Map())\n\n  const [schema, setSchema] = useState<SchemaType[] | null>(null)\n\n  useEffect(() => {\n    if (!comlink) return\n\n    async function fetchSchema(signal: AbortSignal) {\n      if (!comlink) return\n      try {\n        const response = await comlink.fetch('visual-editing/schema', undefined, {\n          signal,\n          suppressWarnings: true,\n        })\n        setSchema(response.schema)\n      } catch {\n        // Fail silently as the app may be communicating with a version of\n        // Presentation that does not support this feature\n      }\n    }\n    const schemaFetch = new AbortController()\n    const unsub = comlink.onStatus(() => {\n      fetchSchema(schemaFetch.signal)\n    }, 'connected')\n\n    return () => {\n      schemaFetch.abort()\n      unsub()\n    }\n  }, [comlink])\n\n  const reportedPathsRef = useRef<UnresolvedPath[]>([])\n  const paths = getPathsWithUnresolvedTypes(useDeferredValue(elements))\n  const controllerRef = useRef<AbortController | null>(null)\n\n  useEffect(() => {\n    if (!paths.length || !comlink) return\n    // We report a list of paths that reference array items using a _key. We need\n    // to resolve the types of each of these items so we can map them to the\n    // correct schema types. One day CSM might include this data for us.\n    const reportPaths = async (paths: UnresolvedPath[], signal: AbortSignal) => {\n      const initialReportedPaths = reportedPathsRef.current\n      try {\n        reportedPathsRef.current = paths\n        const response = await comlink.fetch(\n          'visual-editing/schema-union-types',\n          {paths},\n          {signal, suppressWarnings: true},\n        )\n        if (signal.aborted) return\n        setResolvedTypes(response.types)\n        controllerRef.current = null\n      } catch {\n        // Fail silently as the app may be communicating with a version of\n        // Presentation that does not support this feature\n      }\n      if (signal.aborted) {\n        reportedPathsRef.current = initialReportedPaths\n      }\n    }\n\n    if (\n      paths.some(\n        (p) => !reportedPathsRef.current.find(({id, path}) => id === p.id && path === p.path),\n      )\n    ) {\n      // Abort any previous requests\n      controllerRef.current?.abort()\n      controllerRef.current = new AbortController()\n      reportPaths(paths, controllerRef.current.signal)\n    }\n  }, [comlink, paths])\n\n  const getType = useCallback(\n    <T extends 'document' | 'type' = 'document'>(\n      node: SanityNode | SanityStegaNode | string,\n      _type?: T,\n    ): T extends 'document' ? DocumentSchema | undefined : TypeSchema | undefined => {\n      const type = _type || 'document'\n      if (\n        !schema ||\n        (typeof node !== 'string' && (!isSanityNode(node) || !Array.isArray(schema)))\n      ) {\n        return undefined\n      }\n      const name = typeof node === 'string' ? node : node.type\n      const filter = type === 'document' ? isDocumentSchemaType : isTypeSchemaType\n      return schema\n        .filter(filter)\n        .find((schemaType) => schemaType.name === name) as T extends 'document'\n        ? DocumentSchema | undefined\n        : TypeSchema | undefined\n    },\n    [schema],\n  )\n\n  const getField = useCallback(\n    (\n      node: SanityNode | SanityStegaNode,\n    ): {\n      field: OverlayElementField\n      parent: OverlayElementParent\n    } => {\n      if (!isSanityNode(node)) {\n        return {\n          field: undefined,\n          parent: undefined,\n        }\n      }\n\n      const schemaType = getType(node)\n\n      if (!schemaType) {\n        return {\n          field: undefined,\n          parent: undefined,\n        }\n      }\n      function fieldFromPath(\n        schemaType: OverlayElementParent,\n        path: string[],\n        parent: OverlayElementParent,\n        prevPath: string[] = [],\n      ): {\n        field: OverlayElementField\n        parent: OverlayElementParent\n      } {\n        if (!schemaType) {\n          return {field: undefined, parent: undefined}\n        }\n\n        const [next, ...rest] = path\n\n        if ('fields' in schemaType) {\n          const objectField = schemaType.fields[next]\n          if (!objectField && 'rest' in schemaType) {\n            return fieldFromPath(schemaType.rest, path, schemaType, prevPath)\n          }\n          if (!rest.length) {\n            return {field: objectField, parent}\n          }\n          if (!objectField) {\n            throw new Error(\n              `[@sanity/visual-editing] No field could be resolved at path: \"${[...prevPath, ...path].join('.')}\"`,\n            )\n          }\n          return fieldFromPath(objectField.value, rest, schemaType, [...prevPath, next])\n        } else if (schemaType.type === 'array') {\n          return fieldFromPath(schemaType.of, path, schemaType, prevPath)\n        } else if (schemaType.type === 'arrayItem') {\n          if (!rest.length) return {field: schemaType, parent}\n          return fieldFromPath(schemaType.value, rest, schemaType, [...prevPath, next])\n        } else if (schemaType.type === 'union') {\n          const name = next.startsWith('[_key==')\n            ? resolvedTypes\n                ?.get((node as SanityNode).id)\n                ?.get([prevPath.join('.'), next].filter(Boolean).join(''))\n            : next\n          return fieldFromPath(\n            schemaType.of.find((item) => (item.type === 'unionOption' ? item.name === name : item)),\n            rest,\n            schemaType,\n            [...prevPath, next],\n          )\n        } else if (schemaType.type === 'unionOption') {\n          if (!next) return {field: schemaType, parent}\n          return fieldFromPath(schemaType.value, path, schemaType, prevPath)\n        } else if (schemaType.type === 'inline') {\n          const type = getType(schemaType.name, 'type')\n          return fieldFromPath((type as TypeSchema).value, path, schemaType, prevPath)\n        }\n        throw new Error(\n          `[@sanity/visual-editing] No field could be resolved at path: \"${[...prevPath, ...path].join('.')}\"`,\n        )\n      }\n\n      const nodePath = node.path.split('.').flatMap((part) => {\n        if (part.includes('[')) {\n          return part.split(/(\\[.+\\])/, 2)\n        }\n        return [part]\n      })\n\n      try {\n        return fieldFromPath(schemaType, nodePath, undefined)\n      } catch (e) {\n        // eslint-disable-next-line no-console\n        if (e instanceof Error) console.warn(e.message)\n        return {field: undefined, parent: undefined}\n      }\n    },\n    [getType, resolvedTypes],\n  )\n\n  const context = useMemo<SchemaContextValue>(() => ({getField, getType}), [getField, getType])\n\n  return <SchemaContext.Provider value={context}>{children}</SchemaContext.Provider>\n}\n","import type {SerializableObject} from '@sanity/presentation-comlink'\nimport {useEffect, useMemo, type FunctionComponent, type PropsWithChildren} from 'react'\nimport type {VisualEditingNode} from '../../types'\nimport {SharedStateContext} from './SharedStateContext'\n\nconst createStore = (initialState: SerializableObject) => {\n  let state = initialState\n  const getState = () => state\n  const listeners = new Set<() => void>()\n  const setState = (fn: (state: SerializableObject) => SerializableObject) => {\n    state = fn(state)\n    listeners.forEach((l) => l())\n  }\n  const subscribe = (listener: () => void) => {\n    listeners.add(listener)\n    return () => listeners.delete(listener)\n  }\n  return {getState, setState, subscribe}\n}\n\nconst store = createStore({})\n\nexport const SharedStateProvider: FunctionComponent<\n  PropsWithChildren<{\n    comlink?: VisualEditingNode\n  }>\n> = (props) => {\n  const {comlink, children} = props\n\n  useEffect(() => {\n    return comlink?.on('presentation/shared-state', (data) => {\n      if ('value' in data) {\n        store.setState((prev) => ({...prev, [data.key]: data.value}))\n      } else {\n        store.setState((prev) => {\n          return Object.fromEntries(Object.entries(prev).filter(([key]) => key !== data.key))\n        })\n      }\n    })\n  }, [comlink])\n\n  useEffect(() => {\n    async function fetch() {\n      const value = await comlink?.fetch('visual-editing/shared-state', undefined, {\n        suppressWarnings: true,\n      })\n      if (value) {\n        store.setState(() => value.state)\n      }\n    }\n    fetch().catch((reason) => {\n      // eslint-disable-next-line no-console\n      console.debug(reason)\n      // eslint-disable-next-line no-console\n      console.warn(\n        '[@sanity/visual-editing]: Failed to fetch shared state. Check your version of `sanity` is up-to-date',\n      )\n    })\n  }, [comlink])\n\n  const value = useMemo(() => ({comlink, store}), [comlink])\n\n  return <SharedStateContext.Provider value={value}>{children}</SharedStateContext.Provider>\n}\n","import {useCallback, type FunctionComponent, type PropsWithChildren} from 'react'\nimport type {VisualEditingNode} from '../../types'\nimport {events, TelemetryContext, type TelemetryContextValue} from './TelemetryContext'\n\nexport const TelemetryProvider: FunctionComponent<\n  PropsWithChildren<{comlink?: VisualEditingNode}>\n> = ({children, comlink}) => {\n  const log = useCallback<TelemetryContextValue>(\n    (name, data) => {\n      if (!comlink) return\n\n      const event = events[name]\n\n      if (!event) {\n        throw new Error(`Telemetry event: ${name} does not exist`)\n      } else {\n        comlink.post('visual-editing/telemetry-log', {event, data})\n      }\n    },\n    [comlink],\n  )\n\n  return <TelemetryContext.Provider value={log}>{children}</TelemetryContext.Provider>\n}\n","import {useEffect, useRef, type MutableRefObject} from 'react'\nimport {createOverlayController} from '../controller'\nimport {useOptimisticActorReady} from '../react/useOptimisticActor'\nimport type {OverlayController, OverlayEventHandler} from '../types'\n\n/**\n * Hook for using an overlay controller\n * @internal\n */\nexport function useController(\n  element: HTMLElement | null,\n  handler: OverlayEventHandler,\n  inFrame: boolean,\n  inPopUp: boolean,\n): MutableRefObject<OverlayController | undefined> {\n  const overlayController = useRef<OverlayController | undefined>(undefined)\n\n  const optimisticActorReady = useOptimisticActorReady()\n\n  useEffect(() => {\n    if (!element) return undefined\n\n    overlayController.current = createOverlayController({\n      handler,\n      overlayElement: element,\n      inFrame,\n      inPopUp,\n      optimisticActorReady,\n    })\n\n    return () => {\n      overlayController.current?.destroy()\n      overlayController.current = undefined\n    }\n  }, [element, handler, inFrame, inPopUp, optimisticActorReady])\n\n  return overlayController\n}\n","import type {VisualEditingControllerMsg} from '@sanity/presentation-comlink'\nimport {useEffect} from 'react'\nimport type {OverlayMsg, VisualEditingNode} from '../types'\n\nexport function usePerspectiveSync(\n  comlink: VisualEditingNode | undefined,\n  dispatch: (value: OverlayMsg | VisualEditingControllerMsg) => void,\n): void {\n  useEffect(() => {\n    const controller = new AbortController()\n    comlink\n      ?.fetch('visual-editing/fetch-perspective', undefined, {\n        signal: controller.signal,\n        suppressWarnings: true,\n      })\n      .then((data) => {\n        dispatch({type: 'presentation/perspective', data})\n      })\n      .catch(() => {\n        // Fail silently as the app may be communicating with a version of\n        // Presentation that does not support this feature\n      })\n\n    const unsub = comlink?.on('presentation/perspective', (data) => {\n      dispatch({type: 'presentation/perspective', data})\n    })\n\n    return () => {\n      unsub?.()\n      controller.abort()\n    }\n  }, [comlink, dispatch])\n}\n","import type {ClientPerspective, ContentSourceMapDocuments} from '@sanity/client'\nimport {useCallback, useEffect, useRef} from 'react'\nimport type {ElementState, SanityNode, VisualEditingNode} from '../types'\n\nfunction isEqualSets(a: Set<string>, b: Set<string>) {\n  if (a === b) return true\n  if (a.size !== b.size) return false\n  for (const value of a) if (!b.has(value)) return false\n  return true\n}\n\n/**\n * Hook for reporting in use documents to Presentation\n * @internal\n */\nexport function useReportDocuments(\n  comlink: VisualEditingNode | undefined,\n  elements: ElementState[],\n  perspective: ClientPerspective,\n): void {\n  const lastReported = useRef<\n    | {\n        nodeIds: Set<string>\n        perspective: ClientPerspective\n      }\n    | undefined\n  >(undefined)\n\n  const reportDocuments = useCallback(\n    (documents: ContentSourceMapDocuments, perspective: ClientPerspective) => {\n      comlink?.post('visual-editing/documents', {\n        documents,\n        perspective,\n      })\n    },\n    [comlink],\n  )\n\n  useEffect(() => {\n    // Report only nodes of type `SanityNode`. Untransformed `SanityStegaNode`\n    // nodes without an `id`, are not reported as they will not contain the\n    // necessary document data.\n    const nodes = elements\n      .map((e) => {\n        const {sanity} = e\n        if (!sanity || !('id' in sanity)) return null\n        return sanity\n      })\n      .filter((s) => !!s) as SanityNode[]\n\n    const nodeIds = new Set<string>(nodes.map((e) => e.id))\n    // Report if:\n    // - Documents not yet reported\n    // - Document IDs changed\n    // - Perspective changed\n    if (\n      !lastReported.current ||\n      !isEqualSets(nodeIds, lastReported.current.nodeIds) ||\n      perspective !== lastReported.current.perspective\n    ) {\n      const documentsOnPage: ContentSourceMapDocuments = Array.from(nodeIds).map((_id) => {\n        const node = nodes.find((node) => node.id === _id)!\n        const {type, projectId: _projectId, dataset: _dataset} = node\n        return _projectId && _dataset\n          ? {_id, _type: type!, _projectId, _dataset}\n          : {_id, _type: type!}\n      })\n      lastReported.current = {nodeIds, perspective}\n      reportDocuments(documentsOnPage, perspective)\n    }\n  }, [elements, perspective, reportDocuments])\n}\n","import type {ClientPerspective} from '@sanity/client'\nimport {getDraftId, getPublishedId} from '@sanity/client/csm'\nimport type {Status} from '@sanity/comlink'\nimport {type VisualEditingControllerMsg} from '@sanity/presentation-comlink'\nimport {\n  isHTMLAnchorElement,\n  isHTMLElement,\n  LayerProvider,\n  PortalProvider,\n  studioTheme,\n  ThemeProvider,\n  usePrefersDark,\n} from '@sanity/ui/_visual-editing'\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useReducer,\n  useRef,\n  useState,\n  type FunctionComponent,\n} from 'react'\nimport {styled} from 'styled-components'\nimport {useOptimisticActor, useOptimisticActorReady} from '../react/useOptimisticActor'\nimport type {\n  OverlayComponentResolver,\n  OverlayEventHandler,\n  OverlayMsg,\n  OverlayPluginDefinition,\n  VisualEditingNode,\n} from '../types'\nimport {sanityNodesExistInSameArray} from '../util/findSanityNodes'\nimport {useDragEndEvents} from '../util/useDragEvents'\nimport {ContextMenu} from './context-menu/ContextMenu'\nimport {ElementOverlay} from './ElementOverlay'\nimport {OverlayDragGroupRect} from './OverlayDragGroupRect'\nimport {OverlayDragInsertMarker} from './OverlayDragInsertMarker'\nimport {OverlayDragPreview} from './OverlayDragPreview'\nimport {OverlayMinimapPrompt} from './OverlayMinimapPrompt'\nimport {overlayStateReducer} from './overlayStateReducer'\nimport {PreviewSnapshotsProvider} from './preview/PreviewSnapshotsProvider'\nimport {SchemaProvider} from './schema/SchemaProvider'\nimport {SharedStateProvider} from './shared-state/SharedStateProvider'\nimport {TelemetryProvider} from './telemetry/TelemetryProvider'\nimport {useTelemetry} from './telemetry/useTelemetry'\nimport {useController} from './useController'\nimport {usePerspectiveSync} from './usePerspectiveSync'\nimport {useReportDocuments} from './useReportDocuments'\n\nconst Root = styled.div<{\n  $zIndex?: string | number\n}>`\n  background-color: transparent;\n  direction: ltr;\n  inset: 0;\n  pointer-events: none;\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  z-index: ${({$zIndex}) => $zIndex ?? '9999999'};\n`\n\nfunction raf2(fn: () => void) {\n  let r0: number | undefined = undefined\n  let r1: number | undefined = undefined\n\n  r0 = requestAnimationFrame(() => {\n    r1 = requestAnimationFrame(fn)\n  })\n\n  return () => {\n    if (r0 !== undefined) cancelAnimationFrame(r0)\n    if (r1 !== undefined) cancelAnimationFrame(r1)\n  }\n}\n\nconst DocumentReporter: FunctionComponent<{\n  documentIds: string[]\n  perspective: ClientPerspective\n}> = (props) => {\n  const {documentIds} = props\n  const [uniqueIds, setUniqueIds] = useState<string[]>([])\n\n  useEffect(() => {\n    setUniqueIds((prev) => {\n      const next = Array.from(new Set(documentIds))\n      return prev.length === next.length &&\n        prev.reduce((acc, prevId) => acc.filter((id) => id !== prevId), next)?.length === 0\n        ? prev\n        : next\n    })\n  }, [documentIds])\n  const actor = useOptimisticActor()\n\n  useEffect(() => {\n    for (const id of uniqueIds) {\n      actor.send({type: 'observe', documentId: getDraftId(id)})\n      actor.send({type: 'observe', documentId: getPublishedId(id)})\n    }\n    return () => {\n      for (const id of uniqueIds) {\n        actor.send({type: 'unobserve', documentId: getDraftId(id)})\n        actor.send({type: 'unobserve', documentId: getPublishedId(id)})\n      }\n    }\n  }, [actor, uniqueIds])\n\n  return null\n}\n\nconst OverlaysController: FunctionComponent<{\n  comlink?: VisualEditingNode\n  dispatch: (value: OverlayMsg | VisualEditingControllerMsg) => void\n  inFrame: boolean\n  inPopUp: boolean\n  onDrag: (x: number, y: number) => void\n  overlayEnabled: boolean\n  rootElement: HTMLElement | null\n}> = (props) => {\n  const {comlink, dispatch, inFrame, inPopUp, onDrag, overlayEnabled, rootElement} = props\n  const {dispatchDragEndEvent} = useDragEndEvents()\n  const sendTelemetry = useTelemetry()\n\n  const overlayEventHandler: OverlayEventHandler = useCallback(\n    (message) => {\n      if (message.type === 'element/click') {\n        const {sanity} = message\n        comlink?.post('visual-editing/focus', sanity)\n\n        sendTelemetry('Visual Editing Overlay Clicked', null)\n      } else if (message.type === 'overlay/activate') {\n        comlink?.post('visual-editing/toggle', {enabled: true})\n      } else if (message.type === 'overlay/deactivate') {\n        comlink?.post('visual-editing/toggle', {enabled: false})\n      } else if (message.type === 'overlay/dragEnd') {\n        const {insertPosition, target, dragGroup, flow, preventInsertDefault} = message\n\n        dispatchDragEndEvent({insertPosition, target, dragGroup, flow, preventInsertDefault})\n\n        if (insertPosition) {\n          sendTelemetry('Visual Editing Drag Sequence Completed', null)\n        }\n      } else if (message.type === 'overlay/dragUpdateCursorPosition') {\n        onDrag(message.x, message.y)\n\n        return\n      } else if (message.type === 'overlay/dragToggleMinimap' && message.display === true) {\n        sendTelemetry('Visual Editing Drag Minimap Enabled', null)\n      } else if (message.type === 'overlay/setCursor') {\n        const {element, cursor} = message\n\n        if (cursor) {\n          element.style.cursor = cursor\n        } else {\n          element.style.removeProperty('cursor')\n        }\n      }\n\n      dispatch(message)\n    },\n    [comlink, dispatch, dispatchDragEndEvent, onDrag, sendTelemetry],\n  )\n\n  const controller = useController(rootElement, overlayEventHandler, inFrame, inPopUp)\n\n  useEffect(() => {\n    if (overlayEnabled) {\n      controller.current?.activate()\n    } else {\n      controller.current?.deactivate()\n    }\n  }, [controller, overlayEnabled])\n\n  return null\n}\n\n/**\n * @internal\n */\nexport const Overlays: FunctionComponent<{\n  comlink?: VisualEditingNode\n  comlinkStatus?: Status\n  componentResolver?: OverlayComponentResolver\n  plugins?: OverlayPluginDefinition[]\n  inFrame: boolean\n  inPopUp: boolean\n  zIndex?: string | number\n}> = (props) => {\n  const {\n    comlink,\n    comlinkStatus,\n    componentResolver: _componentResolver,\n    inFrame,\n    inPopUp,\n    zIndex,\n  } = props\n\n  const prefersDark = usePrefersDark()\n\n  const [\n    {\n      contextMenu,\n      dragInsertPosition,\n      dragShowMinimap,\n      dragShowMinimapPrompt,\n      dragSkeleton,\n      elements,\n      isDragging,\n      perspective,\n      wasMaybeCollapsed,\n      dragMinimapTransition,\n      dragGroupRect,\n    },\n    dispatch,\n  ] = useReducer(overlayStateReducer, {\n    contextMenu: null,\n    dragInsertPosition: null,\n    dragShowMinimap: false,\n    dragShowMinimapPrompt: false,\n    dragSkeleton: null,\n    elements: [],\n    focusPath: '',\n    isDragging: false,\n    perspective: 'published',\n    wasMaybeCollapsed: false,\n    dragMinimapTransition: false,\n    dragGroupRect: null,\n  })\n  const [rootElement, setRootElement] = useState<HTMLElement | null>(null)\n  const [overlayEnabled, setOverlayEnabled] = useState(true)\n\n  useEffect(() => {\n    const unsubs = [\n      comlink?.on('presentation/focus', (data) => {\n        dispatch({type: 'presentation/focus', data})\n      }),\n      comlink?.on('presentation/blur', (data) => {\n        dispatch({type: 'presentation/blur', data})\n      }),\n      comlink?.on('presentation/toggle-overlay', () => {\n        setOverlayEnabled((enabled) => !enabled)\n      }),\n    ].filter(Boolean)\n\n    return () => unsubs.forEach((unsub) => unsub!())\n  }, [comlink])\n\n  usePerspectiveSync(comlink, dispatch)\n\n  useReportDocuments(comlink, elements, perspective)\n\n  const updateDragPreviewCustomProps = useCallback(\n    (x: number, y: number) => {\n      if (!rootElement) return\n\n      rootElement.style.setProperty('--drag-preview-x', `${x}px`)\n      rootElement.style.setProperty('--drag-preview-y', `${y - window.scrollY}px`)\n    },\n    [rootElement],\n  )\n\n  useEffect(() => {\n    const handleClick = (event: MouseEvent) => {\n      const target = event.target\n\n      // We only need to modify the default behavior if the target is a link\n      const targetsLink = Boolean(\n        isHTMLAnchorElement(target) || (isHTMLElement(target) && target.closest('a')),\n      )\n\n      if (targetsLink && event.altKey) {\n        event.preventDefault()\n        event.stopPropagation()\n        const newEvent = new MouseEvent(event.type, {\n          ...event,\n          altKey: false,\n          bubbles: true,\n          cancelable: true,\n        })\n        event.target?.dispatchEvent(newEvent)\n      }\n    }\n\n    const handleKeyUp = (e: KeyboardEvent) => {\n      if (isAltKey(e)) {\n        setOverlayEnabled((enabled) => !enabled)\n      }\n    }\n\n    const handleKeydown = (e: KeyboardEvent) => {\n      if (isAltKey(e)) {\n        setOverlayEnabled((enabled) => !enabled)\n      }\n\n      if (isHotkey(['mod', '\\\\'], e)) {\n        setOverlayEnabled((enabled) => !enabled)\n      }\n    }\n\n    window.addEventListener('click', handleClick)\n    window.addEventListener('keydown', handleKeydown)\n    window.addEventListener('keyup', handleKeyUp)\n\n    return () => {\n      window.removeEventListener('click', handleClick)\n      window.removeEventListener('keydown', handleKeydown)\n      window.removeEventListener('keyup', handleKeyUp)\n    }\n  }, [setOverlayEnabled])\n\n  const [overlaysFlash, setOverlaysFlash] = useState(false)\n  const [fadingOut, setFadingOut] = useState(false)\n  const fadeOutTimeoutRef = useRef<NodeJS.Timeout | undefined>(undefined)\n\n  // Flash overlays when they are enabled\n  useEffect(() => {\n    if (overlayEnabled) {\n      return raf2(() => {\n        setOverlaysFlash(true)\n        raf2(() => {\n          setFadingOut(true)\n          fadeOutTimeoutRef.current = setTimeout(() => {\n            setFadingOut(false)\n            setOverlaysFlash(false)\n          }, 1500)\n        })\n      })\n    } else if (fadeOutTimeoutRef.current) {\n      clearTimeout(fadeOutTimeoutRef.current)\n      setOverlaysFlash(false)\n      setFadingOut(false)\n    }\n\n    return\n  }, [overlayEnabled])\n\n  const documentIds = useMemo(() => {\n    return elements.flatMap((element) => ('id' in element.sanity ? [element.sanity.id] : []))\n  }, [elements])\n\n  const closeContextMenu = useCallback(() => {\n    dispatch({type: 'overlay/blur'})\n  }, [])\n\n  const optimisticActorReady = useOptimisticActorReady()\n\n  const componentResolver = useMemo(() => {\n    return optimisticActorReady ? _componentResolver : undefined\n  }, [_componentResolver, optimisticActorReady])\n\n  const elementsToRender = useMemo(() => {\n    if (((inFrame || inPopUp) && comlinkStatus !== 'connected') || isDragging) {\n      return []\n    }\n\n    return elements\n      .filter((e) => e.activated || e.focused)\n      .map(({id, element, focused, hovered, rect, sanity, dragDisabled, targets, elementType}) => {\n        const draggable =\n          !dragDisabled &&\n          !!element.getAttribute('data-sanity') &&\n          optimisticActorReady &&\n          elements.some((e) =>\n            'id' in e.sanity && 'id' in sanity\n              ? sanityNodesExistInSameArray(e.sanity, sanity) && e.sanity.path !== sanity.path\n              : false,\n          )\n\n        return (\n          <ElementOverlay\n            comlink={comlink}\n            componentResolver={componentResolver}\n            plugins={props.plugins}\n            element={element}\n            enableScrollIntoView={!isDragging && !dragMinimapTransition && !dragShowMinimap}\n            key={id}\n            id={id}\n            focused={focused}\n            hovered={hovered}\n            node={sanity}\n            rect={rect}\n            // When inside a popup window we want actions to show up on hover, but iframes should hide them\n            showActions={!inFrame}\n            draggable={draggable}\n            isDragging={isDragging || dragMinimapTransition}\n            wasMaybeCollapsed={focused && wasMaybeCollapsed}\n            targets={targets}\n            elementType={elementType}\n          />\n        )\n      })\n  }, [\n    componentResolver,\n    props.plugins,\n    dragMinimapTransition,\n    dragShowMinimap,\n    elements,\n    inFrame,\n    inPopUp,\n    isDragging,\n    optimisticActorReady,\n    comlink,\n    comlinkStatus,\n    wasMaybeCollapsed,\n  ])\n\n  return (\n    <TelemetryProvider comlink={comlink}>\n      <ThemeProvider scheme={prefersDark ? 'dark' : 'light'} theme={studioTheme} tone=\"transparent\">\n        <LayerProvider>\n          <PortalProvider element={rootElement}>\n            <SchemaProvider comlink={comlink} elements={elements}>\n              <PreviewSnapshotsProvider comlink={comlink}>\n                <SharedStateProvider comlink={comlink}>\n                  <Root\n                    data-fading-out={fadingOut ? '' : undefined}\n                    data-overlays={overlaysFlash ? '' : undefined}\n                    ref={setRootElement}\n                    $zIndex={zIndex}\n                  >\n                    <DocumentReporter documentIds={documentIds} perspective={perspective} />\n                    <OverlaysController\n                      comlink={comlink}\n                      dispatch={dispatch}\n                      inFrame={inFrame}\n                      inPopUp={inPopUp}\n                      onDrag={updateDragPreviewCustomProps}\n                      overlayEnabled={overlayEnabled}\n                      rootElement={rootElement}\n                    />\n                    {contextMenu && <ContextMenu {...contextMenu} onDismiss={closeContextMenu} />}\n                    {elementsToRender}\n\n                    {isDragging && !dragMinimapTransition && (\n                      <>\n                        {dragInsertPosition && (\n                          <OverlayDragInsertMarker dragInsertPosition={dragInsertPosition} />\n                        )}\n                        {dragShowMinimapPrompt && <OverlayMinimapPrompt />}\n                        {dragGroupRect && <OverlayDragGroupRect dragGroupRect={dragGroupRect} />}\n                      </>\n                    )}\n                    {isDragging && dragSkeleton && <OverlayDragPreview skeleton={dragSkeleton} />}\n                  </Root>\n                </SharedStateProvider>\n              </PreviewSnapshotsProvider>\n            </SchemaProvider>\n          </PortalProvider>\n        </LayerProvider>\n      </ThemeProvider>\n    </TelemetryProvider>\n  )\n}\n\nconst IS_MAC =\n  typeof window != 'undefined' && /Mac|iPod|iPhone|iPad/.test(window.navigator.platform)\n\nconst MODIFIERS: Record<string, 'altKey' | 'ctrlKey' | 'metaKey' | 'shiftKey'> = {\n  alt: 'altKey',\n  ctrl: 'ctrlKey',\n  mod: IS_MAC ? 'metaKey' : 'ctrlKey',\n  shift: 'shiftKey',\n}\nfunction isHotkey(keys: string[], event: KeyboardEvent): boolean {\n  return keys.every((key) => {\n    if (MODIFIERS[key]) {\n      return event[MODIFIERS[key]]\n    }\n    return event.key === key.toUpperCase()\n  })\n}\nfunction isAltKey(event: KeyboardEvent): boolean {\n  return event.key === 'Alt'\n}\n","import {useEffect, useRef, type FunctionComponent} from 'react'\nimport type {VisualEditingNode, VisualEditingOptions} from '../types'\n\n/**\n * @internal\n */\nexport const Refresh: FunctionComponent<\n  {\n    comlink: VisualEditingNode\n  } & Required<Pick<VisualEditingOptions, 'refresh'>>\n> = (props) => {\n  const {comlink, refresh} = props\n\n  const manualRefreshRef = useRef(0)\n  const mutationRefreshRef = useRef(0)\n\n  useEffect(\n    () =>\n      comlink.on('presentation/refresh', (data) => {\n        if (data.source === 'manual') {\n          clearTimeout(manualRefreshRef.current)\n          const promise = refresh(data)\n          if (promise === false) return\n          comlink.post('visual-editing/refreshing', data)\n          let timedOut = false\n          manualRefreshRef.current = window.setTimeout(() => {\n            comlink.post('visual-editing/refreshed', data)\n            timedOut = true\n          }, 3000)\n          promise?.finally?.(() => {\n            if (timedOut) return\n            clearTimeout(manualRefreshRef.current)\n            comlink.post('visual-editing/refreshed', data)\n          })\n        } else if (data.source === 'mutation') {\n          clearTimeout(mutationRefreshRef.current)\n          const promise = refresh(data)\n          if (promise === false) return\n          comlink.post('visual-editing/refreshing', data)\n          // Send an additional refresh to account for Content Lake eventual consistency\n          mutationRefreshRef.current = window.setTimeout(() => {\n            const promise = refresh(data)\n            if (promise === false) return\n            comlink.post('visual-editing/refreshing', data)\n            // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n            promise?.finally?.(() => {\n              comlink.post('visual-editing/refreshed', data)\n            }) || comlink.post('visual-editing/refreshed', data)\n          }, 1000)\n          // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n          promise?.finally?.(() => {\n            comlink.post('visual-editing/refreshed', data)\n          }) || comlink.post('visual-editing/refreshed', data)\n        }\n      }),\n    [comlink, refresh],\n  )\n\n  return null\n}\n","import {createNode, createNodeMachine, type Status} from '@sanity/comlink'\nimport {\n  createCompatibilityActors,\n  type VisualEditingControllerMsg,\n  type VisualEditingNodeMsg,\n} from '@sanity/presentation-comlink'\nimport {useEffect, useState} from 'react'\nimport type {VisualEditingNode} from '../types'\n\n/**\n * Hook for maintaining a channel between overlays and the presentation tool\n * @internal\n */\nexport function useComlink(active: boolean = true): [VisualEditingNode | undefined, Status] {\n  const [node, setNode] = useState<VisualEditingNode>()\n  const [status, setStatus] = useState<Status>('idle')\n\n  useEffect(() => {\n    if (!active) return\n    const instance = createNode<VisualEditingNodeMsg, VisualEditingControllerMsg>(\n      {\n        name: 'visual-editing',\n        connectTo: 'presentation',\n      },\n      createNodeMachine<VisualEditingNodeMsg, VisualEditingControllerMsg>().provide({\n        actors: createCompatibilityActors<VisualEditingNodeMsg>(),\n      }),\n    )\n    const unsub = instance.onStatus(() => setStatus('connected'), 'connected')\n\n    setNode(instance)\n    const stop = instance.start()\n\n    return () => {\n      unsub()\n      stop()\n      setNode(undefined)\n    }\n  }, [active])\n\n  /**\n   * Handle reporting of status to the presentation tool in case of connection failure due to misconfigured URL origin\n   */\n  useEffect(() => {\n    /**\n     * We only need to report status if the node is not connected\n     */\n    if (status === 'connected') return\n\n    const controller = new AbortController()\n    window.addEventListener(\n      'message',\n      ({data, origin}: MessageEvent<unknown>) => {\n        /**\n         * Detect if Presentation is asking if Visual Editing is here but misconfigured\n         * @TODO this should probably be a feature built into `comlink`, as it's a common problem for apps dealing with iframes.\n         */\n        if (\n          data &&\n          typeof data === 'object' &&\n          'domain' in data &&\n          data.domain === 'sanity/channels' &&\n          'from' in data &&\n          data.from === 'presentation' &&\n          'type' in data &&\n          data.type === 'presentation/status'\n        ) {\n          /**\n           * We only send this message to the parent window, which supports Presentation loading the page in an iframe.\n           * This avoids letting other iframes on the page, or other openers, from getting a response.\n           */\n          window.parent.postMessage(\n            {\n              domain: 'sanity/channels',\n              type: 'visual-editing/status',\n              data: {origin: location.origin},\n            },\n            /**\n             * Using the same origin ensures that if the parent window don't have the same origin the message won't be sent.\n             * This grants some protection against spoofing, as malicious iframes can't easily call this event and trigger the Presentation Tool to think there's a failing state.\n             */\n            origin,\n          )\n        }\n      },\n      {signal: controller.signal},\n    )\n    return () => {\n      controller.abort()\n    }\n  }, [status])\n\n  return [node, status]\n}\n","import {type ListenEvent} from '@sanity/client'\nimport {merge, ReplaySubject, Subject, type Observable, type ObservedValueOf} from 'rxjs'\nimport type {VisualEditingNode} from '../../types'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype SharedListenEvent = ListenEvent<Record<string, any>>\n\n/**\n * Creates a single, shared, listener EventSource that strems remote mutations, and notifies when it's online (welcome), offline (reconnect).\n */\nexport function createSharedListener(comlink: VisualEditingNode): Observable<SharedListenEvent> {\n  // Welcome events could be received before the listener has been subscribed\n  // to. Using a ReplaySubject will ensure the welcome event is re-emitted when\n  // a new subscriber arrives.\n  const incomingConnection$ = new ReplaySubject<SharedListenEvent>(1)\n  const incomingMutations$ = new Subject<SharedListenEvent>()\n\n  comlink\n    .fetch('visual-editing/snapshot-welcome', undefined, {suppressWarnings: true})\n    .then((data) => {\n      incomingConnection$.next(data.event)\n    })\n    .catch(() => {\n      // Fail silently as the app may be communicating with a version of\n      // Presentation that does not support this feature\n    })\n\n  comlink.on('presentation/snapshot-event', (data) => {\n    // Welcome events are still emitted by Presentation for backwards\n    // compatibility. We don't need them anymore as we explicitly fetch the\n    // welcome event, so filter them out here.\n    if (data.event.type === 'reconnect') {\n      incomingConnection$.next(data.event)\n    }\n    if (data.event.type === 'mutation') {\n      incomingMutations$.next(data.event)\n    }\n  })\n\n  return merge(incomingConnection$, incomingMutations$)\n}\n\nexport type SharedListenerEvents = ObservedValueOf<ReturnType<typeof createSharedListener>>\n","import {useEffect} from 'react'\nimport {createActor} from 'xstate'\nimport {setActor} from '../optimistic/context'\nimport {createSharedListener} from '../optimistic/state/createSharedListener'\nimport {createDatasetMutator} from '../optimistic/state/datasetMutator'\nimport type {VisualEditingNode} from '../types'\n\n/**\n * Hook for maintaining a channel between overlays and the presentation tool\n * @internal\n */\nexport function useDatasetMutator(comlink: VisualEditingNode | undefined): void {\n  useEffect(() => {\n    if (!comlink) return\n    const listener = createSharedListener(comlink)\n    const datasetMutator = createDatasetMutator(comlink)\n    const mutator = createActor(datasetMutator, {\n      // @ts-expect-error @todo\n      input: {client: {withConfig: () => {}}, sharedListener: listener},\n    })\n\n    mutator.start()\n\n    // Fetch features to determine if optimistic updates are supported\n    const featuresFetch = new AbortController()\n    comlink\n      .fetch('visual-editing/features', undefined, {\n        signal: featuresFetch.signal,\n        suppressWarnings: true,\n      })\n      .then((data) => {\n        if (data.features['optimistic']) {\n          setActor(mutator)\n        }\n      })\n      .catch(() => {\n        // eslint-disable-next-line no-console\n        console.warn(\n          '[@sanity/visual-editing] Package version mismatch detected: Please update your Sanity studio to prevent potential compatibility issues.',\n        )\n      })\n\n    return () => {\n      mutator.stop()\n      featuresFetch.abort()\n    }\n  }, [comlink])\n}\n","import {isMaybePreviewIframe, isMaybePreviewWindow} from '@sanity/presentation-comlink'\nimport {useEffect, useState} from 'react'\nimport {createPortal} from 'react-dom'\nimport type {VisualEditingOptions} from '../types'\nimport {History} from './History'\nimport {Meta} from './Meta'\nimport {Overlays} from './Overlays'\nimport {Refresh} from './Refresh'\nimport {useComlink} from './useComlink'\nimport {useDatasetMutator} from './useDatasetMutator'\n\n/**\n * @public\n */\nexport const VisualEditing = (props: VisualEditingOptions & {portal: boolean}): React.ReactNode => {\n  const {components, plugins, history, portal = true, refresh, zIndex} = props\n\n  const [inFrame, setInFrame] = useState<boolean | null>(null)\n  const [inPopUp, setInPopUp] = useState<boolean | null>(null)\n  useEffect(() => {\n    setInFrame(isMaybePreviewIframe())\n    setInPopUp(isMaybePreviewWindow())\n  }, [])\n\n  const [portalElement, setPortalElement] = useState<HTMLElement | null>(null)\n  useEffect(() => {\n    if (portal === false) return undefined\n    const node = document.createElement('sanity-visual-editing')\n    document.documentElement.appendChild(node)\n    setPortalElement(node)\n    return () => {\n      setPortalElement(null)\n      if (document.documentElement.contains(node)) {\n        document.documentElement.removeChild(node)\n      }\n    }\n  }, [portal])\n\n  const [comlink, comlinkStatus] = useComlink(inFrame === true || inPopUp === true)\n  useDatasetMutator(comlinkStatus === 'connected' ? comlink : undefined)\n\n  const children = (\n    <>\n      {inFrame !== null && inPopUp !== null && (\n        <Overlays\n          comlink={comlink}\n          comlinkStatus={comlinkStatus}\n          componentResolver={components}\n          plugins={plugins}\n          inFrame={inFrame}\n          inPopUp={inPopUp}\n          zIndex={zIndex}\n        />\n      )}\n      {comlink && (\n        <>\n          <History comlink={comlink} history={history} />\n          <Meta comlink={comlink} />\n          {refresh && <Refresh comlink={comlink} refresh={refresh} />}\n        </>\n      )}\n    </>\n  )\n\n  if (portal === false || !portalElement) return children\n\n  return createPortal(children, portalElement)\n}\nVisualEditing.displayName = 'VisualEditing'\n"],"names":["History","props","$","_c","comlink","history","t0","t1","on","data","update","useEffect","t2","t3","subscribe","title","document","post","Meta","sendMeta","observer","MutationObserver","mutation","target","nodeName","observe","head","subtree","characterData","childList","disconnect","getReferenceNodeAndInsertPosition","position","top","right","bottom","left","node","sanity","useDragEndEvents","getDocument","useDocuments","handler","e","insertPosition","preventInsertDefault","detail","reference","doc","id","key","targetKey","hasExplicitKey","getArrayItemKeyAndParentPath","path","arrayPath","referenceItemKey","patch","getSnapshot","snapshot","elementValue","getFromPath","at","remove","_key","insert","window","addEventListener","removeEventListener","dispatchDragEndEvent","_temp","Symbol","for","event","customEvent","CustomEvent","cancelable","dispatchEvent","SchemaContext","createContext","useSchema","context","useContext","Error","getArrayRemoveAction","type","getArrayRemovePatches","getArrayInsertAction","insertType","getArrayInsertPatches","getDuplicateAction","getArrayDuplicatePatches","getContextMenuItems","field","parent","getContextMenuArrayItems","getContextMenuUnionItems","Promise","resolve","getDuplicateItem","label","icon","CopyIcon","action","telemetryEvent","getRemoveItems","RemoveIcon","getMoveItems","withDivider","items","groupItems","moveUpPatches","moveDownPatches","moveFirstPatches","moveLastPatches","all","getArrayMovePatches","length","push","PublishIcon","ArrowUpIcon","ArrowDownIcon","UnpublishIcon","SortIcon","InsertAboveIcon","name","InsertBelowIcon","InsertMenuWrapper","width","onSelect","boundaryElement","arrow","constrainSize","floatingBoundary","padding","placement","fallbackPlacements","preventOverflow","__unstable_margins","t4","options","insertMenu","views","some","view","undefined","component","sendTelemetry","schemaType","of","filter","item","map","t","getNodeIcon","POPOVER_MARGINS","ContextMenuItem","onDismiss","useTelemetry","onClick","hotkeys","t5","itemIndex","Component","ContextMenu","x","y","setBoundaryElement","useState","getField","setItems","fetchContextMenuItems","items_0","t6","getBoundingClientRect","height","contextMenuReferenceElement","t7","t8","t9","minWidth","maxWidth","t10","t11","t12","t13","t14","i","t15","t16","t17","t18","t19","t20","getLinkHref","href","referer","parsed","URL","location","origin","hash","slice","pathname","search","searchParams","set","toString","PreviewSnapshotsContext","usePreviewSnapshots","isReactElementOverlayComponent","isValidElement","Root","styled","Card","Actions","Flex","HUD","MenuWrapper","Tab","ActionOpen","Labels","ExclusivePluginContainer","div","createIntentLink","baseUrl","tool","workspace","createEditUrl","pathToUrlString","studioPath","fromString","ElementOverlayInner","element","focused","componentResolver","showActions","draggable","targets","elementType","onActivateExclusivePlugin","onMenuOpenChange","getType","previewSnapshots","bb0","find","_id","getContext","node_0","nodeElement","schemaType_0","value","targetElement","legacyComponentContext","pluginContexts","resolverContexts","customComponents","useCustomComponents","nodePluginCollections","useResolvedNodePlugins","plugins","__html","menuId","useId","_temp2","showMenu","handleLabelClick","_temp3","animate","tone","EllipsisVerticalIcon","nodePluginCollection_0","index","Fragment","textTransform","nodePluginCollection","exclusive","MenuDivider","_temp4","Array","isArray","Component_1","props_0","PointerEvents","ElementOverlay","memo","hovered","rect","wasMaybeCollapsed","enableScrollIntoView","ref","useRef","scrolledIntoViewRef","w","h","transform","style","current","scrollIntoView","behavior","actions","block","inline","scrollMode","isNearTop","setIsNearTop","io","IntersectionObserver","intersection","boundingClientRect","threshold","activeExclusivePlugin","setActiveExclusivePlugin","closeExclusivePluginView","plugin","handleExclusivePluginClick","_temp5","ExclusivePluginComponent","menuOpen","setMenuOpen","t21","componentContexts","componentContext","instance","uuid","hud","forEach","guard","resolved","_temp6","Link","useSyncExternalStore","_temp7","_temp8","ctx","stopPropagation","nodePluginCollection_1","Component_0","onStoreChange","handlePopState","OverlayDragGroupRect","dragGroupRect","border","pointerEvents","markerThickness","lerp","v0","v1","OverlayDragInsertMarker","dragInsertPosition","flow","startX","endX","offset","Math","min","offset_0","offset_1","startX_0","startY","endY","offset_2","offset_3","offset_4","background","borderRadius","zIndex","$scaleFactor","$width","$height","clamp","number","max","inMin","inMax","outMin","outMax","mapped","OverlayDragPreview","skeleton","maxSkeletonWidth","innerWidth","scaleFactor","offsetX","offsetY","prefersDark","usePrefersDark","theme","useTheme_v2","radius","T0","T1","childRects","imageRects","textRects","color","r_1","r","from","tagName","r_0","OverlayMinimapPrompt","elementsReducer","elements","message","activated","dragDisabled","clickedElement","overlayStateReducer","state","contextMenu","focusPath","perspective","isDragging","dragShowMinimap","dragShowMinimapPrompt","dragSkeleton","dragMinimapTransition","prevFocusPath","startsWith","display","groupRect","PreviewSnapshotsProvider","children","setPreviewSnapshots","signal","response","fetch","suppressWarnings","snapshots","fetchPreviewSnapshots","previewSapshotsFetch","AbortController","unsub","onStatus","abort","isSanityNode","isDocumentSchemaType","isTypeSchemaType","popUnkeyedPathSegments","split","toReversed","reduce","acc","part","includes","join","getPathsWithUnresolvedTypes","SchemaProvider","Map","resolvedTypes","setResolvedTypes","schema","setSchema","fetchSchema","schemaFetch","reportedPathsRef","useDeferredValue","paths","controllerRef","reportPaths","paths_0","signal_0","initialReportedPaths","response_0","aborted","types","p","_type","fieldFromPath","schemaType_1","path_0","prevPath","next","rest","objectField","fields","name_0","get","Boolean","type_0","nodePath","flatMap","console","warn","createStore","initialState","getState","listeners","Set","setState","fn","l","listener","add","delete","store","SharedStateProvider","catch","value_0","prev","prev_0","Object","fromEntries","entries","reason","debug","TelemetryProvider","events","log","useController","inFrame","inPopUp","overlayController","optimisticActorReady","useOptimisticActorReady","createOverlayController","overlayElement","destroy","usePerspectiveSync","dispatch","controller","then","data_0","isEqualSets","a","b","size","has","useReportDocuments","lastReported","documents","perspective_0","reportDocuments","nodes","nodeIds","documentsOnPage","projectId","_projectId","dataset","_dataset","e_0","s","$zIndex","raf2","r0","r1","requestAnimationFrame","cancelAnimationFrame","DocumentReporter","documentIds","uniqueIds","setUniqueIds","actor","useOptimisticActor","id_0","send","documentId","getDraftId","getPublishedId","id_1","OverlaysController","onDrag","overlayEnabled","rootElement","enabled","dragGroup","cursor","removeProperty","activate","deactivate","Overlays","comlinkStatus","_componentResolver","useReducer","setRootElement","setOverlayEnabled","unsubs","setProperty","scrollY","updateDragPreviewCustomProps","handleClick","handleKeyUp","isAltKey","handleKeydown","isHotkey","overlaysFlash","setOverlaysFlash","fadingOut","setFadingOut","fadeOutTimeoutRef","setTimeout","clearTimeout","closeContextMenu","_temp9","element_0","getAttribute","e_2","sanityNodesExistInSameArray","elementsToRender","t22","t23","t24","t25","t26","t27","studioTheme","t28","IS_MAC","test","navigator","platform","MODIFIERS","alt","ctrl","mod","shift","keys","every","toUpperCase","prevId","isHTMLAnchorElement","isHTMLElement","closest","altKey","preventDefault","newEvent","MouseEvent","bubbles","enabled_0","enabled_1","enabled_2","e_1","Refresh","refresh","manualRefreshRef","mutationRefreshRef","source","promise","timedOut","finally","promise_0","promise_1","useComlink","active","setNode","status","setStatus","createNode","connectTo","createNodeMachine","provide","actors","createCompatibilityActors","stop","start","domain","postMessage","createSharedListener","incomingConnection$","ReplaySubject","incomingMutations$","Subject","merge","useDatasetMutator","datasetMutator","createDatasetMutator","mutator","createActor","input","client","withConfig","sharedListener","featuresFetch","features","optimistic","setActor","VisualEditing","components","portal","setInFrame","setInPopUp","isMaybePreviewIframe","isMaybePreviewWindow","portalElement","setPortalElement","createElement","documentElement","appendChild","contains","removeChild","createPortal","displayName"],"mappings":"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","ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29],"debugId":null}}]
}